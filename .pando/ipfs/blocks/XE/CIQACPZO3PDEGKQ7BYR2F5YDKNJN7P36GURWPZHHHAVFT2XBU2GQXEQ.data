
Š€€€nn,r,this.conn)}ls(e){e=c(e);const t=u(\"ls\",(t,r)=>{if(t)return e(t);i(r,s.decode(),function(e){let t=0;return i.take(e=>(n.decode(e),t=n.decode(e,n.decode.bytes),!0))}(),i.map(l),i.collect((t,r)=>{if(t)return e(t);e(null,r.slice(1))}))},this.log);i(this.conn,t,this.conn)}}},function(e,t,r){\"use strict\";const n=r(1),i=r(33),s=r(22);e.exports=function(e,t){const r=Object.keys(e.handlers).filter(e=>\"ls\"!==e),o=r.length,a=r.reduce((e,t)=>{const r=Buffer.from(t+\"\\n\");return e+s.encodingLength(r.length)},0),u=Buffer.concat([Buffer.from(s.encode(o)),Buffer.from(s.encode(a)),Buffer.from(\"\\n\")]),c=r.map(e=>Buffer.from(e+\"\\n\")),f=[u].concat(c);n(n.values(f),i.encode(),t)}},function(e,t){e.exports=require(\"async/some\")},function(e,t,r){\"use strict\";const n=r(65),i=r(33),s=r(32).Connection,o=r(109).writeEncoded,a=r(486);e.exports=function(e,t,r){const u=e=>{r.error(e)},c=n({timeout:6e4},u),f=c.handshake;return function n(){i.decodeFromReader(f,(i,c)=>{if(i)return u(i);r(\"received:\",c.toString());const l=c.toString().slice(0,-1);!function(e,t,r){const n=Object.keys(t);let i=!1;a(n,(r,n)=>{t[r].matchFunc(r,e,(e,t)=>{if(e)return n(e);t&&(i=r),n()})},e=>{if(e)return r(e);r(null,i)})}(l,t,(i,a)=>{if(i)return u(i);const h=a;if(h){r(\"send ack back of: \"+l),o(f,c,u);const n=new s(f.rest(),e);t[h].handlerFunc(l,n)}else r(\"not supported protocol: \"+l),o(f,Buffer.from(\"na\\n\")),n()})})}(),c}},function(e,t,r){\"use strict\";const n=r(1),i=r(168),s=r(10),o=r(240),a=r(487),u=r(485),c=r(239),f=r(109),l=r(32).Connection,h=r(238).PROTOCOL_ID;e.exports=class{constructor(){this.handlers={ls:{handlerFunc:(e,t)=>u(this,t),matchFunc:c}},this.log=f.log.listener()}handle(e,t){this.log(\"listener handle conn\");const r=o(h,(r,i)=>{if(r)return t(r);const s=new l(i,e),o=a(s,this.handlers,this.log);n(s,o,s),t()},this.log);n(e,r,e)}addHandler(e,t,r){this.log(\"adding handler: \"+e),s(i(t),\"handler must be a function\"),this.handlers[e]&&this.log(\"overwriting handler for \"+e),r||(r=c),this.handlers[e]={handlerFunc:t,matchFunc:r}}}},function(e,t,r){\"use strict\";const n=r(54),i=r(53),s=r(0)(\"libp2p:swarm:transport\"),o=r(110),a=r(481);function u(e,t){return e.filter(t)}e.exports=function(e){const t=new a(8,3e4);return{add(t,r,n){if(n=n||{},s(\"adding %s\",t),e.transports[t])throw new Error(\"There is already a transport with this key\");e.transports[t]=r,e.transports[t].listeners||(e.transports[t].listeners=[])},dial(r,n,i){const o=e.transports[r];let a=n.multiaddrs.toArray();Array.isArray(a)||(a=[a]),a=u(o,a),s(\"dialing %s\",r,a.map(e=>e.toString())),t.dialMany(n.id,o,a,(t,r)=>{if(t)return i(t);n.connect(r.multiaddr),e._peerBook.put(n),i(null,r.conn)})},listen(t,r,s,a){s||(s=o.bind(null,e.protocols));const c=u(e.transports[t],e._peerInfo.multiaddrs.distinct()),f=e.transports[t];f.listeners||(f.listeners=[]);let l=[];const h=c.map(e=>t=>{const r=i(t),n=f.createListener(s);n.once(\"error\",r),n.listen(e,e=>{if(e)return r(e);n.removeListener(\"error\",r),n.getAddrs((e,t)=>{if(e)return r(e);l=l.concat(t),f.listeners.push(n),r()})})});n(h,t=>{if(t)return a(t);e._peerInfo.multiaddrs.replace(c,l),a()})},close(t,r){const i=e.transports[t];if(!i)return r(new Error(`Trying to close non existing transport: ${t}`));n(i.listeners.map(e=>t=>{e.close(t)}),r)}}}},function(e,t,r){\"use strict\";const n=r(11).EventEmitter,i=r(18),s=r(30),o=r(489),a=r(479),u=r(234),c=r(467),f=r(110),l=r(235),h=r(10);e.exports=class extends n{constructor(e,t){super(),h(e,\"You must provide a `peerInfo`\"),h(t,\"You must provide a `peerBook`\"),this._peerInfo=e,this._peerBook=t,this.setMaxListeners(1/0),this.transports={},this.conns={},this.muxedConns={},this.protocols={},this.muxers={},this.identify=!1,this.crypto=l,this.transport=o(this),this.connection=a(this),this.hasTransports=(()=>{const e=Object.keys(this.transports).filter(e=>\"Circuit\"!==e);return e&&e.length>0}),this.availableTransports=(e=>{const t=e.multiaddrs.toArray();return Object.keys(this.transports).filter(e=>this.transports[e].filter(t).length>0).sort(e=>\"Circuit\"===e?1:0)}),this.handle(this.crypto.tag,(e,t)=>{const r=this._peerInfo.id,n=this.crypto.encrypt(r,t,void 0,()=>{});return f(this.protocols,n)}),this.dial=c(this)}start(e){i(this.availableTransports(this._peerInfo),(e,t)=>{this.transport.listen(e,{},null,t)},e)}stop(e){s([e=>i(this.muxedConns,(e,t)=>{e.muxer.end(e=>{if(e&&\"Fatal error: OK\"!==e.message)return t(e);t()})},e),e=>{i(this.transports,(e,t)=>{i(e.listeners,(e,t)=>{e.close(t)},t)},e)}],e)}handle(e,t,r){this.protocols[e]={handlerFunc:t,matchFunc:r}}unhandle(e){this.protocols[e]&&delete this.protocols[e]}hangUp(e,t){const r=u(e,this.peerBook).id.toB58String();if(this.muxedConns[r]){const e=this.muxedConns[r].muxer;e.once(\"close\",()=>{delete this.muxedConns[r],t()}),e.end()}else t()}}},function(e,t,r){\"use strict\";const n=r(11).EventEmitter,i=r(10),s=r(2),o=r(18),a=r(30),u=r(306),c=r(490),f=r(466),l=r(462),h=r(461),p=r(460),d=r(459),y=r(449);e.exports;const m=\"The libp2p node is not started yet\";e.exports=class extends n{constructor(e,t,r,n){if(super(),i(e,\"requires modules to equip libp2p with features\"),i(t,\"requires a PeerInfo instance\"),this.modules=e,this.peerInfo=t,this.peerBook=r||new u,n=n||{},this._isStarted=!1,this.switch=new c(this.peerInfo,this.peerBook),this.modules.connection&&this.modules.connection.muxer){let e=this.modules.connection.muxer;(e=Array.isArray(e)?e:[e]).forEach(e=>this.switch.connection.addStreamMuxer(e)),this.switch.connection.reuse(),this.switch.connection.enableCircuitRelay(n.relay),this.switch.on(\"peer-mux-established\",e=>{this.emit(\"peer:connect\",e),this.peerBook.put(e)}),this.switch.on(\"peer-mux-closed\",e=>{this.emit(\"peer:disconnect\",e)})}if(this.modules.connection&&this.modules.connection.crypto){let e=this.modules.connection.crypto;(e=Array.isArray(e)?e:[e]).forEach(e=>{this.switch.connection.crypto(e.tag,e.encrypt)})}if(this.modules.discovery){let e=this.modules.discovery;(e=Array.isArray(e)?e:[e]).forEach(e=>{e.on(\"peer\",e=>this.emit(\"peer:discovery\",e))})}e.DHT&&(this._dht=new this.modules.DHT(this.switch,{kBucketSize:20,datastore:n.DHT&&n.DHT.datastore})),this.peerRouting=l(this),this.contentRouting=h(this),this.dht=p(this),this.pubsub=d(this),this._getPeerInfo=y(this),f.mount(this.switch)}start(e){if(!this.modules.transport)return e(new Error(\"no transports were present\"));let t,r=this.modules.transport;r=Array.isArray(r)?r:[r];const n=[],i=[];this.peerInfo.multiaddrs.toArray().forEach(e=>{e.getPeerId()||(n.push(e),i.push(e.encapsulate(\"/ipfs/\"+this.peerInfo.id.toB58String())))}),this.peerInfo.multiaddrs.replace(n,i);const s=this.peerInfo.multiaddrs.toArray();r.forEach(e=>{e.filter(s).length>0?this.switch.transport.add(e.tag||e.constructor.name,e):e.constructor&&\"WebSockets\"===e.constructor.name&&(t=e)}),a([e=>this.switch.start(e),e=>{if(t&&this.switch.transport.add(t.tag||t.constructor.name,t),this.modules.discovery)return o(this.modules.discovery,(e,t)=>e.start(t),e);e()},e=>{this._isStarted=!0,this._dht?this._dht.start(e):e()},e=>{!1!==this._options?this._floodSub.start(e):e()},e=>{const t=this.peerInfo.multiaddrs.toArray();r.forEach(e=>{t.forEach(e=>{e.toString().match(/\\/p2p-circuit($|\\/)/)||r.find(t=>t.filter(e).length>0)||this.peerInfo.multiaddrs.delete(e)})}),e()},e=>{this.emit(\"start\"),e()}],e)}stop(e){this.modules.discovery&&this.modules.discovery.forEach(e=>{s(()=>e.stop(()=>{}))}),a([e=>{this._floodSub.started&&this._floodSub.stop(e)},e=>{if(this._dht)return this._dht.stop(e);e()},e=>this.switch.stop(e),e=>{this.emit(\"stop\"),e()}],t=>{this._isStarted=!1,e(t)})}isStarted(){return this._isStarted}dial(e,t){i(this.isStarted(),m),this._getPeerInfo(e,(e,r)=>{if(e)return t(e);this.switch.dial(r,e=>{if(e)return t(e);this.peerBook.put(r),t()})})}dialProtocol(e,t,r){i(this.isStarted(),m),\"function\"==typeof t&&(r=t,t=void 0),this._getPeerInfo(e,(e,n)=>{if(e)return r(e);this.switch.dial(n,t,(e,t)=>{if(e)return r(e);this.peerBook.put(n),r(null,t)})})}hangUp(e,t){i(this.isStarted(),m),this._getPeerInfo(e,(e,r)=>{if(e)return t(e);this.switch.hangUp(r,t)})}ping(e,t){i(this.isStarted(),m),this._getPeerInfo(e,(e,r)=>{if(e)return t(e);t(null,new f(this.switch,r))})}handle(e,t,r){this.switch.handle(e,t,r)}unhandle(e){this.switch.unhandle(e)}}},function(e,t,r){\"use strict\";const n=r(65),i=r(145);e.exports=class{constructor(e,t,r,s){\"function\"==typeof r&&(s=r,r=void 0),this.setup(),this.id.local=e,this.id.remote=t,this.key.local=e.privKey,this.timeout=r||6e4,s=s||(()=>{}),this.secure=i.duplex(),this.stream=n({timeout:this.timeout},s),this.shake=this.stream.handshake,delete this.stream.handshake}setup(){this.id={local:null,remote:null},this.key={local:null,remote:null},this.shake=null,this.cleanSecrets()}cleanSecrets(){this.shared={},this.ephemeralKey={local:null,remote:null},this.proposal={in:null,out:null},this.proposalEncoded={in:null,out:null},this.protocols={local:null,remote:null},this.exchange={in:null,out:null}}}},function(e,t,r){\"use strict\";const n=r(1),i=r(33),s={fixed:!0,bytes:4};function o(){return n.map(e=>\"string\"==typeof e?Buffer.from(e,\"utf-8\"):e)}t.createBoxStream=((e,t)=>n(o(),n.asyncMap((r,n)=>{e.encrypt(r,(e,r)=>{if(e)return n(e);t.digest(r,(e,t)=>{if(e)return n(e);n(null,Buffer.concat([r,t]))})})}),i.encode(s))),t.createUnboxStream=((e,t)=>n(o(),i.decode(s),n.asyncMap((r,n)=>{const i=r.length,s=t.length;if(i<s)return n(new Error(`buffer (${i}) shorter than MAC size (${s})`));const o=i-s,a=r.slice(0,o),u=r.slice(o);t.digest(a,(t,r)=>t?n(t):u.equals(r)?void e.decrypt(a,(e,t)=>{if(e)return n(e);n(null,t)}):n(new Error(`MAC Invalid: ${u.toString(\"hex\")} != ${r.toString(\"hex\")}`)))})))},function(e,t,r){\"use strict\";const n=r(1),i=r(65),s=r(0),o=s(\"libp2p:secio\");o.error=s(\"libp2p:secio:error\");const a=r(493),u=r(158);e.exports=function(e,t){o(\"3. finish - start\");const r=e.protocols,s=e.shake.rest(),c=i({timeout:e.timeout},e=>{if(e)throw e});n(s,a.createUnboxStream(r.remote.cipher,r.remote.mac),c,a.createBoxStream(r.local.cipher,r.local.mac),s),c.handshake.write(e.proposal.in.rand),c.handshake.read(e.proposal.in.rand.length,(r,i)=>{const s=r=>{o.error(r),e.secure.resolve({source:n.error(r),sink(e){}}),t(r)};if(r)return s(r);try{u.verifyNonce(e,i)}catch(r){return s(r)}o(\"3. finish - finish\"),e.secure.resolve(c.handshake.rest()),t()})}},function(e,t,r){\"use strict\";const n=r(0),i=r(3),s=r(159),o=r(158),a=n(\"libp2p:secio\");a.error=n(\"libp2p:secio:error\"),e.exports=function(e,t){a(\"2. exchange - start\"),a(\"2. exchange - writing exchange\"),i([t=>o.createExchange(e,t),(t,r)=>{s.write(e,t),s.read(e.shake,r)},(t,r)=>{a(\"2. exchange - reading exchange\"),o.verify(e,t,r)},t=>o.generateKeys(e,t)],e=>{if(e)return t(e);a(\"2. exchange - finish\"),t()})}},function(e,t,r){\"use strict\";e.exports=\"message Propose {\\n  optional bytes rand = 1;\\n  optional bytes pubkey = 2;\\n  optional string exchanges = 3;\\n  optional string ciphers = 4;\\n  optional string hashes = 5;\\n}\\n\\nmessage Exchange {\\n  optional bytes epubkey = 1;\\n  optional bytes signature = 2;\\n}\"},function(e,t,r){\"use strict\";const n=r(0),i=r(3),s=r(159),o=r(158),a=n(\"libp2p:secio\");a.error=n(\"libp2p:secio:error\"),e.exports=function(e,t){a(\"1. propose - start\"),a(\"1. propose - writing proposal\"),s.write(e,o.createProposal(e)),i([t=>s.read(e.shake,t),(t,r)=>{a(\"1. propose - reading proposal\",t),o.identify(e,t,r)},t=>o.selectProtocols(e,t)],e=>{if(e)return t(e);a(\"1. propose - finish\"),t()})}},function(e,t,r){\"use strict\";const n=r(30),i=r(497),s=r(495),o=r(494);e.exports=function(e,t){return n([t=>i(e,t),t=>s(e,t),t=>o(e,t)],r=>{e.cleanSecrets(),r&&(!0===r&&(r=new Error(\"Stream ended prematurely\")),e.shake.abort(r)),t(r)}),e.stream}},function(e,t,r){\"use strict\";const n=r(1),i=r(32).Connection,s=r(10),o=r(27),a=r(0),u=r(53),c=a(\"libp2p:secio\");c.error=a(\"libp2p:secio:error\");const f=r(498),l=r(492);e.exports={tag:\"/secio/1.0.0\",encrypt(e,t,r,a){s(e,\"no local private key provided\"),s(t,\"no connection for the handshake  provided\"),\"function\"==typeof r&&(a=r,r=void 0),a=u(a||function(e){e&&c.error(e)});const h=new l(e,r,3e5,a);const p=new i(void 0,t);return n(t,f(h,function(e){if(e)return a(e);t.getPeerInfo((e,r)=>{p.setInnerConn(new i(h.secure,t)),e&&p.setPeerInfo(new o(h.id.remote)),a()})}),t),p}}},function(e,t){e.exports=require(\"pump\")},function(e,t){e.exports=function(e){var t;return e=e||function(){},function(r){return function(n,i){r(n,function(r,n){if(t)return i(!0);if(r&&!0!==r){var s=e(r);return!1===s?i(r):s&&!0!==s?(t=!0,i(null,s)):i(!0)}i(r,n)})}}}},function(e,t,r){\"use strict\";const n=r(11).EventEmitter,i=r(32).Connection,s=r(119),o=r(1),a=r(501),u=r(2),c=r(241);function f(){}function l(e){return{source:o(e.source,a(e=>{if(\"Channel destroyed\"!==e.message)return!1})),sink:e.sink}}e.exports=class extends n{constructor(e,t){super(),this.multiplex=t,this.conn=e,this.multicodec=c,t.on(\"close\",()=>this.emit(\"close\")),t.on(\"error\",e=>this.emit(\"error\",e)),t.on(\"stream\",(e,t)=>{const r=new i(l(s.duplex(e)),this.conn);this.emit(\"stream\",r)})}newStream(e){e=e||f;let t=this.multiplex.createStream();const r=new i(l(s.duplex(t)),this.conn);return u(()=>e(null,r)),r}end(e){e=e||f,this.multiplex.once(\"close\",e),this.multiplex.destroy()}}},function(e,t,r){\"use strict\";const n=r(11).EventEmitter,i=r(160),s=r(0);e.exports=class extends i.Duplex{constructor(e,t,r){const n=Boolean(r.halfOpen);super({allowHalfOpen:n}),this.name=e,this.log=s(\"mplex:channel:\"+this.name.toString()),this.channel=0,this.initiator=!1,this.chunked=Boolean(r.chunked),this.halfOpen=n,this.destroyed=!1,this.finalized=!1,this._multiplex=t,this._dataHeader=0,this._opened=!1,this._awaitDrain=0,this._lazy=Boolean(r.lazy);let i=!1,o=!1;this.log(\"open, halfOpen: \"+this.halfOpen),this.once(\"end\",()=>{this.log(\"end\"),this._read(),this.destroyed||(o=!0,i?this._finalize():this.halfOpen||this.end())}),this.once(\"finish\",function e(){if(!this.destroyed){if(!this._opened)return this.once(\"open\",e);this._lazy&&this.initiator&&this._open(),this._multiplex._send(this.channel<<3|(this.initiator?4:3),null),i=!0,o&&this._finalize()}})}destroy(e){this._destroy(e,!0)}_destroy(e,t){if(this.log(\"_destroy:\"+(t?\"local\":\"remote\")),this.destroyed)return void this.log(\"already destroyed\");this.destroyed=!0;const r=n.listenerCount(this,\"error\")>0;if(!e||t&&!r||this.emit(\"error\",e),this.emit(\"close\"),t&&this._opened){this._lazy&&this.initiator&&this._open();const t=e?new Buffer(e.message):null;try{this._multiplex._send(this.channel<<3|(this.initiator?6:5),t)}catch(e){}}this._finalize()}_finalize(){this.finalized||(this.finalized=!0,this.emit(\"finalize\"))}_write(e,t,r){this.log(\"write: \",e.length),this._opened?this.destroyed?r():(this._lazy&&this.initiator&&this._open(),this._multiplex._send(this._dataHeader,e)?r():this._multiplex._ondrain.push(r)):this.once(\"open\",()=>{this._write(e,t,r)})}_read(){if(this._awaitDrain){const e=this._awaitDrain;this._awaitDrain=0,this._multiplex._onchanneldrain(e)}}_open(){let e=null;Buffer.isBuffer(this.name)?e=this.name:this.name!==this.channel.toString()&&(e=new Buffer(this.name)),this._lazy=!1,this._multiplex._send(this.channel<<3|0,e)}open(e,t){this.log(\"open: \"+e),this.channel=e,this.initiator=t,this._dataHeader=e<<3|(t?2:1),this._opened=!0,!this._lazy&&this.initiator&&this._open(),this.emit(\"open\")}}},function(e,t){e.exports=require(\"duplexify\")},function(e,t){var r=Math.pow(2,7),n=Math.pow(2,14),i=Math.pow(2,21),s=Math.pow(2,28),o=Math.pow(2,35),a=Math.pow(2,42),u=Math.pow(2,49),c=Math.pow(2,56),f=Math.pow(2,63);e.exports=function(e){return e<r?1:e<n?2:e<i?3:e<s?4:e<o?5:e<a?6:e<u?7:e<c?8:e<f?9:10}},function(e,t){e.exports=function e(t,i){var s,o=0,i=i||0,a=0,u=i,c=t.length;do{if(u>=c)return e.bytes=0,void(e.bytesRead=0);s=t[u++],o+=a<28?(s&n)<<a:(s&n)*Math.pow(2,a),a+=7}while(s>=r);e.bytes=u-i;return o};var r=128,n=127},function(e,t){e.exports=function e(t,s,o){s=s||[];o=o||0;var a=o;for(;t>=i;)s[o++]=255&t|r,t/=128;for(;t&n;)s[o++]=255&t|r,t>>>=7;s[o]=0|t;e.bytes=o-a+1;return s};var r=128,n=-128,i=Math.pow(2,31)},function(e,t,r){e.exports={encode:r(507),decode:r(506),encodingLength:r(505)}},function(e,t,r){\"use strict\";const n=r(160),i=r(508),s=r(504),o=r(0),a=r(503),u=new Buffer([0]),c=new Buffer(0);let f=new Buffer(10240),l=0;e.exports=class extends n.Duplex{constructor(e,t){super(),\"function\"==typeof e&&(t=e,e={}),e||(e={}),t&&this.on(\"stream\",t),this.destroyed=!1,this.limit=e.limit||0,null==e.initiator&&(e.initiator=!0),this.initiator=e.initiator,this._corked=0,this._options=e,this._binaryName=Boolean(e.binaryName),this._local=[],this._remote=[],this._list=this._local,this._receiving=null,this._chunked=!1,this._state=0,this._type=0,this._channel=0,this._missing=0,this._message=null,this.log=o(\"mplex:main:\"+Math.floor(1e5*Math.random())),this.log(\"construction\");let r=100;this.limit&&(r=i.encodingLength(this.limit)),this._buf=new Buffer(r),this._ptr=0,this._awaitChannelDrains=0,this._onwritedrain=null,this._ondrain=[],this._finished=!1,this.once(\"finish\",this._clear),this._nextId=this.initiator?0:1}_nextStreamId(){let e=this._nextId;return this._nextId+=2,e}createStream(e,t){if(this.destroyed)throw new Error(\"Multiplexer is destroyed\");const r=this._nextStreamId();let n=this._name(e||r.toString());const i=Object.assign(this._options,t);this.log(\"createStream: %s\",r,n.toString(),i);const s=new a(n,this,i);return this._addChannel(s,r,this._local)}receiveStream(e,t){if(this.destroyed)throw new Error(\"Multiplexer is destroyed\");if(void 0===e||null===e)throw new Error(\"Name is needed when receiving a stream\");const r=this._name(e);this.log(\"receiveStream: \"+r.toString());const n=new a(r,this,Object.assign(this._options,t));if(this._receiving||(this._receiving={}),this._receiving[n.name])throw new Error(\"You are already receiving this stream\");return this._receiving[n.name]=n,n}createSharedStream(e,t){return this.log(\"createSharedStream\"),s(this.createStream(e,Object.assign(t,{lazy:!0})),this.receiveStream(e,t))}_name(e){return this._binaryName?Buffer.isBuffer(e)?e:new Buffer(e):e.toString()}_send(e,t){const r=t?t.length:0,n=l;let s=!0;return this.log(\"_send\",e,r),i.encode(e,f,l),l+=i.encode.bytes,i.encode(r,f,l),l+=i.encode.bytes,s=this.push(f.slice(n,l)),f.length-l<100&&(f=new Buffer(10240),l=0),t&&(s=this.push(t)),s}_addChannel(e,t,r){return this.log(\"_addChannel\",t),r[t]=e,e.on(\"finalize\",()=>{this.log(\"_remove channel\",t),r[t]=null}),e.open(t,r===this._local),e}_writeVarint(e,t){for(;t<e.length;t++){if(this._ptr===this._buf.length)return this._lengthError(e);if(this._buf[this._ptr++]=e[t],!(128&e[t])){if(0===this._state){const e=i.decode(this._buf);this._type=7&e,this._channel=e>>3,this._list=1&this._type?this._local:this._remote;const t=this._list.length>this._channel&&this._list[this._channel]&&this._list[this._channel].chunked;this._chunked=!(1!==this._type&&2!==this._type)&&t}else if(this._missing=i.decode(this._buf),this.limit&&this._missing>this.limit)return this._lengthError(e);return this._state++,this._ptr=0,t+1}}return e.length}_lengthError(e){return this.destroy(new Error(\"Incoming message is too big\")),e.length}_writeMessage(e,t){const r=e.length-t,n=this._missing;if(!this._message){if(n<=r)return this._missing=0,this._push(e.slice(t,t+n)),t+n;if(this._chunked)return this._missing-=r,this._push(e.slice(t,e.length)),e.length;this._message=new Buffer(n)}return e.copy(this._message,this._ptr,t,t+n),n<=r?(this._missing=0,this._push(this._message),t+n):(this._missing-=r,this._ptr+=r,e.length)}_push(e){if(this.log(\"_push\",e.length),this._missing||(this._ptr=0,this._state=0,this._message=null),0===this._type){if(this.log(\"open\",this._channel),this.destroyed||this._finished)return;let t,r;return t=this._binaryName?e:e.toString()||this._channel.toString(),this.log(\"open name\",t),void(this._receiving&&this._receiving[t]?(r=this._receiving[t],delete this._receiving[t],this._addChannel(r,this._channel,this._list)):(r=new a(t,this,this._options),this.emit(\"stream\",this._addChannel(r,this._channel,this._list),r.name)))}const t=this._list[this._channel];if(t)switch(this._type){case 5:case 6:const r=new Error(e.toString()||\"Channel destroyed\");return void t._destroy(r,!1);case 3:case 4:return void t.push(null);case 1:case 2:return void(t.push(e)||(this._awaitChannelDrains++,t._awaitDrain++))}}_onchanneldrain(e){if(this._awaitChannelDrains-=e,this._awaitChannelDrains)return;const t=this._onwritedrain;this._onwritedrain=null,t&&t()}_write(e,t,r){if(this.log(\"_write\",e.length),this._finished)return void r();if(this._corked)return void this._onuncork(this._write.bind(this,e,t,r));if(e===u)return void this._finish(r);let n=0;for(;n<e.length;)n=2===this._state?this._writeMessage(e,n):this._writeVarint(e,n);2!==this._state||this._missing||this._push(c),this._awaitChannelDrains?this._onwritedrain=r:r()}_finish(e){this._onuncork(()=>{!1===this._writableState.prefinished&&(this._writableState.prefinished=!0),this.emit(\"prefinish\"),this._onuncork(e)})}cork(){1==++this._corked&&this.emit(\"cork\")}uncork(){this._corked&&0==--this._corked&&this.emit(\"uncork\")}end(e,t,r){return this.log(\"end\"),\"function\"==typeof e&&(r=e,e=void 0),\"function\"==typeof t&&(r=t,t=void 0),e&&this.write(e),this._writableState.ending||this.write(u),n.Writable.prototype.end.call(this,r)}_onuncork(e){this._corked?this.once(\"uncork\",e):e()}_read(){for(;this._ondrain.length;)this._ondrain.shift()()}_clear(){if(this.log(\"_clear\"),this._finished)return;this._finished=!0;const e=this._local.concat(this._remote);this._local=[],this._remote=[],e.forEach(function(e){e&&e._destroy(null,!1)}),this.push(null)}finalize(){this._clear()}destroy(e){if(this.log(\"destroy\"),this.destroyed)this.log(\"already destroyed\");else{var t=this._local.concat(this._remote);this.destroyed=!0,e&&this.emit(\"error\",e),this.emit(\"close\"),t.forEach(function(t){t&&t.emit(\"error\",e||new Error(\"underlying socket has been closed\"))}),this._clear()}}}},function(e,t,r){\"use strict\";const n=r(509),i=r(242),s=r(241),o=r(502),a=r(500);function u(e,t){const r=i(e);r.on(\"end\",()=>r.destroy());const s=new n({halfOpen:!0,initiator:!t});return a(r,s,r),new o(e,s)}(t=e.exports=u).multicodec=s,t.dialer=(e=>u(e,!1)),t.listener=(e=>u(e,!0))},function(e,t){e.exports=function(e){if(!e)throw Error(\"hashlru must have a max value, of type number, greater than 0\");var t=0,r=Object.create(null),n=Object.create(null);function i(i,s){r[i]=s,++t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(e){return void 0!==r[e]||void 0!==n[e]},remove:function(e){void 0!==r[e]&&(r[e]=void 0),void 0!==n[e]&&(n[e]=void 0)},get:function(e){var t=r[e];return void 0!==t?t:void 0!==(t=n[e])?(i(e,t),t):void 0},set:function(e,t){void 0!==r[e]?r[e]=t:i(e,t)},clear:function(){r=Object.create(null),n=Object.create(null)}}}},function(e,t,r){\"use strict\";const n=r(511),i=r(22),s=r(18),o=r(1),a=r(5),u=r(14),c=r(9).Key,f=r(78),l=r(37);function h(e){return f.PROVIDERS_KEY_PREFIX+l.encodeBase32(e.buffer)}function p(e,t,r){var n;o(e.query({prefix:h(t)}),o.map(e=>{const t=e.key.toString().split(\"/\"),r=t[t.length-1],s=l.decodeBase32(r);return[new u(s),(n=e.value,i.decode(n))]}),o.collect((e,t)=>e?r(e):r(null,new Map(t))))}e.exports=class{constructor(e,t,r){this.datastore=e,this._log=l.logger(t,\"providers\"),this.cleanupInterval=f.PROVIDERS_CLEANUP_INTERVAL,this.provideValidity=f.PROVIDERS_VALIDITY,this.lruCacheSize=r||f.PROVIDERS_LRU_CACHE_SIZE,this.providers=n(this.lruCacheSize)}stop(){this._cleaner&&(clearInterval(this._cleaner),this._cleaner=null)}_cleanup(){this._getProviderCids((e,t)=>{if(e)return this._log.error(\"Failed to get cids\",e);s(t,(e,t)=>{this._getProvidersMap(e,(r,n)=>r?t(r):(n.forEach((e,t)=>{this._log(\"comparing: %s - %s > %s\",Date.now(),e,this.provideValidity),Date.now()-e>this.provideValidity&&n.delete(t)}),0===n.size?this._deleteProvidersMap(e,t):void t()))},e=>{if(e)return this._log.error(\"Failed to cleanup\",e);this._log(\"Cleanup successfull\")})})}_getProviderCids(e){o(this.datastore.query({prefix:f.PROVIDERS_KEY_PREFIX}),o.map(e=>{const t=e.key.toString().split(\"/\");if(4!==t.length)return void this._log.error(\"incorrectly formatted provider entry in datastore: %s\",e.key);let r,n;try{r=l.decodeBase32(t[2])}catch(e){return void this._log.error(\"error decoding base32 provider key: %s\",t[2])}try{n=new a(r)}catch(e){this._log.error(\"error converting key to cid from datastore: %s\",e.message)}return n}),o.filter(Boolean),o.collect(e))}_getProvidersMap(e,t){const r=this.providers.get(h(e));if(!r)return p(this.datastore,e,t);t(null,r)}_deleteProvidersMap(e,t){const r=h(e);this.providers.set(r,null);const n=this.datastore.batch();o(this.datastore.query({keysOnly:!0,prefix:r}),o.through(e=>n.delete(e.key)),o.onEnd(e=>{if(e)return t(e);n.commit(t)}))}get cleanupInterval(){return this._cleanupInterval}set cleanupInterval(e){this._cleanupInterval=e,this._cleaner&&clearInterval(this._cleaner),this._cleaner=setInterval(()=>this._cleanup(),this.cleanupInterval)}addProvider(e,t,r){this._log(\"addProvider %s\",e.toBaseEncodedString());const n=h(e),s=this.providers.get(n),o=(s,o)=>{if(s)return r(s);this._log(\"loaded %s provs\",o.size);const a=Date.now();o.set(t,a),this.providers.set(n,o),function(e,t,r,n,s){const o=[h(t),\"/\",l.encodeBase32(r.id)].join(\"\");e.put(new c(o),Buffer.from(i.encode(n)),s)}(this.datastore,e,t,a,r)};s?o(null,s):p(this.datastore,e,o)}getProviders(e,t){this._log(\"getProviders %s\",e.toBaseEncodedString()),this._getProvidersMap(e,(e,r)=>{if(e)return t(e);t(null,Array.from(r.keys()))})}}},function(e,t,r){\"use strict\";e.exports=class{constructor(){this.list=[]}push(e){return!this.has(e)&&(this.list.push(e),!0)}has(e){const t=this.list.find(t=>t.id.isEqual(e.id));return Boolean(t)}toArray(){return this.list.slice()}pop(){return this.list.pop()}get length(){return this.list.length}}},function(e,t,r){\"use strict\";const n=r(513);e.exports=class extends n{constructor(e){super(),this.limit=e}push(e){return this.length<this.limit&&super.push(e)}}},function(e,t){e.exports=require(\"async/times\")},function(e,t,r){\"use strict\";const n=r(14),i=r(92),s=r(3),o=r(30),a=r(18),u=r(111),c=r(515),f=r(49),l=r(27),h=r(31),p=r(37),d=r(243),y=r(59),m=r(78),g=r(244),v=r(514),b=i.Record;e.exports=(e=>({_nearestPeersToQuery(t,r){p.convertBuffer(t.key,(t,n)=>{if(t)return r(t);let i;try{i=e.routingTable.closestPeers(n,e.ncp)}catch(t){return r(t)}r(null,i.map(t=>e.peerBook.has(t)?e.peerBook.get(t):e.peerBook.put(new l(t))))})},_betterPeersToQuery(t,r,n){e._log(\"betterPeersToQuery\"),e._nearestPeersToQuery(t,(t,i)=>{if(t)return n(t);const s=i.filter(t=>e._isSelf(t.id)?(e._log.error(\"trying to return self as closer\"),!1):!t.id.isEqual(r.id));n(null,s)})},_checkLocalDatastore(t,r){e._log(\"checkLocalDatastore: %s\",t);const n=p.bufferToKey(t);e.datastore.has(n,(i,s)=>i?r(i):s?void e.datastore.get(n,(n,i)=>{if(n)return r(n);const s=i;let o;try{o=b.deserialize(s)}catch(n){return r(n)}return o?o.author.isEqual(e.peerInfo.id)?r(null,o):null==o.timeReceived||p.now()-o.timeReceived>m.MAX_RECORD_AGE?e.datastore.delete(t,r):void r(null,o):r(new Error(\"Invalid record\"))}):r())},_add(t,r){t=e.peerBook.put(t),e.routingTable.add(t.id,r)},_verifyRecordLocally(t,r){e._log(\"verifyRecordLocally\"),o([n=>{if(t.signature){const i=t.author;let s;if(e.peerBook.has(i)&&(s=e.peerBook.get(i)),!s||!s.id.pubKey)return r(new Error(\"Missing public key for: \"+i.toB58String()));t.verifySignature(s.id.pubKey,n)}else n()},r=>i.validator.verifyRecord(e.validators,t,r)],r)},_closerPeersSingle(t,r,i){e._log(\"_closerPeersSingle %s from %s\",t,r.toB58String()),e._findPeerSingle(r,new n(t),(t,r)=>{if(t)return i(t);const n=r.closerPeers.filter(t=>!e._isSelf(t.id)).map(t=>e.peerBook.put(t));i(null,n)})},_isSelf:t=>t&&e.peerInfo.id.id.equals(t.id),_findPeerSingle(t,r,n){e._log(\"_findPeerSingle %s\",t.toB58String());const i=new y(y.TYPES.FIND_NODE,r.id,0);e.network.sendRequest(t,i,n)},_putValueToPeer(t,r,n,i){const s=new y(y.TYPES.PUT_VALUE,t,0);s.record=r,e.network.sendRequest(n,s,(e,t)=>e?i(e):t.record.value.equals(b.deserialize(r).value)?void i():i(new Error(\"value not put correctly\")))},_putLocal(t,r,n){e.datastore.put(p.bufferToKey(t),r,n)},_get(t,r,n){e._log(\"_get %s\",t.toString()),s([n=>e.getMany(t,16,r,n),(r,n)=>{const o=r.map(e=>e.val),u=o[i.selection.bestRecord(e.selectors,t,o)];if(e._log(\"GetValue %s %s\",t.toString(),u),!u)return n(new d.NotFoundError);s([r=>p.createPutRecord(t,u,e.peerInfo.id,!0,r),(n,i)=>a(r,(r,i)=>r.val.equals(u)?i():e._isSelf(r.from)?e._putLocal(t,n,t=>{t&&e._log.error(\"Failed error correcting self\",t),i()}):void e._putValueToPeer(r.from,t,n,t=>{t&&e._log.error(\"Failed error correcting entry\",t),i()}),i)],e=>n(e,e?null:u))}],n)},_getLocal(t,r){e._log(\"getLocal %s\",t),s([r=>e.datastore.get(p.bufferToKey(t),r),(r,n)=>{let i;e._log(\"found %s in local datastore\",t);try{i=b.deserialize(r)}catch(e){return n(e)}e._verifyRecordLocally(i,e=>{if(e)return n(e);n(null,i)})}],r)},_getValueOrPeers(t,r,n){s([n=>e._getValueSingle(t,r,n),(t,r)=>{const n=t.closerPeers,i=t.record;return i?e._verifyRecordOnline(i,t=>t?(e._log(\"invalid record received, discarded\"),r(new d.InvalidRecordError)):r(null,i,n)):n.length>0?r(null,null,n):void r(new d.NotFoundError(\"Not found\"))}],n)},_getValueSingle(t,r,n){const i=new y(y.TYPES.GET_VALUE,r,0);e.network.sendRequest(t,i,n)},_verifyRecordOnline(t,r){o([r=>{t.signature?s([r=>e.getPublicKey(t.author,r),(e,r)=>t.verifySignature(e,r)],r):r()},r=>{i.validator.verifyRecord(e.validators,t,r)}],r)},_getPublicKeyFromNode(t,r){const i=p.keyForPublicKey(t);s([r=>e._getValueSingle(t,i,r),(e,r)=>{if(!e.record||!e.record.value)return r(new Error(\"Node not responding with its public key: \"+t.toB58String()));n.createFromPubKey(e.record.value,r)},(e,r)=>{if(!e.isEqual(t))return r(new Error(\"public key does not match id\"));r(null,e.pubKey)}],r)},_findNProviders(t,r,n,i){let o=new v(n);e.providers.getProviders(t,(a,c)=>{if(a)return i(a);if(c.forEach(t=>{let r;r=e.peerBook.has(t)?e.peerBook.get(t):e.peerBook.put(new l(t)),o.push(r)}),o.length>=n)return i(null,o.toArray());const f=new g(e,t.buffer,(r,i)=>{s([n=>e._findProvidersSingle(r,t,n),(t,r)=>{const i=t.providerPeers;if(e._log(\"(%s) found %s provider entries\",e.peerInfo.id.toB58String(),i.length),i.forEach(t=>{o.push(e.peerBook.put(t))}),o.length>=n)return r(null,{success:!0});r(null,{closerPeers:t.closerPeers})}],i)}),h=e.routingTable.closestPeers(t.buffer,m.ALPHA);u(e=>f.run(h,e),r)(e=>{if(e)return\"ETIMEDOUT\"===e.code&&o.length>0?i(null,o.toArray()):i(e);i(null,o.toArray())})})},_findProvidersSingle(t,r,n){const i=new y(y.TYPES.GET_PROVIDERS,r.buffer,0);e.network.sendRequest(t,i,n)},_bootstrap(t,r){e._log(\"bootstrap:start\"),c(t,(t,n)=>{s([e=>this._generateBootstrapId(e),(e,t)=>u(t=>{this._bootstrapQuery(e,t)},r)(t)],t=>{t&&e._log.error(\"bootstrap:error\",t),e._log(\"bootstrap:done\")})})},_bootstrapQuery(t,r){e._log(\"bootstrap:query:%s\",t.toB58String()),this.findPeer(t,(n,i)=>n instanceof d.NotFoundError?r():n?r(n):(e._log(\"bootstrap:query:found\",n,i),void r(new Error(`Bootstrap peer: ACTUALLY FOUND PEER: ${i}, ${t.toB58String()}`))))},_generateBootstrapId(e){h(f.randomBytes(16),\"sha2-256\",(t,r)=>{if(t)return e(t);e(null,new n(r))})}}))},function(e,t,r){\"use strict\";const n=r(37);e.exports=(e=>{const t=n.logger(e.peerInfo.id,\"rpc:ping\");return function(e,r,n){t(\"from %s\",e.id.toB58String()),n(null,r)}})},function(e,t,r){\"use strict\";const n=r(5),i=r(54),s=r(27),o=r(59),a=r(37);e.exports=(e=>{const t=a.logger(e.peerInfo.id,\"rpc:get-providers\");return function(r,u,c){let f;try{f=new n(u.key)}catch(e){return c(new Error(\"Invalid CID: \"+e.message))}t(\"%s\",f.toBaseEncodedString());const l=a.bufferToKey(f.buffer);i([r=>e.datastore.has(l,(e,n)=>{if(e)return t.error(\"Failed to check datastore existence\",e),r(null,!1);r(null,n)}),t=>e.providers.getProviders(f,t),t=>e._betterPeersToQuery(u,r,t)],(r,n)=>{if(r)return c(r);const i=n[0],a=n[2],f=n[1].map(t=>e.peerBook.has(t)?e.peerBook.get(t):e.peerBook.put(new s(t)));i&&f.push(e.peerInfo);const l=new o(u.type,u.key,u.clusterLevel);f.length>0&&(l.providerPeers=f),a.length>0&&(l.closerPeers=a),t(\"got %s providers %s closerPeers\",f.length,a.length),c(null,l)})}})},function(e,t,r){\"use strict\";const n=r(5),i=r(37);e.exports=(e=>{const t=i.logger(e.peerInfo.id,\"rpc:add-provider\");return function(r,i,s){if(t(\"start\"),!i.key||0===i.key.length)return s(new Error(\"Missing key\"));let o;try{o=new n(i.key)}catch(e){return s(new Error(\"Invalid CID: \"+e.message))}i.providerPeers.forEach(n=>{n.id.isEqual(r.id)?n.multiaddrs.size<1?t(\"no valid addresses for provider %s. Ignore\",r.id.toB58String()):(t(\"received provider %s for %s (addrs %s)\",r.id.toB58String(),o.toBaseEncodedString(),n.multiaddrs.toArray().map(e=>e.toString())),e._isSelf(n.id)||e.peerBook.put(n)):t(\"invalid provider peer %s from %s\",n.id.toB58String(),r.id.toB58String())}),e.providers.addProvider(o,r.id,s)}})},function(e,t,r){\"use strict\";const n=r(3),i=r(59),s=r(37),o=r(8).Buffer;e.exports=(e=>{const t=s.logger(e.peerInfo.id,\"rpc:find-node\");return function(r,s,a){t(\"start\"),n([t=>{if(s.key.equals(e.peerInfo.id.id))return t(null,[e.peerInfo]);e._betterPeersToQuery(s,r,t)},(e,n)=>{const a=new i(s.type,o.alloc(0),s.clusterLevel);e.length>0?a.closerPeers=e:t(\"handle FindNode %s: could not find anything\",r.id.toB58String()),n(null,a)}],a)}})},function(e,t,r){\"use strict\";const n=r(37);e.exports=(e=>{const t=n.logger(e.peerInfo.id,\"rpc:put-value\");return function(r,i,s){const o=i.key;t(\"key: %s\",o);const a=i.record;if(!a)return t.error(\"Got empty record from: %s\",r.id.toB58String()),s(new Error(\"Empty record\"));e._verifyRecordLocally(a,r=>{if(r)return t.error(r.message),s(r);a.timeReceived=new Date;const o=n.bufferToKey(a.key);e.datastore.put(o,a.serialize(),e=>{if(e)return s(e);s(null,i)})})}})},function(e,t,r){\"use strict\";const n=r(54),i=r(92).Record,s=r(59),o=r(37);e.exports=(e=>{const t=o.logger(e.peerInfo.id,\"rpc:get-value\");return function(r,a,u){const c=a.key;if(t(\"key: %s\",c),!c||0===c.length)return u(new Error(\"Invalid key\"));const f=new s(s.TYPES.GET_VALUE,c,a.clusterLevel);if(o.isPublicKeyKey(c)){t(\"is public key\");const r=o.fromPublicKeyKey(c);let n;if(e._isSelf(r)?n=e.peerInfo:e.peerBook.has(r)&&(n=e.peerBook.get(r)),n&&n.id.pubKey)return t(\"returning found public key\"),f.record=new i(c,n.id.pubKey.bytes,e.peerInfo.id),u(null,f)}n([t=>e._checkLocalDatastore(c,t),t=>e._betterPeersToQuery(a,r,t)],(e,r)=>{if(e)return u(e);const n=r[0],i=r[1];n&&(t(\"got record\"),f.record=n),i.length>0&&(t(\"got closer %s\",i.length),f.closerPeers=i),u(null,f)})}})},function(e,t,r){\"use strict\";const n=r(59).TYPES;e.exports=(e=>{const t={[n.GET_VALUE]:r(522)(e),[n.PUT_VALUE]:r(521)(e),[n.FIND_NODE]:r(520)(e),[n.ADD_PROVIDER]:r(519)(e),[n.GET_PROVIDERS]:r(518)(e),[n.PING]:r(517)(e)};return function(e){return t[e]}})},function(e,t,r){\"use strict\";e.exports='// can\\'t use, because protocol-buffers doesn\\'t support imports\\n// so we have to duplicate for now :(\\n// import \"record.proto\";\\n\\nmessage Record {\\n  // adjusted for javascript\\n  optional bytes key = 1;\\n  optional bytes value = 2;\\n  optional bytes author = 3;\\n  optional bytes signature = 4;\\n  optional string timeReceived = 5;\\n}\\n\\nmessage Message {\\n  enum MessageType {\\n    PUT_VALUE = 0;\\n    GET_VALUE = 1;\\n    ADD_PROVIDER = 2;\\n    GET_PROVIDERS = 3;\\n    FIND_NODE = 4;\\n    PING = 5;\\n  }\\n\\n  enum ConnectionType {\\n    // sender does not have a connection to peer, and no extra information (default)\\n    NOT_CONNECTED = 0;\\n\\n    // sender has a live connection to peer\\n    CONNECTED = 1;\\n\\n    // sender recently connected to peer\\n    CAN_CONNECT = 2;\\n\\n    // sender recently tried to connect to peer repeatedly but failed to connect\\n    // (\"try\" here is loose, but this should signal \"made strong effort, failed\")\\n    CANNOT_CONNECT = 3;\\n  }\\n\\n  message Peer {\\n    // ID of a given peer.\\n    optional bytes id = 1;\\n\\n    // multiaddrs for a given peer\\n    repeated bytes addrs = 2;\\n\\n    // used to signal the sender\\'s connection capabilities to the peer\\n    optional ConnectionType connection = 3;\\n  }\\n\\n  // defines what type of message it is.\\n  optional MessageType type = 1;\\n\\n  // defines what coral cluster level this query/response belongs to.\\n  optional int32 clusterLevelRaw = 10;\\n\\n  // Used to specify the key associated with this message.\\n  // PUT_VALUE, GET_VALUE, ADD_PROVIDER, GET_PROVIDERS\\n  // adjusted for javascript\\n  optional bytes key = 2;\\n\\n  // Used to return a value\\n  // PUT_VALUE, GET_VALUE\\n  // adjusted Record to bytes for js\\n  optional bytes record = 3;\\n\\n  // Used to return peers closer to a key in a query\\n  // GET_VALUE, GET_PROVIDERS, FIND_NODE\\n  repeated Peer closerPeers = 8;\\n\\n  // Used to return Providers\\n  // GET_VALUE, ADD_PROVIDER, GET_PROVIDERS\\n  repeated Peer providerPeers = 9;\\n}'},function(e,t,r){\"use strict\";const n=r(1),i=r(33),s=r(59),o=r(523),a=r(37),u=r(78);e.exports=(e=>{const t=a.logger(e.peerInfo.id,\"rpc\"),r=o(e);return function(o,a){var c,f,l;a.getPeerInfo((o,c)=>{if(o)return t.error(\"Failed to get peer info\"),void t.error(o);t(\"from: %s\",c.id.toB58String()),n(a,i.decode(),n.filter(e=>e.length<u.maxMessageSize),n.map(e=>{let r;try{r=s.deserialize(e)}catch(e){return void t.error(\"failed to read incoming message\",e)}return r}),n.filter(Boolean),n.asyncMap((n,i)=>(c=c,n=n,l=i,void e._add(c,e=>{e&&(t.error(\"Failed to update the kbucket store\"),t.error(e));const i=r(n.type);if(!i)return t.error(`no handler found for message type: ${n.type}`),l();i(c,n,l)}))),n.filter(Boolean),n.map(e=>{let r;try{r=e.serialize()}catch(e){return void t.error(\"failed to send message\",e)}return r}),n.filter(Boolean),i.encode(),a)})}})},function(e,t,r){\"use strict\";const n=r(1),i=r(111),s=r(33),o=r(2),a=r(525),u=r(78),c=r(59),f=r(37);function l(e,t,r){n(n.values([t]),s.encode(),e,n.filter(e=>e.length<u.maxMessageSize),s.decode(),n.collect((e,t)=>{if(e)return r(e);if(0===t.length)return r(new Error(\"No message received\"));let n;try{n=c.deserialize(t[0])}catch(e){return r(new Error(\"failed to deserialize response: \"+e.message))}r(null,n)}))}e.exports=class{constructor(e){this.dht=e,this.readMessageTimeout=u.READ_MESSAGE_TIMEOUT,this._log=f.logger(this.dht.peerInfo.id,\"net\"),this._rpc=a(this.dht),this._onPeerConnected=this._onPeerConnected.bind(this),this._running=!1}start(e){const t=t=>o(()=>e(t));return this.isOnline?t(new Error(\"Network is already running\")):this.dht.isStarted?(this._running=!0,this.dht.switch.handle(u.PROTOCOL_DHT,this._rpc),this.dht.switch.on(\"peer-mux-established\",this._onPeerConnected),void t()):t(new Error(\"Can not start network\"))}stop(e){const t=t=>o(()=>e(t));if(!this.dht.isStarted&&!this.isStarted)return t(new Error(\"Network is already stopped\"));this._running=!1,this.dht.switch.removeListener(\"peer-mux-established\",this._onPeerConnected),this.dht.switch.unhandle(u.PROTOCOL_DHT),t()}get isStarted(){return this._running}get isConnected(){return this.dht.isStarted&&this.isStarted}_onPeerConnected(e){if(!this.isConnected)return this._log.error(\"Network is offline\");this.dht.switch.dial(e,u.PROTOCOL_DHT,(t,r)=>{if(t)return this._log(\"%s does not support protocol: %s\",e.id.toB58String(),u.PROTOCOL_DHT);n(n.empty(),r),this.dht._add(e,t=>{if(t)return this._log.error(\"Failed to add to the routing table\",t);this._log(\"added to the routing table: %s\",e.id.toB58String())})})}sendRequest(e,t,r){if(!this.isConnected)return r(new Error(\"Network is offline\"));this._log(\"sending to: %s\",e.toB58String()),this.dht.switch.dial(e,u.PROTOCOL_DHT,(e,n)=>{if(e)return r(e);this._writeReadMessage(n,t.serialize(),r)})}sendMessage(e,t,r){if(!this.isConnected)return o(()=>r(new Error(\"Network is offline\")));this._log(\"sending to: %s\",e.toB58String()),this.dht.switch.dial(e,u.PROTOCOL_DHT,(e,n)=>{if(e)return r(e);this._writeMessage(n,t.serialize(),r)})}_writeReadMessage(e,t,r){i(l,this.readMessageTimeout)(e,t,r)}_writeMessage(e,t,r){n(n.values([t]),s.encode(),e,s.decode(),n.collect(e=>r(e)))}}},function(e,t,r){var n,i,s;(function(){var r,o,a,u,c,f,l,h,p,d,y,m,g,v,b;a=Math.floor,d=Math.min,o=function(e,t){return e<t?-1:e>t?1:0},p=function(e,t,r,n,i){var s;if(null==r&&(r=0),null==i&&(i=o),r<0)throw new Error(\"lo must be non-negative\");for(null==n&&(n=e.length);r<n;)i(t,e[s=a((r+n)/2)])<0?n=s:r=s+1;return[].splice.apply(e,[r,r-r].concat(t)),t},f=function(e,t,r){return null==r&&(r=o),e.push(t),v(e,0,e.length-1,r)},c=function(e,t){var r,n;return null==t&&(t=o),r=e.pop(),e.length?(n=e[0],e[0]=r,b(e,0,t)):n=r,n},h=function(e,t,r){var n;return null==r&&(r=o),n=e[0],e[0]=t,b(e,0,r),n},l=function(e,t,r){var n;return null==r&&(r=o),e.length&&r(e[0],t)<0&&(t=(n=[e[0],t])[0],e[0]=n[1],b(e,0,r)),t},u=function(e,t){var r,n,i,s,u,c;for(null==t&&(t=o),u=[],n=0,i=(s=function(){c=[];for(var t=0,r=a(e.length/2);0<=r?t<r:t>r;0<=r?t++:t--)c.push(t);return c}.apply(this).reverse()).length;n<i;n++)r=s[n],u.push(b(e,r,t));return u},g=function(e,t,r){var n;if(null==r&&(r=o),-1!==(n=e.indexOf(t)))return v(e,0,n,r),b(e,n,r)},y=function(e,t,r){var n,i,s,a,c;if(null==r&&(r=o),!(i=e.slice(0,t)).length)return i;for(u(i,r),s=0,a=(c=e.slice(t)).length;s<a;s++)n=c[s],l(i,n,r);return i.sort(r).reverse()},m=function(e,t,r){var n,i,s,a,f,l,h,y,m;if(null==r&&(r=o),10*t<=e.length){if(!(s=e.slice(0,t).sort(r)).length)return s;for(i=s[s.length-1],a=0,l=(h=e.slice(t)).length;a<l;a++)r(n=h[a],i)<0&&(p(s,n,0,null,r),s.pop(),i=s[s.length-1]);return s}for(u(e,r),m=[],f=0,y=d(t,e.length);0<=y?f<y:f>y;0<=y?++f:--f)m.push(c(e,r));return m},v=function(e,t,r,n){var i,s,a;for(null==n&&(n=o),i=e[r];r>t&&n(i,s=e[a=r-1>>1])<0;)e[r]=s,r=a;return e[r]=i},b=function(e,t,r){var n,i,s,a,u;for(null==r&&(r=o),i=e.length,u=t,s=e[t],n=2*t+1;n<i;)(a=n+1)<i&&!(r(e[n],e[a])<0)&&(n=a),e[t]=e[n],n=2*(t=n)+1;return e[t]=s,v(e,u,t,r)},r=function(){function e(e){this.cmp=null!=e?e:o,this.nodes=[]}return e.push=f,e.pop=c,e.replace=h,e.pushpop=l,e.heapify=u,e.updateItem=g,e.nlargest=y,e.nsmallest=m,e.prototype.push=function(e){return f(this.nodes,e,this.cmp)},e.prototype.pop=function(){return c(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)},e.prototype.replace=function(e){return h(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return l(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return u(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return g(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return(t=new e).nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),i=[],void 0===(s=\"function\"==typeof(n=function(){return r})?n.apply(t,i):n)||(e.exports=s)}).call(this)},function(e,t,r){e.exports=r(527)},function(e,t,r){\"use strict\";const n=r(528),i=r(245),s=r(0),o=r(37),a=s(\"libp2p:dht:peer-queue\");class u{static fromPeerId(e,t){o.convertPeerId(e,(e,r)=>{if(e)return t(e);t(null,new u(r))})}static fromKey(e,t){o.convertBuffer(e,(e,r)=>{if(e)return t(e);t(null,new u(r))})}constructor(e){a(\"create: %s\",e.toString(\"hex\")),this.from=e,this.heap=new n(o.xorCompare)}enqueue(e,t){a(\"enqueue %s\",e.id.toString(\"hex\")),o.convertPeerId(e,(r,n)=>{if(r)return t(r);const s={id:e,distance:i(this.from,n)};this.heap.push(s),t()})}dequeue(){const e=this.heap.pop();return a(\"dequeue %s\",e.id.toB58String()),e.id}get length(){return this.heap.size()}}e.exports=u},function(e,t,r){\"use strict\";e.exports=function(e,t){if(!Buffer.isBuffer(e)||!Buffer.isBuffer(t))throw new TypeError(\"Arguments must be Buffers\");if(e===t)return!0;if(\"function\"==typeof e.equals)return e.equals(t);if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}},function(e,t,r){\"use strict\";var n=r(530),i=r(348),s=r(11).EventEmitter,o=r(75);function a(e){if(s.call(this),e=e||{},this.localNodeId=e.localNodeId||i(20),!Buffer.isBuffer(this.localNodeId))throw new TypeError(\"localNodeId is not a Buffer\");this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=e.numberOfNodesToPing||3,this.distance=e.distance||a.distance,this.arbiter=e.arbiter||a.arbiter,this.root={contacts:[],dontSplit:!1,left:null,right:null},this.metadata=Object.assign({},e.metadata)}e.exports=a,o(a,s),a.arbiter=function(e,t){return e.vectorClock>t.vectorClock?e:t},a.distance=function(e,t){for(var r=0,n=Math.min(e.length,t.length),i=Math.max(e.length,t.length),s=0;s<n;++s)r=256*r+(e[s]^t[s]);for(;s<i;++s)r=256*r+255;return r},a.prototype.add=function(e){if(!e||!Buffer.isBuffer(e.id))throw new TypeError(\"contact.id is not a Buffer\");for(var t=0,r=this.root;null===r.contacts;)r=this._determineNode(r,e.id,t++);var n=this._indexOf(r,e.id);return n>=0?(this._update(r,n,e),this):r.contacts.length<this.numberOfNodesPerKBucket?(r.contacts.push(e),this.emit(\"added\",e),this):r.dontSplit?(this.emit(\"ping\",r.contacts.slice(0,this.numberOfNodesToPing),e),this):(this._split(r,t),this.add(e))},a.prototype.closest=function(e,t){if(!Buffer.isBuffer(e))throw new TypeError(\"id is not a Buffer\");if(void 0===t&&(t=1/0),\"number\"!=typeof t||isNaN(t)||t<=0)throw new TypeError(\"n is not positive number\");for(var r=[],n=[this.root],i=0;n.length>0&&r.length<t;){var s=n.pop();if(null===s.contacts){var o=this._determineNode(s,e,i++);n.push(s.left===o?s.right:s.left),n.push(o)}else r=r.concat(s.contacts)}var a=this;return r.sort(function(t,r){return a.distance(t.id,e)-a.distance(r.id,e)}).slice(0,t)},a.prototype.count=function(){for(var e=0,t=[this.root];t.length>0;){var r=t.pop();null===r.contacts?t.push(r.right,r.left):e+=r.contacts.length}return e},a.prototype._determineNode=function(e,t,r){var n=~~(r/8),i=r%8;return t.length<=n&&0!==i?e.left:t[n]&Math.pow(2,7-i)?e.right:e.left},a.prototype.get=function(e){if(!Buffer.isBuffer(e))throw new TypeError(\"id is not a Buffer\");for(var t=0,r=this.root;null===r.contacts;)r=this._determineNode(r,e,t++);var n=this._indexOf(r,e);return n>=0?r.contacts[n]:null},a.prototype._indexOf=function(e,t){for(var r=0;r<e.contacts.length;++r)if(n(e.contacts[r].id,t))return r;return-1},a.prototype.remove=function(e){if(!Buffer.isBuffer(e))throw new TypeError(\"id is not a Buffer\");for(var t=0,r=this.root;null===r.contacts;)r=this._determineNode(r,e,t++);var n=this._indexOf(r,e);if(n>=0){var i=r.contacts.splice(n,1)[0];this.emit(\"removed\",i)}return this},a.prototype._split=function(e,t){e.left={contacts:[],dontSplit:!1,left:null,right:null},e.right={contacts:[],dontSplit:!1,left:null,right:null};for(var r=0;r<e.contacts.length;++r){var n=e.contacts[r];this._determineNode(e,n.id,t).contacts.push(n)}e.contacts=null;var i=this._determineNode(e,this.localNodeId,t);(e.left===i?e.right:e.left).dontSplit=!0},a.prototype.toArray=function(){for(var e=[],t=[this.root];t.length>0;){var r=t.pop();null===r.contacts?t.push(r.right,r.left):e=e.concat(r.contacts)}return e},a.prototype._update=function(e,t,r){if(!n(e.contacts[t].id,r.id))throw new Error(\"wrong index for _update\");var i=e.contacts[t],s=this.arbiter(i,r);s===i&&i!==r||(e.contacts.splice(t,1),e.contacts.push(s),this.emit(\"updated\",i,s))}},function(e,t,r){\"use strict\";const n=r(531),i=r(37);e.exports=class{constructor(e,t){this.self=e,this._onPing=this._onPing.bind(this),i.convertPeerId(e,(e,r)=>{if(e)throw e;this.kb=new n({localNodeId:r,numberOfNodesPerKBucket:t,numberOfNodesToPing:1}),this.kb.on(\"ping\",this._onPing)})}_onPing(e,t){const r=e[0];this.kb.remove(r.id),this.kb.add(t)}get size(){return this.kb.count()}find(e,t){i.convertPeerId(e,(r,n)=>{if(r)return t(r);const i=this.closestPeer(n);if(i&&i.isEqual(e))return t(null,i);t()})}closestPeer(e,t){const r=this.closestPeers(e,1);if(r.length>0)return r[0]}closestPeers(e,t){return this.kb.closest(e,t).map(e=>e.peer)}add(e,t){i.convertPeerId(e,(r,n)=>{if(r)return t(r);this.kb.add({id:n,peer:e}),t()})}remove(e,t){i.convertPeerId(e,(e,r)=>{if(e)return t(e);this.kb.remove(r),t()})}}},function(e,t,r){\"use strict\";e.exports=((e,t)=>0)},function(e,t,r){\"use strict\";e.exports={pk:r(533)}},function(e,t,r){\"use strict\";const n=r(246);e.exports={bestRecord:(e,t,r)=>{if(0===r.length)throw new Error(\"No records given\");const i=n(t,Buffer.from(\"/\"));if(i.length<3)throw new Error(\"Record key does not have a selector function\");const s=e[i[1].toString()];if(!s)throw new Error(`Unrecognized key prefix: ${i[1]}`);return s(t,r)},selectors:r(534)}},function(e,t,r){\"use strict\";const n=r(2),i=r(31);e.exports={func:(e,t,r)=>{const s=e=>n(()=>r(e));if(!Buffer.isBuffer(e))return s(new Error('\"key\" must be a Buffer'));if(e.length<3)return s(new Error(\"invalid public key record\"));if(\"/pk/\"!==e.slice(0,4).toString())return s(new Error(\"key was not prefixed with /pk/\"));const o=e.slice(4);i(t,\"sha2-256\",(e,t)=>e?s(e):o.equals(t)?void s():s(new Error(\"public key does not match passed in key\")))},sign:!1}},function(e,t,r){\"use strict\";e.exports={pk:r(536)}},function(e,t){e.exports=function(e,t,r){for(var n=0,i=-1,s=r=r||0;s<e.length;++s)if(e[s]==t[n]){if(-1==i&&(i=s),++n==t.length)break}else i=-1,n=0;return i>-1&&e.length-i<t.length?-1:i}},function(e,t,r){\"use strict\";const n=r(246);e.exports={verifyRecord:(e,t,r)=>{const i=t.key,s=n(i,Buffer.from(\"/\"));if(s.length<3)return r();const o=e[s[1].toString()];if(!o)return r(new Error(\"Invalid record keytype\"));o.func(i,t.value,r)},isSigned:(e,t)=>{const r=n(t,Buffer.from(\"/\"));if(r.length<3)return!1;const i=e[r[1].toString()];if(!i)throw new Error(\"Invalid record keytype\");return i.sign},validators:r(537)}},function(e,t,r){\"use strict\";const n=r(217);e.exports.toRFC3339=(e=>{return`${e.getUTCFullYear()}-${n(e.getUTCMonth()+1,2,\"0\")}-${n(e.getUTCDate(),2,\"0\")}T${n(e.getUTCHours(),2,\"0\")}:${n(e.getUTCMinutes(),2,\"0\")}:${n(e.getUTCSeconds(),2,\"0\")}.${1e3*e.getUTCMilliseconds()*1e3}Z`}),e.exports.parseRFC3339=(e=>{const t=new RegExp(\"(\\\\d{4})-(\\\\d{2})-(\\\\d{2})T(\\\\d{2}):(\\\\d{2}):(\\\\d{2})\\\\.(\\\\d+)Z\"),r=String(e).trim().match(t);if(!r)throw new Error(\"Invalid format\");const n=parseInt(r[1],10),i=parseInt(r[2],10)-1,s=parseInt(r[3],10),o=parseInt(r[4],10),a=parseInt(r[5],10),u=parseInt(r[6],10),c=parseInt(r[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,u,c))})},function(e,t,r){\"use strict\";e.exports=\"// Record represents a dht record that contains a value\\n// for a key value pair\\nmessage Record {\\n  // The key that references this record\\n  // adjusted for j\\n  optional bytes key = 1;\\n\\n  // The actual value this record is storing\\n  optional bytes value = 2;\\n\\n  // hash of the authors public key\\n  // converted to bytes for JavaScript\\n  optional bytes author = 3;\\n\\n  // A PKI signature for the key+value+author\\n  optional bytes signature = 4;\\n\\n  // Time the record was received, set by receiver\\n  optional string timeReceived = 5;\\n}\"},function(e,t,r){\"use strict\";const n=r(40),i=r(10),s=r(14),o=n(r(541)).Record,a=r(540);class u{constructor(e,t,r,n){e&&i(Buffer.isBuffer(e),\"key must be a Buffer\"),t&&i(Buffer.isBuffer(t),\"value must be a buffer\"),this.key=e,this.value=t,this.author=r,this.timeReceived=n,this.signature=null}blobForSignature(){return Buffer.concat([Buffer.from(this.key),this.value,this.author.id])}serialize(){return o.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,author:this.author.id,signature:this.signature,timeReceived:this.timeReceived&&a.toRFC3339(this.timeReceived)}}serializeSigned(e,t){const r=this.blobForSignature();e.sign(r,(e,r)=>{if(e)return t(e);let n;this.signature=r;try{n=this.serialize()}catch(e){return t(e)}t(null,n)})}static deserialize(e){const t=o.decode(e);return u.fromDeserialized(t)}static fromDeserialized(e){let t,r;e.timeReceived&&(t=a.parseRFC3339(e.timeReceived)),e.author&&(r=new s(e.author));const n=new u(e.key,e.value,r,t);return n.signature=e.signature,n}verifySignature(e,t){const r=this.blobForSignature();e.verify(r,this.signature,(e,r)=>e?t(e):r?void t():t(new Error(\"Invalid record signature\")))}}e.exports=u},function(e,t,r){\"use strict\";const n=r(92),i=r(9).MemoryDatastore,s=r(3),o=r(18),a=r(111),u=r(14),c=r(27),f=r(49),l=r(532),h=r(37),p=r(78),d=r(244),y=r(526),m=r(243),g=r(516),v=r(512),b=r(59),w=r(10);e.exports=class{constructor(e,t){w(e,\"libp2p-kad-dht requires a instance of Switch\"),t=t||{},this.switch=e,this.kBucketSize=t.kBucketSize||20,this.ncp=t.ncp||6,this.routingTable=new l(this.peerInfo.id,this.kBucketSize),this.datastore=t.datastore||new i,this.providers=new v(this.datastore,this.peerInfo.id),this.validators={pk:n.validator.validators.pk},this.selectors={pk:n.selection.selectors.pk},this.network=new y(this),this._log=h.logger(this.peerInfo.id);const r=g(this);Object.keys(r).forEach(e=>{this[e]=r[e]})}get isStarted(){return this._running}start(e){this._running=!0,this.network.start(e)}stop(e){this._running=!1,this.bootstrapStop(),this.providers.stop(),this.network.stop(e)}get peerInfo(){return this.switch._peerInfo}get peerBook(){return this.switch._peerBook}getClosestPeers(e,t){this._log(\"getClosestPeers to %s\",e.toString()),h.convertBuffer(e,(r,n)=>{if(r)return t(r);const i=this.routingTable.closestPeers(n,p.ALPHA);new d(this,e,(t,r)=>{s([r=>this._closerPeersSingle(e,t,r),(e,t)=>{t(null,{closerPeers:e})}],r)}).run(i,(e,r)=>e?t(e):r&&r.finalSet?void s([e=>h.sortClosestPeers(Array.from(r.finalSet),n,e),(e,t)=>t(null,e.slice(0,p.K))],t):t(null,[]))})}put(e,t,r){let i;this._log(\"PutValue %s\",e);try{i=n.validator.isSigned(this.validators,e)}catch(e){return r(e)}s([r=>h.createPutRecord(e,t,this.peerInfo.id,i,r),(t,r)=>s([r=>this._putLocal(e,t,r),t=>this.getClosestPeers(e,t),(r,n)=>o(r,(r,n)=>{this._putValueToPeer(e,t,r,n)},n)],r)],r)}get(e,t,r){\"function\"==typeof t&&(r=t,t=null),null==t&&(t=p.minute),this._get(e,t,r)}getMany(e,t,r,n){\"function\"==typeof r&&(n=r,r=null),null==r&&(r=p.minute),this._log(\"getMany %s (%s)\",e,t);const i=[];this._getLocal(e,(o,u)=>o&&0===t?n(o):(null==o&&i.push({val:u.value,from:this.peerInfo.id}),t<=1?n(null,i):void s([t=>h.convertBuffer(e,t),(n,s)=>{const o=this.routingTable.closestPeers(n,p.ALPHA);if(this._log(\"peers in rt: %d\",o.length),0===o.length)return this._log.error(\"No peers from routing table!\"),s(new Error(\"Failed to lookup key\"));const u=new d(this,e,(r,n)=>{this._getValueOrPeers(r,e,(e,s,o)=>{if(e&&!(e instanceof m.InvalidRecordError))return n(e);const a={closerPeers:o};(s&&s.value||e instanceof m.InvalidRecordError)&&i.push({val:s&&s.value,from:r}),i.length>=t&&(a.success=!0),n(null,a)})});a(e=>{u.run(o,e)},r)(s)}],e=>{if(e&&0===i.length)return n(e);n(null,i)})))}getPublicKey(e,t){let r;if(this._log(\"getPublicKey %s\",e.toB58String()),this.peerBook.has(e)){if((r=this.peerBook.get(e))&&r.id.pubKey)return this._log(\"getPublicKey: found local copy\"),t(null,r.id.pubKey)}else r=this.peerBook.put(new c(e));this._getPublicKeyFromNode(e,(n,i)=>{if(!n)return r.id=new u(e.id,null,i),this.peerBook.put(r),t(null,i);const s=h.keyForPublicKey(e);this.get(s,(n,i)=>{if(n)return t(n);const s=f.unmarshalPublicKey(i);r.id=new u(e,null,s),this.peerBook.put(r),t(null,s)})})}provide(e,t){this._log(\"provide: %s\",e.toBaseEncodedString()),s([t=>this.providers.addProvider(e,this.peerInfo.id,t),t=>this.getClosestPeers(e.buffer,t),(t,r)=>{const n=new b(b.TYPES.ADD_PROVIDER,e.buffer,0);n.providerPeers=t.map(e=>new c(e)),o(t,(t,r)=>{this._log(\"putProvider %s to %s\",e.toBaseEncodedString(),t.toB58String()),this.network.sendMessage(t,n,r)},r)}],e=>t(e))}findProviders(e,t,r){this._log(\"findProviders %s\",e.toBaseEncodedString()),this._findNProviders(e,t,p.K,r)}findPeer(e,t,r){\"function\"==typeof t&&(r=t,t=null),null==t&&(t=p.minute),this._log(\"findPeer %s\",e.toB58String()),this.findPeerLocal(e,(n,i)=>n?r(n):null!=i?(this._log(\"found local\"),r(null,i)):void s([t=>h.convertPeerId(e,t),(r,n)=>{const i=this.routingTable.closestPeers(r,p.ALPHA);if(0===i.length)return n(new m.LookupFailureError);if(i.find(t=>t.isEqual(e))&&this.peerBook.has(e))return this._log(\"found in peerbook\"),n(null,this.peerBook.get(e));const o=new d(this,e.id,(t,r)=>{s([r=>this._findPeerSingle(t,e,r),(t,r)=>{const n=t.closerPeers.find(t=>t.id.isEqual(e));if(n)return r(null,{peer:n,success:!0});r(null,{closerPeers:t.closerPeers})}],r)});a(e=>{o.run(i,e)},t)(n)},(t,r)=>{if(this._log(\"findPeer %s: %s\",e.toB58String(),t.success),!t.peer)return r(new m.NotFoundError);r(null,t.peer)}],r))}findPeerLocal(e,t){this._log(\"findPeerLocal %s\",e.toB58String()),this.routingTable.find(e,(e,r)=>e?t(e):r&&this.peerBook.has(r)?void t(null,this.peerBook.get(r)):t())}bootstrapStart(e,t,r){null==e&&(e=1),null==t&&(t=5*p.minute),null==r&&(r=10*p.second),this._bootstrapRunning||(this._bootstrapRunning=setInterval(()=>this._bootstrap(e,r),t))}bootstrapStop(){this._bootstrapRunning&&clearInterval(this._bootstrapRunning)}}},function(e,t,r){\"use strict\";const n=r(14),i=r(27),s=r(16),o=r(11).EventEmitter,a=r(0),u=r(2),c=a(\"libp2p:railing\");c.error=a(\"libp2p:railing:error\");e.exports=class extends o{constructor(e){super(),this.bootstrapers=e,this.interval=null}start(e){u(()=>e()),this.interval||(this.interval=setInterval(()=>{this.bootstrapers.forEach(e=>{const t=s(e),r=n.createFromB58String(t.getPeerId());i.create(r,(e,r)=>{if(e)return c.error(\"Invalid bootstrap peer id\",e);r.multiaddrs.add(t),this.emit(\"peer\",r)})})},1e4))}stop(e){u(e),this.interval&&(clearInterval(this.interval),this.interval=null)}}},function(e,t,r){\"use strict\";const n=r(11).EventEmitter;e.exports=function(){const e=new n;let t,r=[];function i(){e.removeAllListeners(\"err\"),e.removeAllListeners(\"data\")}return{append:n=>{if(t)return t;r.push(n),e.emit(\"data\")},prepend:e=>{if(t)return t;r.unshift(e)},error:r=>{t=r,e.emit(\"err\",r)},get:n=>(i(),t?n(t):r.length?n(null,r.shift()):(e.once(\"err\",e=>{i(),n(e)}),void e.once(\"data\",()=>(i(),n(null,r.shift()))))),height:()=>r.length}}},function(e,t,r){\"use strict\";const n=r(545),i=r(247),s=r(1),o=(e,t)=>\"socket.io-pull-stream.\"+e+(t?\".\"+t:\"\"),a=r(0)(\"socket.io-pull-stream\");function u(e,t){if(null==t)return t;try{return e(t)}catch(e){return console.error(\"Codec Error\"),console.error(e),!1}}const c={hex:{encode:e=>e.toString(\"hex\"),decode:e=>Buffer.from(e,\"hex\")},plain:{encode:e=>e,decode:e=>e},buffer:{encode:e=>Buffer.from(e),decode:e=>Buffer.from(e)}};function f(e){if(e||(e=\"plain\"),\"object\"==typeof e)return e;const t=c[e];if(!t)throw new Error(\"Invalid codec \"+e);return t}e.exports=function(e,t){e.createSink||(e.sioplog=e.id?a.bind(a,\"[\"+e.id+\"]\"):a,e.createSink=((r,s)=>{r||(r=i());const a=function(e,t,r){const i=n(),s=e.sioplog.bind(e.sioplog,\"  sink(\"+t+\")\"),a=f(r.codec).encode;let c;function l(e){i.append({err:e}),c=e}return s(\"create sink\"),e.once(o(\"accept\",t),()=>{s(\"start transmission\"),function r(){i.get((n,c)=>{let{data:f,err:l}=c||{};if(n&&(l=n),s(\"send\",l&&!0===l?\"finish\":l?\"error\":f?\"data\":\"<invalid>\"),l&&!n&&i.error(l),l)return e.emit(o(\"error\",t),l);f&&e.emit(o(\"queue\",t),u(a,f)),r()})}()}),e.once(\"disconnect\",()=>l(!0)),function(e){e(null,function t(r,n){return r?l(r):c?e(c,t):(i.append({data:n}),void e(null,t))})}}(e,r,t||s);return a.id=r,a}),e.createSource=((r,i)=>{const s=function(e,t,r){const i=n(),s=e.sioplog.bind(e.sioplog,\"source(\"+t+\")\"),a=f(r.codec).decode;function c(){e.removeAllListeners(o(\"error\",t)),e.removeAllListeners(o(\"queue\",t))}return s(\"create source\"),e.emit(o(\"accept\",t)),e.on(o(\"error\",t),e=>{s(!0===e?\"finish\":\"error\"),c(),i.append({end:e})}),e.on(o(\"queue\",t),e=>{s(\"queue data\"),i.append({data:u(a,e)})}),e.once(\"disconnect\",()=>{c(),i.append({end:!0})}),function(e,t){if(s(\"reading\"),e)return t(e);i.get((e,r)=>e?t(e):r.end?(i.error(r.end),t(r.end)):t(null,r.data))}}(e,r,t||i);return s.id=r,s}),e.createProxy=((t,r,n)=>{s(e.createSource(t,n),r.createSink(t,n))}))}},function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},function(e,t){e.exports=function(e,t){for(var r=[],n=(t=t||0)||0;n<e.length;n++)r[n-t]=e[n];return r}},function(e,t,r){\"use strict\";\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */const n=r(8),i=r(11),s=r(24),o=r(256),a=r(81),u=r(51),c=r(113),f=r(255),l=r(112),h=r(257),p=n.Buffer;function d(){this.destroy()}function y(e,t,r){e.writable&&(r=r||a.STATUS_CODES[t],e.write(`HTTP/1.1 ${t} ${a.STATUS_CODES[t]}\\r\\n`+\"Connection: close\\r\\nContent-type: text/html\\r\\n\"+`Content-Length: ${p.byteLength(r)}\\r\\n`+\"\\r\\n\"+r)),e.removeListener(\"error\",d),e.destroy()}e.exports=class extends i{constructor(e,t){if(super(),null==(e=Object.assign({maxPayload:104857600,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e)).port&&!e.server&&!e.noServer)throw new TypeError(\"missing or invalid options\");null!=e.port?(this._server=a.createServer((e,t)=>{const r=a.STATUS_CODES[426];t.writeHead(426,{\"Content-Length\":r.length,\"Content-Type\":\"text/plain\"}),t.end(r)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._ultron=new o(this._server),this._ultron.on(\"listening\",()=>this.emit(\"listening\")),this._ultron.on(\"error\",e=>this.emit(\"error\",e)),this._ultron.on(\"upgrade\",(e,t,r)=>{this.handleUpgrade(e,t,r,t=>{this.emit(\"connection\",t,e)})})),!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}close(e){if(this.clients)for(const e of this.clients)e.terminate();const t=this._server;if(t&&(this._ultron.destroy(),this._ultron=this._server=null,null!=this.options.port))return t.close(e);e&&e()}shouldHandle(e){return!this.options.path||u.parse(e.url).pathname===this.options.path}handleUpgrade(e,t,r,n){t.on(\"error\",d);const i=+e.headers[\"sec-websocket-version\"],s={};if(\"GET\"!==e.method||\"websocket\"!==e.headers.upgrade.toLowerCase()||!e.headers[\"sec-websocket-key\"]||8!==i&&13!==i||!this.shouldHandle(e))return y(t,400);if(this.options.perMessageDeflate){const r=new c(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const n=f.parse(e.headers[\"sec-websocket-extensions\"]);n[c.extensionName]&&(r.accept(n[c.extensionName]),s[c.extensionName]=r)}catch(e){return y(t,400)}}var o=(e.headers[\"sec-websocket-protocol\"]||\"\").split(/, */);if(this.options.handleProtocols){if(!1===(o=this.options.handleProtocols(o,e)))return y(t,401)}else o=o[0];if(this.options.verifyClient){const a={origin:e.headers[`${8===i?\"sec-websocket-origin\":\"origin\"}`],secure:!(!e.connection.authorized&&!e.connection.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(a,(a,u,c)=>{if(!a)return y(t,u||401,c);this.completeUpgrade(o,s,i,e,t,r,n)});if(!this.options.verifyClient(a))return y(t,401)}this.completeUpgrade(o,s,i,e,t,r,n)}completeUpgrade(e,t,r,n,i,o,a){if(!i.readable||!i.writable)return i.destroy();const u=[\"HTTP/1.1 101 Switching Protocols\",\"Upgrade: websocket\",\"Connection: Upgrade\",`Sec-WebSocket-Accept: ${s.createHash(\"sha1\").update(n.headers[\"sec-websocket-key\"]+l.GUID,\"binary\").digest(\"base64\")}`];if(e&&u.push(`Sec-WebSocket-Protocol: ${e}`),t[c.extensionName]){const e=t[c.extensionName].params,r=f.format({[c.extensionName]:[e]});u.push(`Sec-WebSocket-Extensions: ${r}`)}this.emit(\"headers\",u,n),i.write(u.concat(\"\\r\\n\").join(\"\\r\\n\"));const p=new h([i,o],null,{maxPayload:this.options.maxPayload,protocolVersion:r,extensions:t,protocol:e});this.clients&&(this.clients.add(p),p.on(\"close\",()=>this.clients.delete(p))),i.removeListener(\"error\",d),a(p)}}},function(e,t,r){\"use strict\";\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */try{const t=r(!function(){var e=new Error(\"Cannot find module 'utf-8-validate'\");throw e.code=\"MODULE_NOT_FOUND\",e}());e.exports=\"object\"==typeof t?t.Validation.isValidUTF8:t}catch(t){e.exports=(()=>!0)}},function(e,t,r){\"use strict\";class n{constructor(e,t){this.target=t,this.type=e}}class i extends n{constructor(e,t){super(\"message\",t),this.data=e}}class s extends n{constructor(e,t,r){super(\"close\",r),this.wasClean=r._closeFrameReceived&&r._closeFrameSent,this.reason=t,this.code=e}}class o extends n{constructor(e){super(\"open\",e)}}const a={addEventListener(e,t){function r(e){t.call(this,new i(e,this))}function n(e,r){t.call(this,new s(e,r,this))}function a(e){e.type=\"error\",e.target=this,t.call(this,e)}function u(){t.call(this,new o(this))}\"function\"==typeof t&&(\"message\"===e?(r._listener=t,this.on(e,r)):\"close\"===e?(n._listener=t,this.on(e,n)):\"error\"===e?(a._listener=t,this.on(e,a)):\"open\"===e?(u._listener=t,this.on(e,u)):this.on(e,t))},removeEventListener(e,t){const r=this.listeners(e);for(var n=0;n<r.length;n++)r[n]!==t&&r[n]._listener!==t||this.removeListener(e,r[n])}};e.exports=a},function(e,t,r){\"use strict\";function n(e){if(!(this instanceof n))return new n(e);e=e||{},this.concurrency=e.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=function(){this.pending--,this._run()}.bind(this)}[\"push\",\"unshift\",\"splice\"].forEach(function(e){n.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this._run(),t}}),Object.defineProperty(n.prototype,\"length\",{get:function(){return this.pending+this.jobs.length}}),n.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var e=this.jobs.shift();this.pending++,e(this._done),this._run()}if(0===this.pending)for(;0!==this.cbs.length;){var t=this.cbs.pop();process.nextTick(t)}}},n.prototype.onDone=function(e){\"function\"==typeof e&&(this.cbs.push(e),this._run())},e.exports=n},function(e,t,r){\"use strict\";\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */const n=r(257);n.Server=r(549),n.Receiver=r(254),n.Sender=r(252),e.exports=n},function(e,t,r){var n,i=r(162),s=r(79),o=r(115),a=r(114),u=r(258),c=r(0)(\"engine.io-client:websocket\"),f=global.WebSocket||global.MozWebSocket;if(\"undefined\"==typeof window)try{n=r(553)}catch(e){}var l=f;function h(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=f&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(l=n),i.call(this,e)}l||\"undefined\"!=typeof window||(l=n),e.exports=h,a(h,i),h.prototype.name=\"websocket\",h.prototype.supportsBinary=!0,h.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new l(e,t):new l(e):new l(e,t,r)}catch(e){return this.emit(\"error\",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType=\"nodebuffer\"):this.ws.binaryType=\"arraybuffer\",this.addEventListeners()}},h.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError(\"websocket error\",t)}},h.prototype.write=function(e){var t=this;this.writable=!1;for(var r=e.length,n=0,i=r;n<i;n++)!function(e){s.encodePacket(e,t.supportsBinary,function(n){if(!t.usingBrowserWebSocket){var i={};if(e.options&&(i.compress=e.options.compress),t.perMessageDeflate)(\"string\"==typeof n?global.Buffer.byteLength(n):n.length)<t.perMessageDeflate.threshold&&(i.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(n):t.ws.send(n,i)}catch(e){c(\"websocket closed before onclose event\")}--r||o()})}(e[n]);function o(){t.emit(\"flush\"),setTimeout(function(){t.writable=!0,t.emit(\"drain\")},0)}},h.prototype.onClose=function(){i.prototype.onClose.call(this)},h.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},h.prototype.uri=function(){var e=this.query||{},t=this.secure?\"wss\":\"ws\",r=\"\";return this.port&&(\"wss\"===t&&443!==Number(this.port)||\"ws\"===t&&80!==Number(this.port))&&(r=\":\"+this.port),this.timestampRequests&&(e[this.timestampParam]=u()),this.supportsBinary||(e.b64=1),(e=o.encode(e)).length&&(e=\"?\"+e),t+\"://\"+(-1!==this.hostname.indexOf(\":\")?\"[\"+this.hostname+\"]\":this.hostname)+r+this.path+e},h.prototype.check=function(){return!(!l||\"__initialize\"in l&&this.name===h.prototype.name)}},function(e,t,r){var n=r(260),i=r(114);e.exports=c;var s,o=/\\n/g,a=/\\\\n/g;function u(){}function c(e){n.call(this,e),this.query=this.query||{},s||(global.___eio||(global.___eio=[]),s=global.___eio),this.index=s.length;var t=this;s.push(function(e){t.onData(e)}),this.query.j=this.index,global.document&&global.addEventListener&&global.addEventListener(\"beforeunload\",function(){t.script&&(t.script.onerror=u)},!1)}i(c,n),c.prototype.supportsBinary=!1,c.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},c.prototype.doPoll=function(){var e=this,t=document.createElement(\"script\");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError(\"jsonp poll error\",t)};var r=document.getElementsByTagName(\"script\")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement(\"iframe\");document.body.appendChild(e),document.body.removeChild(e)},100)},c.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n,i=document.createElement(\"form\"),s=document.createElement(\"textarea\"),u=this.iframeId=\"eio_iframe_\"+this.index;i.className=\"socketio\",i.style.position=\"absolute\",i.style.top=\"-1000px\",i.style.left=\"-1000px\",i.target=u,i.method=\"POST\",i.setAttribute(\"accept-charset\",\"utf-8\"),s.name=\"d\",i.appendChild(s),document.body.appendChild(i),this.form=i,this.area=s}function c(){f(),t()}function f(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError(\"jsonp polling iframe removal error\",e)}try{var e='<iframe src=\"javascript:0\" name=\"'+r.iframeId+'\">';n=document.createElement(e)}catch(e){(n=document.createElement(\"iframe\")).name=r.iframeId,n.src=\"javascript:0\"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),f(),e=e.replace(a,\"\\\\\\n\"),this.area.value=e.replace(o,\"\\\\n\");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){\"complete\"===r.iframe.readyState&&c()}:this.iframe.onload=c}},function(e,t){e.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},function(e,t){function r(){}e.exports=function(e,t,n){var i=!1;return n=n||r,s.count=e,0===e?t():s;function s(e,r){if(s.count<=0)throw new Error(\"after called too many times\");--s.count,e?(i=!0,t(e),t=n):0!==s.count||i||t(null,r)}}},function(e,t,r){(function(e){var n;/*! https://mths.be/utf8js v2.1.2 by @mathias */!function(i){var s=\"object\"==typeof t&&t,o=(\"object\"==typeof e&&e&&e.exports,\"object\"==typeof global&&global);o.global!==o&&o.window;var a,u,c,f=String.fromCharCode;function l(e){for(var t,r,n=[],i=0,s=e.length;i<s;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<s?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function h(e,t){if(e>=55296&&e<=57343){if(t)throw Error(\"Lone surrogate U+\"+e.toString(16).toUpperCase()+\" is not a scalar value\");return!1}return!0}function p(e,t){return f(e>>t&63|128)}function d(e,t){if(0==(4294967168&e))return f(e);var r=\"\";return 0==(4294965248&e)?r=f(e>>6&31|192):0==(4294901760&e)?(h(e,t)||(e=65533),r=f(e>>12&15|224),r+=p(e,6)):0==(4292870144&e)&&(r=f(e>>18&7|240),r+=p(e,12),r+=p(e,6)),r+=f(63&e|128)}function y(){if(c>=u)throw Error(\"Invalid byte index\");var e=255&a[c];if(c++,128==(192&e))return 63&e;throw Error(\"Invalid continuation byte\")}function m(e){var t,r;if(c>u)throw Error(\"Invalid byte index\");if(c==u)return!1;if(t=255&a[c],c++,0==(128&t))return t;if(192==(224&t)){if((r=(31&t)<<6|y())>=128)return r;throw Error(\"Invalid continuation byte\")}if(224==(240&t)){if((r=(15&t)<<12|y()<<6|y())>=2048)return h(r,e)?r:65533;throw Error(\"Invalid continuation byte\")}if(240==(248&t)&&(r=(7&t)<<18|y()<<12|y()<<6|y())>=65536&&r<=1114111)return r;throw Error(\"Invalid UTF-8 detected\")}var g={version:\"2.1.2\",encode:function(e,t){for(var r=!1!==(t=t||{}).strict,n=l(e),i=n.length,s=-1,o=\"\";++s<i;)o+=d(n[s],r);return o},decode:function(e,t){var r=!1!==(t=t||{}).strict;a=l(e),u=a.length,c=0;for(var n,i=[];!1!==(n=m(r));)i.push(n);return function(e){for(var t,r=e.length,n=-1,i=\"\";++n<r;)(t=e[n])>65535&&(i+=f((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=f(t);return i}(i)}};void 0===(n=function(){return g}.call(t,r,t,e))||(e.exports=n)}()}).call(this,r(55)(e))},function(e,t,r){var n=r(163),i=r(260),s=r(80),o=r(114),a=r(0)(\"engine.io-client:polling-xhr\");function u(){}function c(e){if(i.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,global.location){var t=\"https:\"===location.protocol,r=location.port;r||(r=t?443:80),this.xd=e.hostname!==global.location.hostname||r!==e.port,this.xs=e.secure!==t}}function f(e){this.method=e.method||\"GET\",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function l(){for(var e in f.requests)f.requests.hasOwnProperty(e)&&f.requests[e].abort()}e.exports=c,e.exports.Request=f,o(c,i),c.prototype.supportsBinary=!0,c.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new f(e)},c.prototype.doWrite=function(e,t){var r=\"string\"!=typeof e&&void 0!==e,n=this.request({method:\"POST\",data:e,isBinary:r}),i=this;n.on(\"success\",t),n.on(\"error\",function(e){i.onError(\"xhr post error\",e)}),this.sendXhr=n},c.prototype.doPoll=function(){a(\"xhr poll\");var e=this.request(),t=this;e.on(\"data\",function(e){t.onData(e)}),e.on(\"error\",function(e){t.onError(\"xhr poll error\",e)}),this.pollXhr=e},s(f.prototype),f.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new n(e),r=this;try{a(\"xhr open %s: %s\",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&t.setRequestHeader(i,this.extraHeaders[i])}catch(e){}if(\"POST\"===this.method)try{this.isBinary?t.setRequestHeader(\"Content-type\",\"application/octet-stream\"):t.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}catch(e){}try{t.setRequestHeader(\"Accept\",\"*/*\")}catch(e){}\"withCredentials\"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader(\"Content-Type\");r.supportsBinary&&\"application/octet-stream\"===e&&(t.responseType=\"arraybuffer\")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?r.onLoad():setTimeout(function(){r.onError(t.status)},0))},a(\"xhr data %s\",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){r.onError(e)},0)}global.document&&(this.index=f.requestsCount++,f.requests[this.index]=this)},f.prototype.onSuccess=function(){this.emit(\"success\"),this.cleanup()},f.prototype.onData=function(e){this.emit(\"data\",e),this.onSuccess()},f.prototype.onError=function(e){this.emit(\"error\",e),this.cleanup(!0)},f.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=u:this.xhr.onreadystatechange=u,e)try{this.xhr.abort()}catch(e){}global.document&&delete f.requests[this.index],this.xhr=null}},f.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader(\"Content-Type\")}catch(e){}e=\"application/octet-stream\"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},f.prototype.hasXDR=function(){return void 0!==global.XDomainRequest&&!this.xs&&this.enablesXDR},f.prototype.abort=function(){this.cleanup()},f.requestsCount=0,f.requests={},global.document&&(global.attachEvent?global.attachEvent(\"onunload\",l):global.addEventListener&&global.addEventListener(\"beforeunload\",l,!1))},function(e,t,r){var n=r(261),i=r(80),s=r(0)(\"engine.io-client:socket\"),o=r(251),a=r(79),u=r(264),c=r(115);function f(e,t){if(!(this instanceof f))return new f(e,t);t=t||{},e&&\"object\"==typeof e&&(t=e,e=null),e?(e=u(e),t.hostname=e.host,t.secure=\"https\"===e.protocol||\"wss\"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=u(t.host).host),this.secure=null!=t.secure?t.secure:global.location&&\"https:\"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?\"443\":\"80\"),this.agent=t.agent||!1,this.hostname=t.hostname||(global.location?location.hostname:\"localhost\"),this.port=t.port||(global.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},\"string\"==typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||\"t\",this.timestampRequests=t.timestampRequests,this.transports=t.transports||[\"polling\",\"websocket\"],this.transportOptions=t.transportOptions||{},this.readyState=\"\",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode;var r=\"object\"==typeof global&&global;r.global===r&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=f,f.priorWebsocketSuccess=!1,i(f.prototype),f.protocol=a.protocol,f.Socket=f,f.Transport=r(162),f.transports=r(261),f.parser=r(79),f.prototype.createTransport=function(e){s('creating transport \"%s\"',e);var t=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(this.query);t.EIO=a.protocol,t.transport=e;var r=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new n[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0})},f.prototype.open=function(){var e;if(this.rememberUpgrade&&f.priorWebsocketSuccess&&-1!==this.transports.indexOf(\"websocket\"))e=\"websocket\";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit(\"error\",\"No transports available\")},0)}e=this.transports[0]}this.readyState=\"opening\";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},f.prototype.setTransport=function(e){s(\"setting transport %s\",e.name);var t=this;this.transport&&(s(\"clearing existing transport %s\",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on(\"drain\",function(){t.onDrain()}).on(\"packet\",function(e){t.onPacket(e)}).on(\"error\",function(e){t.onError(e)}).on(\"close\",function(){t.onClose(\"transport close\")})},f.prototype.probe=function(e){s('probing transport \"%s\"',e);var t=this.createTransport(e,{probe:1}),r=!1,n=this;function i(){if(n.onlyBinaryUpgrades){var i=!this.supportsBinary&&n.transport.supportsBinary;r=r||i}r||(s('probe transport \"%s\" opened',e),t.send([{type:\"ping\",data:\"probe\"}]),t.once(\"packet\",function(i){if(!r)if(\"pong\"===i.type&&\"probe\"===i.data){if(s('probe transport \"%s\" pong',e),n.upgrading=!0,n.emit(\"upgrading\",t),!t)return;f.priorWebsocketSuccess=\"websocket\"===t.name,s('pausing current transport \"%s\"',n.transport.name),n.transport.pause(function(){r||\"closed\"!==n.readyState&&(s(\"changing transport and sending upgrade packet\"),h(),n.setTransport(t),t.send([{type:\"upgrade\"}]),n.emit(\"upgrade\",t),t=null,n.upgrading=!1,n.flush())})}else{s('probe transport \"%s\" failed',e);var o=new Error(\"probe error\");o.transport=t.name,n.emit(\"upgradeError\",o)}}))}function o(){r||(r=!0,h(),t.close(),t=null)}function a(r){var i=new Error(\"probe error: \"+r);i.transport=t.name,o(),s('probe transport \"%s\" failed because of error: %s',e,r),n.emit(\"upgradeError\",i)}function u(){a(\"transport closed\")}function c(){a(\"socket closed\")}function l(e){t&&e.name!==t.name&&(s('\"%s\" works - aborting \"%s\"',e.name,t.name),o())}function h(){t.removeListener(\"open\",i),t.removeListener(\"error\",a),t.removeListener(\"close\",u),n.removeListener(\"close\",c),n.removeListener(\"upgrading\",l)}f.priorWebsocketSuccess=!1,t.once(\"open\",i),t.once(\"error\",a),t.once(\"close\",u),this.once(\"close\",c),this.once(\"upgrading\",l),t.open()},f.prototype.onOpen=function(){if(s(\"socket open\"),this.readyState=\"open\",f.priorWebsocketSuccess=\"websocket\"===this.transport.name,this.emit(\"open\"),this.flush(),\"open\"===this.readyState&&this.upgrade&&this.transport.pause){s(\"starting upgrade probes\");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},f.prototype.onPacket=function(e){if(\"opening\"===this.readyState||\"open\"===this.readyState||\"closing\"===this.readyState)switch(s('socket receive: type \"%s\", data \"%s\"',e.type,e.data),this.emit(\"packet\",e),this.emit(\"heartbeat\"),e.type){case\"open\":this.onHandshake(JSON.parse(e.data));break;case\"pong\":this.setPing(),this.emit(\"pong\");break;case\"error\":var t=new Error(\"server error\");t.code=e.data,this.onError(t);break;case\"message\":this.emit(\"data\",e.data),this.emit(\"message\",e.data)}else s('packet received with socket readyState \"%s\"',this.readyState)},f.prototype.onHandshake=function(e){this.emit(\"handshake\",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),\"closed\"!==this.readyState&&(this.setPing(),this.removeListener(\"heartbeat\",this.onHeartbeat),this.on(\"heartbeat\",this.onHeartbeat))},f.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){\"closed\"!==t.readyState&&t.onClose(\"ping timeout\")},e||t.pingInterval+t.pingTimeout)},f.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){s(\"writing ping packet - expecting pong within %sms\",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},f.prototype.ping=function(){var e=this;this.sendPacket(\"ping\",function(){e.emit(\"ping\")})},f.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit(\"drain\"):this.flush()},f.prototype.flush=function(){\"closed\"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s(\"flushing %d packets in socket\",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit(\"flush\"))},f.prototype.write=f.prototype.send=function(e,t,r){return this.sendPacket(\"message\",e,t,r),this},f.prototype.sendPacket=function(e,t,r,n){if(\"function\"==typeof t&&(n=t,t=void 0),\"function\"==typeof r&&(n=r,r=null),\"closing\"!==this.readyState&&\"closed\"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emit(\"packetCreate\",i),this.writeBuffer.push(i),n&&this.once(\"flush\",n),this.flush()}},f.prototype.close=function(){if(\"opening\"===this.readyState||\"open\"===this.readyState){this.readyState=\"closing\";var e=this;this.writeBuffer.length?this.once(\"drain\",function(){this.upgrading?n():t()}):this.upgrading?n():t()}function t(){e.onClose(\"forced close\"),s(\"socket closing - telling transport to close\"),e.transport.close()}function r(){e.removeListener(\"upgrade\",r),e.removeListener(\"upgradeError\",r),t()}function n(){e.once(\"upgrade\",r),e.once(\"upgradeError\",r)}return this},f.prototype.onError=function(e){s(\"socket error %j\",e),f.priorWebsocketSuccess=!1,this.emit(\"error\",e),this.onClose(\"transport error\",e)},f.prototype.onClose=function(e,t){if(\"opening\"===this.readyState||\"open\"===this.readyState||\"closing\"===this.readyState){s('socket close with reason: \"%s\"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners(\"close\"),this.transport.close(),this.transport.removeAllListeners(),this.readyState=\"closed\",this.id=null,this.emit(\"close\",e,t),this.writeBuffer=[],this.prevBufferLen=0}},f.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~o(this.transports,e[r])&&t.push(e[r]);return t}},function(e,t,r){e.exports=r(560),e.exports.parser=r(79)},function(e,t,r){var n=r(164),i=r(263),s=Object.prototype.toString,o=\"function\"==typeof global.Blob||\"[object BlobConstructor]\"===s.call(global.Blob),a=\"function\"==typeof global.File||\"[object FileConstructor]\"===s.call(global.File);t.deconstructPacket=function(e){var t=[],r=e.data,s=e;return s.data=function e(t,r){if(!t)return t;if(i(t)){var s={_placeholder:!0,num:r.length};return r.push(t),s}if(n(t)){for(var o=new Array(t.length),a=0;a<t.length;a++)o[a]=e(t[a],r);return o}if(\"object\"==typeof t&&!(t instanceof Date)){var o={};for(var u in t)o[u]=e(t[u],r);return o}return t}(r,t),s.attachments=t.length,{packet:s,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(t,r){if(!t)return t;if(t&&t._placeholder)return r[t.num];if(n(t))for(var i=0;i<t.length;i++)t[i]=e(t[i],r);else if(\"object\"==typeof t)for(var s in t)t[s]=e(t[s],r);return t}(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var r=0,s=e;!function e(u,c,f){if(!u)return u;if(o&&u instanceof Blob||a&&u instanceof File){r++;var l=new FileReader;l.onload=function(){f?f[c]=this.result:s=this.result,--r||t(s)},l.readAsArrayBuffer(u)}else if(n(u))for(var h=0;h<u.length;h++)e(u[h],h,u);else if(\"object\"==typeof u&&!i(u))for(var p in u)e(u[p],p,u)}(s),r||t(s)}},function(e,t,r){var n=r(264),i=r(0)(\"socket.io-client:url\");e.exports=function(e,t){var r=e;t=t||global.location,null==e&&(e=t.protocol+\"//\"+t.host);\"string\"==typeof e&&(\"/\"===e.charAt(0)&&(e=\"/\"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\\/\\//.test(e)||(i(\"protocol-less url %s\",e),e=void 0!==t?t.protocol+\"//\"+e:\"https://\"+e),i(\"parse %s\",e),r=n(e));r.port||(/^(http|ws)$/.test(r.protocol)?r.port=\"80\":/^(http|ws)s$/.test(r.protocol)&&(r.port=\"443\"));r.path=r.path||\"/\";var s=-1!==r.host.indexOf(\":\")?\"[\"+r.host+\"]\":r.host;return r.id=r.protocol+\"://\"+s+\":\"+r.port,r.href=r.protocol+\"://\"+s+(t&&t.port===r.port?\"\":\":\"+r.port),r}},function(e,t,r){var n=r(563),i=r(165),s=r(262),o=r(0)(\"socket.io-client\");e.exports=t=u;var a=t.managers={};function u(e,t){\"object\"==typeof e&&(t=e,e=void 0),t=t||{};var r,i=n(e),u=i.source,c=i.id,f=i.path,l=a[c]&&f in a[c].nsps;return t.forceNew||t[\"force new connection\"]||!1===t.multiplex||l?(o(\"ignoring socket cache for %s\",u),r=s(u,t)):(a[c]||(o(\"new io instance for %s\",u),a[c]=s(u,t)),r=a[c]),i.query&&!t.query&&(t.query=i.query),r.socket(i.path,t)}t.protocol=i.protocol,t.connect=u,t.Manager=r(262),t.Socket=r(250)},function(e,t,r){\"use strict\";const n=r(0)(\"libp2p:websocket-star:listener\"),i=r(16),s=r(564),o=r(546),a=r(247),u=r(30),c=r(11).EventEmitter,f=r(32).Connection,l=r(53),h=r(2),p=r(265),d=p.cleanUrlSIO,y=r(49),m=l(()=>{}),g={transports:[\"websocket\"],\"force new connection\":!0};e.exports=class extends c{constructor(e){super(),this.id=e.id,this.log=n.bind(n,\"listener#offline\"),this.canCrypto=Boolean(e.id),this._handler=e.handler||m,this.listeners_list=e.listeners||{},this.flag=e.flag}_up(e){if(e=e?l(e):m,this.io)return e();this.log=n.bind(n,\"listener#\"+this.server),this.log(\"dialing to signalling server\");const t=this.io=s.connect(this.server,g);o(t,{codec:\"buffer\"}),t.once(\"error\",e),t.once(\"connect_error\",e),t.once(\"connect\",e);const r=new p.Protocol(this.log);r.addRequest(\"ws-peer\",[\"multiaddr\"],(e,t)=>this.emit(\"peer\",t)),r.addRequest(\"ss-incomming\",[\"string\",\"multiaddr\",\"function\"],this._incommingDial.bind(this)),r.handleSocket(t)}_down(){this.io&&(this.io.disconnect(),this.emit(\"close\"),delete this.io)}_cryptoChallenge(e){if(!this.io)return e(new Error(\"Not connected\"));const t=this.canCrypto?y.keys.marshalPublicKey(this.id.pubKey).toString(\"hex\"):\"\",r=this.ma.toString();this.io.emit(\"ss-join\",r,t,(t,r)=>{if(t)return e(t);if(r){if(!this.canCrypto)return this._down(),e(new Error(\"Can't sign cryptoChallenge: No id provided\"));this.log(\"performing cryptoChallenge\"),this.id.privKey.sign(Buffer.from(r),(t,r)=>{if(t)return e(t);this.signature=r.toString(\"hex\"),this._join(e)})}else{if(!this.flag)return this._down(),e(new Error('Tried to listen on a server with crypto challenge disabled!\\n    This is prohibited by default and can lead to security issues!\\n    Please set \"allowJoinWithDisabledChallenge\" to true in the constructor options (but only if you know what you are doing)!'));this.signature=\"_\",e()}})}_crypto(e){if(e=e?l(e):m,this.log(\"joining\"),!this.io)return e(new Error(\"Not connected\"));this.signature?this._join((t,r)=>{if(r)return this.cryptoChallenge(e);e(t)}):this._cryptoChallenge(e)}_join(e){this.io.emit(\"ss-join\",this.ma.toString(),this.signature,e)}_incommingDial(e,t,r,n){this.log(\"dial#\"+t+\" incomming from\",r);const s=i(r),o=this.io.createSource(t+\".dialer\"),a=this.io.createSink(t+\".listener\");n();const u=new f({sink:a,source:o},{getObservedAddrs:e=>e(null,[s])});this.emit(\"connection\",u),this._handler(u)}listen(e,t){this.ma=e,this.server=d(e),this.listeners_list[this.server]=this,t=t?l(t):m,u([e=>this._up(e),e=>this._crypto(e)],e=>{if(e)return this.log(\"success\",e),e instanceof Error||(e=new Error(e)),n(e),this._down(),this.emit(\"error\",e),this.emit(\"close\"),t(e);this.log(\"success\"),this.io.on(\"reconnect\",()=>{this.signature=null,this._crypto(e=>{e?(this.log(\"reconnect error\",e),this.emit(\"error\",e)):this.log(\"reconnected\")})}),this.emit(\"listening\"),t()})}getAddrs(e){h(()=>e(null,this.ma?[this.ma]:[]))}close(e){e=e?l(e):m,this._down(),e()}dial(e,t,r){\"function\"==typeof t&&(r=t,t={});const s=i(e),o=new f(null),u=a(),c=this.log.bind(n,\"dial#\"+u);r=r?l(r):m;let h=this.io;if(!h)return r(new Error(\"Not listening\"));const p=h.createSink(u+\".dialer\");return c(\"dialing\",e.toString()),h.emit(\"ss-dial\",this.ma.toString(),e.toString(),u,e=>{if(e)return r(e instanceof Error?e:new Error(e));c(e?\"error: \"+e.toString():\"success\");const t=h.createSource(u+\".listener\");o.setInnerConn({sink:p,source:t},{getObservedAddrs:e=>e(null,[s])}),r(null,o)}),o}}},function(e,t,r){\"use strict\";const n=r(0)(\"libp2p:websocket-star\"),i=r(16),s=r(11).EventEmitter,o=r(14),a=r(27),u=r(32).Connection,c=r(2),f=r(265),l=r(565),h=f.cleanUrlSIO,p=r(60);e.exports=class{constructor(e){e=e||{},this.id=e.id,this.flag=e.allowJoinWithDisabledChallenge,this.discovery=new s,this.discovery.start=(e=>{c(e)}),this.discovery.stop=(e=>{c(e)}),this.listeners_list={},this._peerDiscovered=this._peerDiscovered.bind(this)}lazySetId(e){e&&(this.id=e,this.canCrypto=!0)}dial(e,t,r){let n;\"function\"==typeof t&&(r=t,t={});try{n=h(e)}catch(e){return r(e)}const i=this.listeners_list[n];return i?i.dial(e,t,r):(r(new Error(\"No listener for this server\")),new u)}createListener(e,t){\"function\"==typeof e&&(t=e,e={});const r=new l({id:this.id,handler:t,listeners:this.listeners_list,flag:this.flag});return r.on(\"peer\",this._peerDiscovered),r}filter(e){return Array.isArray(e)||(e=[e]),e.filter(e=>p.WebSocketStar.matches(e))}_peerDiscovered(e){n(\"Peer Discovered:\",e);const t=e.split(\"/ipfs/\").pop(),r=o.createFromB58String(t),s=new a(r);s.multiaddrs.add(i(e)),this.discovery.emit(\"peer\",s)}}},function(e,t,r){(t=e.exports=r(269)).source=r(268),t.sink=r(267),t.createServer=r(266),t.connect=r(280)},function(e,t,r){\"use strict\";const n=r(32).Connection,i=r(118),s=r(16),o=r(64);function a(){}const u=r(266)||a;e.exports=((e,t)=>{const r=u(e=>{e.getObservedAddrs=(e=>e(null,[])),t(new n(e))});let c;return r._listen=r.listen,r.listen=((e,t)=>{t=t||a,c=e,i(e.protoNames(),\"ipfs\")&&(e=e.decapsulate(\"ipfs\")),r._listen(e.toOptions(),t)}),r.getAddrs=(e=>{const t=[],n=r.address();if(!n)return e(new Error(\"Listener is not ready yet\"));let i=c.getPeerId();if(-1!==c.toString().indexOf(\"ip4\")){let e=c.decapsulate(\"tcp\");if(e=e.encapsulate(\"/tcp/\"+n.port+\"/ws\"),c.getPeerId()&&(e=e.encapsulate(\"/ipfs/\"+i)),-1!==e.toString().indexOf(\"0.0.0.0\")){const r=o.networkInterfaces();Object.keys(r).forEach(n=>{r[n].forEach(r=>{\"IPv4\"===r.family&&t.push(s(e.toString().replace(\"0.0.0.0\",r.address)))})})}else t.push(e)}e(null,t)}),r})},function(e,t,r){\"use strict\";const n=r(0)(\"libp2p:websockets:dialer\");e.exports=function(e){const t=e.toString().split(\"/\");let r,i;try{r=e.protoNames().filter(e=>\"ws\"===e||\"wss\"===e)[0]}catch(e){throw n(e),new Error(\"Not a valid websocket address\",e)}try{i=e.stringTuples().filter(t=>{if(t[0]===e.protos().filter(e=>\"tcp\"===e.name)[0].code)return!0})[0][1]}catch(e){n(\"No port, skipping\")}return`${r}://${t[2]}${!i||80===i&&443===i?\"\":`:${i}`}`}},function(e,t,r){var n=r(51);e.exports=function(e,t,r,i){var s;return r=r||{},s=(e=n.parse(e,!1,!0)).protocol?e.protocol:(r[s=t.protocol?t.protocol.replace(/:$/,\"\"):\"http\"]||i||s)+\":\",e.host&&\":\"===e.host[0]&&(e.host=null),e.hostname?n.format({protocol:s,slashes:!0,hostname:e.hostname,port:e.port,pathname:e.pathname,search:e.search}):(e.host=t.host,e.port?n.format({protocol:s,slashes:!0,host:t.hostname+\":\"+e.port,port:e.port,pathname:e.pathname,search:e.search}):e.pathname?n.format({protocol:s,slashes:!0,host:e.host,pathname:e.pathname,search:e.search}):(e.pathname=t.pathname,e.search?n.format({protocol:s,slashes:!0,host:e.host,pathname:e.pathname,search:e.search}):(e.search=t.search,e.format(e))))}},function(e,t,r){var n=r(570),i={http:\"ws\",https:\"wss\"};e.exports=function(e,t){return n(e,t,i,\"ws\")}},function(e,t){e.exports=function(e,t){var r=e&&(e.removeEventListener||e.removeListener);function n(){\"function\"==typeof r&&(r.call(e,\"open\",i),r.call(e,\"error\",s))}function i(e){n(),t()}function s(e){n(),t(e)}return e.readyState>=2?t(!0):1===e.readyState?t():(e.addEventListener(\"open\",i),void e.addEventListener(\"error\",s))}},function(e,t){e.exports=require(\"tls\")},function(e,t,r){\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\nvar n=r(36),i=r(11),s=r(81),o=r(24),a=r(276),u=r(278),c=r(270),f=r(116),l=(r(573),r(51));function h(e,t){if(this instanceof h==!1)return new h(e,t);if(i.EventEmitter.call(this),!(e=new a({host:\"0.0.0.0\",port:null,server:null,verifyClient:null,handleProtocols:null,path:null,noServer:!1,disableHixie:!1,clientTracking:!0,perMessageDeflate:!0,maxPayload:104857600}).merge(e)).isDefinedAndNonNull(\"port\")&&!e.isDefinedAndNonNull(\"server\")&&!e.value.noServer)throw new TypeError(\"`port` or a `server` must be provided\");var r=this;if(e.isDefinedAndNonNull(\"port\"))this._server=s.createServer(function(e,t){var r=s.STATUS_CODES[426];t.writeHead(426,{\"Content-Length\":r.length,\"Content-Type\":\"text/plain\"}),t.end(r)}),this._server.allowHalfOpen=!1,this._server.listen(e.value.port,e.value.host,t),this._closeServer=function(){r._server&&r._server.close()};else if(e.value.server&&(this._server=e.value.server,e.value.path)){if(this._server._webSocketPaths&&e.value.server._webSocketPaths[e.value.path])throw new Error(\"two instances of WebSocketServer cannot listen on the same http server path\");\"object\"!=typeof this._server._webSocketPaths&&(this._server._webSocketPaths={}),this._server._webSocketPaths[e.value.path]=1}this._server&&(this._onceServerListening=function(){r.emit(\"listening\")},this._server.once(\"listening\",this._onceServerListening)),void 0!==this._server&&(this._onServerError=function(e){r.emit(\"error\",e)},this._server.on(\"error\",this._onServerError),this._onServerUpgrade=function(e,t,n){var i=new Buffer(n.length);n.copy(i),r.handleUpgrade(e,t,i,function(t){r.emit(\"connection\"+e.url,t),r.emit(\"connection\",t)})},this._server.on(\"upgrade\",this._onServerUpgrade)),this.options=e.value,this.path=e.value.path,this.clients=[]}function p(e,t,r){try{var n=[\"HTTP/1.1 \"+t+\" \"+r,\"Content-type: text/html\"];e.write(n.concat(\"\",\"\").join(\"\\r\\n\"))}catch(e){}finally{try{e.destroy()}catch(e){}}}n.inherits(h,i.EventEmitter),h.prototype.close=function(e){var t=null;try{for(var r=0,n=this.clients.length;r<n;++r)this.clients[r].terminate()}catch(e){t=e}this.path&&this._server._webSocketPaths&&(delete this._server._webSocketPaths[this.path],0==Object.keys(this._server._webSocketPaths).length&&delete this._server._webSocketPaths);try{void 0!==this._closeServer&&this._closeServer()}finally{this._server&&(this._server.removeListener(\"listening\",this._onceServerListening),this._server.removeListener(\"error\",this._onServerError),this._server.removeListener(\"upgrade\",this._onServerUpgrade)),delete this._server}if(e)e(t);else if(t)throw t},h.prototype.handleUpgrade=function(e,t,r,n){if(this.options.path){var i=l.parse(e.url);if(i&&i.pathname!==this.options.path)return}void 0!==e.headers.upgrade&&\"websocket\"===e.headers.upgrade.toLowerCase()?e.headers[\"sec-websocket-key1\"]?function(e,t,r,n){var i=function(){try{t.destroy()}catch(e){}};if(t.on(\"error\",i),this.options.disableHixie)return void p(t,401,\"Hixie support disabled\");if(!e.headers[\"sec-websocket-key2\"])return void p(t,400,\"Bad Request\");var a=e.headers.origin,c=this,f=function(){var s;s=e.headers[\"x-forwarded-host\"]?e.headers[\"x-forwarded-host\"]:e.headers.host;var f=(\"https\"===e.headers[\"x-forwarded-proto\"]||t.encrypted?\"wss\":\"ws\")+\"://\"+s+e.url,l=e.headers[\"sec-websocket-protocol\"],h=function(){var e=[\"HTTP/1.1 101 Switching Protocols\",\"Upgrade: WebSocket\",\"Connection: Upgrade\",\"Sec-WebSocket-Location: \"+f];return void 0!==l&&e.push(\"Sec-WebSocket-Protocol: \"+l),void 0!==a&&e.push(\"Sec-WebSocket-Origin: \"+a),new Buffer(e.concat(\"\",\"\").join(\"\\r\\n\"))},d=function(r,s,a){var f=e.headers[\"sec-websocket-key1\"],h=e.headers[\"sec-websocket-key2\"],d=o.createHash(\"md5\");[f,h].forEach(function(e){var r=parseInt(e.replace(/[^\\d]/g,\"\")),n=e.replace(/[^ ]/g,\"\").length;0!==n&&r%n==0?(r/=n,d.update(String.fromCharCode(r>>24&255,r>>16&255,r>>8&255,255&r))):p(t,400,\"Bad Request\")}),d.update(r.toString(\"binary\")),t.setTimeout(0),t.setNoDelay(!0);try{var y=new Buffer(d.digest(\"binary\"),\"binary\"),m=new Buffer(a.length+y.length);a.copy(m,0),y.copy(m,a.length),t.write(m,\"binary\",function(r){if(!r){var o=new u([e,t,s],{protocolVersion:\"hixie-76\",protocol:l});c.options.clientTracking&&(c.clients.push(o),o.on(\"close\",function(){var e=c.clients.indexOf(o);-1!=e&&c.clients.splice(e,1)})),t.removeListener(\"error\",i),n(o)}})}catch(e){try{t.destroy()}catch(e){}return}};if(r&&r.length>=8){var y=r.slice(0,8),m=r.length>8?r.slice(8):null;d.call(c,y,m,h())}else{var y=new Buffer(8);r.copy(y,0);var g=r.length,m=null,v=function(e){var r=Math.min(e.length,8-g);0!==r&&(e.copy(y,g,0,r),8==(g+=r)&&(t.removeListener(\"data\",v),r<e.length&&(m=e.slice(r)),d.call(c,y,m,new Buffer(0))))};t.on(\"data\",v),function(){t.setTimeout(0),t.setNoDelay(!0);var e=h();try{t.write(e,\"binary\",function(e){e&&t.removeListener(\"data\",v)})}catch(e){try{t.destroy()}catch(e){}return}}()}};if(\"function\"==typeof this.options.verifyClient){var l={origin:a,secure:void 0!==e.connection.authorized||void 0!==e.connection.encrypted,req:e};if(2==this.options.verifyClient.length){var c=this;return void this.options.verifyClient(l,function(e,r,n){void 0===r&&(r=401),void 0===n&&(n=s.STATUS_CODES[r]),e?f.apply(c):p(t,r,n)})}if(!this.options.verifyClient(l))return void p(t,401,\"Unauthorized\")}f()}.apply(this,arguments):function(e,t,r,n){var i=function(){try{t.destroy()}catch(e){}};if(t.on(\"error\",i),!e.headers[\"sec-websocket-key\"])return void p(t,400,\"Bad Request\");var a=parseInt(e.headers[\"sec-websocket-version\"]);if(-1===[8,13].indexOf(a))return void p(t,400,\"Bad Request\");var l=e.headers[\"sec-websocket-protocol\"],h=a<13?e.headers[\"sec-websocket-origin\"]:e.headers.origin,d=c.parse(e.headers[\"sec-websocket-extensions\"]),y=this,m=function(s){var l=e.headers[\"sec-websocket-key\"],h=o.createHash(\"sha1\");h.update(l+\"258EAFA5-E914-47DA-95CA-C5AB0DC85B11\");var m=[\"HTTP/1.1 101 Switching Protocols\",\"Upgrade: websocket\",\"Connection: Upgrade\",\"Sec-WebSocket-Accept: \"+(l=h.digest(\"base64\"))];void 0!==s&&m.push(\"Sec-WebSocket-Protocol: \"+s);var g={};try{g=function(e){var t={},r=this.options.perMessageDeflate,n=this.options.maxPayload;if(r&&e[f.extensionName]){var i=new f(!0!==r?r:{},!0,n);i.accept(e[f.extensionName]),t[f.extensionName]=i}return t}.call(y,d)}catch(e){return void p(t,400,\"Bad Request\")}if(Object.keys(g).length){var v={};Object.keys(g).forEach(function(e){v[e]=[g[e].params]}),m.push(\"Sec-WebSocket-Extensions: \"+c.format(v))}y.emit(\"headers\",m),t.setTimeout(0),t.setNoDelay(!0);try{t.write(m.concat(\"\",\"\").join(\"\\r\\n\"))}catch(e){try{t.destroy()}catch(e){}return}var b=new u([e,t,r],{protocolVersion:a,protocol:s,extensions:g,maxPayload:y.options.maxPayload});y.options.clientTracking&&(y.clients.push(b),b.on(\"close\",function(){var e=y.clients.indexOf(b);-1!=e&&y.clients.splice(e,1)})),t.removeListener(\"error\",i),n(b)},g=function(){if(\"function\"!=typeof y.options.handleProtocols)void 0!==l?m(l.split(/, */)[0]):m();else{var e=(l||\"\").split(/, */),r=!1;y.options.handleProtocols(e,function(e,n){r=!0,e?m(n):p(t,401,\"Unauthorized\")});r||p(t,501,\"Could not process protocols\")}};if(\"function\"==typeof this.options.verifyClient){var v={origin:h,secure:void 0!==e.connection.authorized||void 0!==e.connection.encrypted,req:e};if(2==this.options.verifyClient.length)return void this.options.verifyClient(v,function(e,r,n){void 0===r&&(r=401),void 0===n&&(n=s.STATUS_CODES[r]),e?g():p(t,r,n)});if(!this.options.verifyClient(v))return void p(t,401,\"Unauthorized\")}g()}.apply(this,arguments):p(t,400,\"Bad Request\")},e.exports=h},function(e,t,r){\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\nr(36);var n=0,i=1,s=2,o=3;function a(){if(this instanceof a==!1)throw new TypeError(\"Classes can't be function-called\");this.state=n,this.buffers=[],this.messageEnd=-1,this.spanLength=0,this.dead=!1,this.onerror=function(){},this.ontext=function(){},this.onbinary=function(){},this.onclose=function(){},this.onping=function(){},this.onpong=function(){}}e.exports=a,a.prototype.add=function(e){if(!this.dead)for(var t=this;e;)e=r();function r(){if(t.state===n){if(2==e.length&&255==e[0]&&0==e[1])return t.reset(),void t.onclose();if(128===e[0])t.messageEnd=0,t.state=s,e=e.slice(1);else{if(0!==e[0])return void t.error(\"payload must start with 0x00 byte\",!0);e=e.slice(1),t.state=i}}if(t.state===s){for(var r=0;r<e.length&&128&e[r];)t.messageEnd=128*t.messageEnd+(127&e[r]),++r;r<e.length&&(t.messageEnd=128*t.messageEnd+(127&e[r]),t.state=o,++r),r>0&&(e=e.slice(r))}if(t.state===o){var a=t.messageEnd-t.spanLength;return e.length>=a?(t.buffers.push(e),t.spanLength+=a,t.messageEnd=a,t.parse()):(t.buffers.push(e),void(t.spanLength+=e.length))}if(t.buffers.push(e),-1!=(t.messageEnd=function(e,t){for(var r=0,n=e.length;r<n;++r)if(e[r]===t)return r;return-1}(e,255)))return t.spanLength+=t.messageEnd,t.parse();t.spanLength+=e.length}},a.prototype.cleanup=function(){this.dead=!0,this.state=n,this.buffers=[]},a.prototype.parse=function(){for(var e=new Buffer(this.spanLength),t=0,r=0,n=this.buffers.length;r<n-1;++r){var s=this.buffers[r];s.copy(e,t),t+=s.length}var o=this.buffers[this.buffers.length-1];this.messageEnd>0&&o.copy(e,t,0,this.messageEnd),this.state!==i&&--this.messageEnd;var a=null;return this.messageEnd<o.length-1&&(a=o.slice(this.messageEnd+1)),this.reset(),this.ontext(e.toString(\"utf8\")),a},a.prototype.error=function(e,t){if(!this.dead)return this.reset(),\"string\"==typeof e?this.onerror(new Error(e),t):e.constructor==Error?this.onerror(e,t):this.onerror(new Error(\"An error occured\"),t),this},a.prototype.reset=function(e){this.dead||(this.state=n,this.buffers=[],this.messageEnd=-1,this.spanLength=0)}},function(e,t,r){\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\nvar n=r(11),i=r(36);n.EventEmitter;function s(e){if(this instanceof s==!1)throw new TypeError(\"Classes can't be function-called\");n.EventEmitter.call(this),this.socket=e,this.continuationFrame=!1,this.isClosed=!1}e.exports=s,i.inherits(s,n.EventEmitter),s.prototype.send=function(e,t,r){if(!this.isClosed){var n=\"string\"==typeof e,i=n?Buffer.byteLength(e):e.length,s=i>127?2:1,o=0==this.continuationFrame,a=!t||!(void 0!==t.fin&&!t.fin),u=new Buffer((o?t&&t.binary?1+s:1:0)+i+(!a||t&&t.binary?0:1)),c=o?1:0;o&&(t&&t.binary?(u.write(\"Â€\",\"binary\"),s>1&&u.write(String.fromCharCode(128+i/128),c++,\"binary\"),u.write(String.fromCharCode(127&i),c++,\"binary\")):u.write(\"\\0\",\"binary\")),n?u.write(e,c,\"utf8\"):e.copy(u,c,0),a?(t&&t.binary||u.write(\"Ã¿\",c+i,\"binary\"),this.continuationFrame=!1):this.continuationFrame=!0;try{this.socket.write(u,\"binary\",r)}catch(e){this.error(e.toString())}}},s.prototype.close=function(e,t,r,n){if(!this.isClosed){this.isClosed=!0;try{this.continuationFrame&&this.socket.write(new Buffer([255],\"binary\")),this.socket.write(new Buffer([255,0]),\"binary\",n)}catch(e){this.error(e.toString())}}},s.prototype.ping=function(e,t){},s.prototype.pong=function(e,t){},s.prototype.error=function(e){return this.emit(\"error\",e),this}},function(e,t,r){\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\nr(36);function n(e,t,r){if(this instanceof n==!1)throw new TypeError(\"Classes can't be function-called\");\"function\"==typeof e?(r=t,t=e,e=0):void 0===e&&(e=0),this._growStrategy=(t||function(e,t){return e.used+t}).bind(null,this),this._shrinkStrategy=(r||function(t){return e}).bind(null,this),this._buffer=e?new Buffer(e):null,this._offset=0,this._used=0,this._changeFactor=0,this.__defineGetter__(\"size\",function(){return null==this._buffer?0:this._buffer.length}),this.__defineGetter__(\"used\",function(){return this._used})}n.prototype.get=function(e){if(null==this._buffer||this._offset+e>this._buffer.length){var t=new Buffer(this._growStrategy(e));this._buffer=t,this._offset=0}this._used+=e;var r=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,r},n.prototype.reset=function(e){var t=this._shrinkStrategy();t<this.size&&(this._changeFactor-=1),(e||this._changeFactor<-2)&&(this._changeFactor=0,this._buffer=t?new Buffer(t):null),this._offset=0,this._used=0},e.exports=n},function(e,t){\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\nt.Validation={isValidUTF8:function(e){return!0}}},function(e,t,r){\"use strict\";\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */var n;try{n=r(!function(){var e=new Error(\"Cannot find module 'utf-8-validate'\");throw e.code=\"MODULE_NOT_FOUND\",e}())}catch(e){n=r(578)}e.exports=\"object\"==typeof n?n.Validation.isValidUTF8:n},function(e,t){\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\nt.BufferUtil={merge:function(e,t){for(var r=0,n=0,i=t.length;n<i;++n){var s=t[n];s.copy(e,r),r+=s.length}},mask:function(e,t,r,n,i){for(var s=t.readUInt32LE(0,!0),o=0;o<i-3;o+=4){var a=s^e.readUInt32LE(o,!0);a<0&&(a=4294967296+a),r.writeUInt32LE(a,n+o,!0)}switch(i%4){case 3:r[n+o+2]=e[o+2]^t[2];case 2:r[n+o+1]=e[o+1]^t[1];case 1:r[n+o]=e[o]^t[0]}},unmask:function(e,t){for(var r=t.readUInt32LE(0,!0),n=e.length,i=0;i<n-3;i+=4){var s=r^e.readUInt32LE(i,!0);s<0&&(s=4294967296+s),e.writeUInt32LE(s,i,!0)}switch(n%4){case 3:e[i+2]=e[i+2]^t[2];case 2:e[i+1]=e[i+1]^t[1];case 1:e[i]=e[i]^t[0]}}}},function(e,t,r){\"use strict\";var n=Object.prototype.hasOwnProperty,i=0;function s(e){if(!(this instanceof s))return new s(e);this.id=i++,this.ee=e}s.prototype.on=function(e,t,r){return t.__ultron=this.id,this.ee.on(e,t,r),this},s.prototype.once=function(e,t,r){return t.__ultron=this.id,this.ee.once(e,t,r),this},s.prototype.remove=function(){var e,t=arguments;if(1===t.length&&\"string\"==typeof t[0])t=t[0].split(/[, ]+/);else if(!t.length)for(e in t=[],this.ee._events)n.call(this.ee._events,e)&&t.push(e);for(var r=0;r<t.length;r++)for(var i=this.ee.listeners(t[r]),s=0;s<i.length;s++){if((e=i[s]).listener){if(e.listener.__ultron!==this.id)continue;delete e.listener.__ultron}else{if(e.__ultron!==this.id)continue;delete e.__ultron}this.ee.removeListener(t[r],e)}return this},s.prototype.destroy=function(){return!!this.ee&&(this.remove(),this.ee=null,!0)},e.exports=s},function(e,t,r){e.exports=\"undefined\"==typeof WebSocket?r(279):WebSocket},function(e,t,r){\"use strict\";const n=r(280),i=r(60),s=r(118),o=r(32).Connection,a=r(569),u=r(0)(\"libp2p:websockets:dialer\"),c=r(568);e.exports=class{dial(e,t,r){\"function\"==typeof t&&(r=t,t={}),r=r||function(){};const i=a(e);u(\"dialing %s\",i);const s=n(i,{binary:!0,onConnect:e=>{r(e)}}),c=new o(s);return c.getObservedAddrs=(t=>t(null,[e])),c.close=(e=>s.close(e)),c}createListener(e,t){return\"function\"==typeof e&&(t=e,e={}),c(e,t)}filter(e){return Array.isArray(e)||(e=[e]),e.filter(e=>!s(e.protoNames(),\"p2p-circuit\")&&(s(e.protoNames(),\"ipfs\")&&(e=e.decapsulate(\"ipfs\")),i.WebSockets.matches(e)||i.WebSocketsSecure.matches(e)))}}},function(e,t,r){\"use strict\";const n=r(27),i=r(64),s=r(0)(\"libp2p:mdns\"),o=r(16),a=r(14),u=new(r(287));e.exports={queryLAN:function(e,t,r){return setInterval(()=>{e.query({questions:[{name:t,type:\"PTR\"}]})},r)},gotResponse:function(e,t,r,i){if(!e.answers)return;const u={ptr:{},srv:{},txt:{},a:[],aaaa:[]};if(e.answers.forEach(e=>{switch(e.type){case\"PTR\":u.ptr=e;break;case\"SRV\":u.srv=e;break;case\"TXT\":u.txt=e;break;case\"A\":u.a.push(e);break;case\"AAAA\":u.aaaa.push(e)}}),u.ptr.name!==r)return;const c=u.txt.data.toString(),f=u.srv.data.port,l=[];if(u.a.forEach(e=>{l.push(new o(\"/ip4/\"+e.data+\"/tcp/\"+f))}),t.id.toB58String()===c)return;s(\"peer found -\",c);const h=a.createFromB58String(c);n.create(h,(e,t)=>{if(e)return s(\"Error creating PeerInfo from new found peer\",e);l.forEach(e=>t.multiaddrs.add(e)),i(null,t)})},gotQuery:function(e,t,r,n,s){if(!s)return;const o=u.filter(r.multiaddrs.toArray());if(0!==o.length&&e.questions[0]&&e.questions[0].name===n){const e=[];e.push({name:n,type:\"PTR\",class:1,ttl:120,data:r.id.toB58String()+\".\"+n});const s=o[0].toString().split(\"/\")[4];e.push({name:r.id.toB58String()+\".\"+n,type:\"SRV\",class:1,ttl:120,data:{priority:10,weight:1,port:s,target:i.hostname()}}),e.push({name:r.id.toB58String()+\".\"+n,type:\"TXT\",class:1,ttl:120,data:r.id.toB58String()}),o.forEach(t=>{\"ip4\"!==t.protoNames()[0]?\"ip6\"===t.protoNames()[0]&&e.push({name:i.hostname(),type:\"AAAA\",class:1,ttl:120,data:t.toString().split(\"/\")[2]}):e.push({name:i.hostname(),type:\"A\",class:1,ttl:120,data:t.toString().split(\"/\")[2]})}),t.respond(e)}}}},function(e,t,r){\"use strict\";var n=function(e,t,r){process.nextTick(function(){e(t,r)})};function i(){}function s(e,t){e.apply(null,t)}process.nextTick(function(e){42===e&&(n=process.nextTick)},42),e.exports=function(e){var t=function(i){var o=[i];t=function(e){o.push(e)};e(function(e){var i=arguments;t=function(e){return\"[object Error]\"===Object.prototype.toString.call(e)}(e)?r:a;for(;o.length;)a(o.shift());function a(e){n(s,e,i)}})};return function(e){t(e||i)};function r(i){var o=[i];t=function(e){o.push(e)},e(function(e){var i=arguments;t=function(e){return\"[object Error]\"===Object.prototype.toString.call(e)}(e)?r:a;for(;o.length;)a(o.shift());function a(e){n(s,e,i)}})}}},function(e,t){e.exports=require(\"dgram\")},function(e,t){t.toString=function(e){switch(e){case 0:return\"QUERY\";case 1:return\"IQUERY\";case 2:return\"STATUS\";case 3:return\"OPCODE_3\";case 4:return\"NOTIFY\";case 5:return\"UPDATE\";case 6:return\"OPCODE_6\";case 7:return\"OPCODE_7\";case 8:return\"OPCODE_8\";case 9:return\"OPCODE_9\";case 10:return\"OPCODE_10\";case 11:return\"OPCODE_11\";case 12:return\"OPCODE_12\";case 13:return\"OPCODE_13\";case 14:return\"OPCODE_14\";case 15:return\"OPCODE_15\"}return\"OPCODE_\"+e},t.toOpcode=function(e){switch(e.toUpperCase()){case\"QUERY\":return 0;case\"IQUERY\":return 1;case\"STATUS\":return 2;case\"OPCODE_3\":return 3;case\"NOTIFY\":return 4;case\"UPDATE\":return 5;case\"OPCODE_6\":return 6;case\"OPCODE_7\":return 7;case\"OPCODE_8\":return 8;case\"OPCODE_9\":return 9;case\"OPCODE_10\":return 10;case\"OPCODE_11\":return 11;case\"OPCODE_12\":return 12;case\"OPCODE_13\":return 13;case\"OPCODE_14\":return 14;case\"OPCODE_15\":return 15}return 0}},function(e,t){t.toString=function(e){switch(e){case 0:return\"NOERROR\";case 1:return\"FORMERR\";case 2:return\"SERVFAIL\";case 3:return\"NXDOMAIN\";case 4:return\"NOTIMP\";case 5:return\"REFUSED\";case 6:return\"YXDOMAIN\";case 7:return\"YXRRSET\";case 8:return\"NXRRSET\";case 9:return\"NOTAUTH\";case 10:return\"NOTZONE\";case 11:return\"RCODE_11\";case 12:return\"RCODE_12\";case 13:return\"RCODE_13\";case 14:return\"RCODE_14\";case 15:return\"RCODE_15\"}return\"RCODE_\"+e},t.toRcode=function(e){switch(e.toUpperCase()){case\"NOERROR\":return 0;case\"FORMERR\":return 1;case\"SERVFAIL\":return 2;case\"NXDOMAIN\":return 3;case\"NOTIMP\":return 4;case\"REFUSED\":return 5;case\"YXDOMAIN\":return 6;case\"YXRRSET\":return 7;case\"NXRRSET\":return 8;case\"NOTAUTH\":return 9;case\"NOTZONE\":return 10;case\"RCODE_11\":return 11;case\"RCODE_12\":return 12;case\"RCODE_13\":return 13;case\"RCODE_14\":return 14;case\"RCODE_15\":return 15}return 0}},function(e,t){t.toString=function(e){switch(e){case 1:return\"A\";case 10:return\"NULL\";case 28:return\"AAAA\";case 18:return\"AFSDB\";case 42:return\"APL\";case 257:return\"CAA\";case 60:return\"CDNSKEY\";case 59:return\"CDS\";case 37:return\"CERT\";case 5:return\"CNAME\";case 49:return\"DHCID\";case 32769:return\"DLV\";case 39:return\"DNAME\";case 48:return\"DNSKEY\";case 43:return\"DS\";case 55:return\"HIP\";case 13:return\"HINFO\";case 45:return\"IPSECKEY\";case 25:return\"KEY\";case 36:return\"KX\";case 29:return\"LOC\";case 15:return\"MX\";case 35:return\"NAPTR\";case 2:return\"NS\";case 47:return\"NSEC\";case 50:return\"NSEC3\";case 51:return\"NSEC3PARAM\";case 12:return\"PTR\";case 46:return\"RRSIG\";case 17:return\"RP\";case 24:return\"SIG\";case 6:return\"SOA\";case 99:return\"SPF\";case 33:return\"SRV\";case 44:return\"SSHFP\";case 32768:return\"TA\";case 249:return\"TKEY\";case 52:return\"TLSA\";case 250:return\"TSIG\";case 16:return\"TXT\";case 252:return\"AXFR\";case 251:return\"IXFR\";case 41:return\"OPT\";case 255:return\"ANY\"}return\"UNKNOWN_\"+e},t.toType=function(e){switch(e.toUpperCase()){case\"A\":return 1;case\"NULL\":return 10;case\"AAAA\":return 28;case\"AFSDB\":return 18;case\"APL\":return 42;case\"CAA\":return 257;case\"CDNSKEY\":return 60;case\"CDS\":return 59;case\"CERT\":return 37;case\"CNAME\":return 5;case\"DHCID\":return 49;case\"DLV\":return 32769;case\"DNAME\":return 39;case\"DNSKEY\":return 48;case\"DS\":return 43;case\"HIP\":return 55;case\"HINFO\":return 13;case\"IPSECKEY\":return 45;case\"KEY\":return 25;case\"KX\":return 36;case\"LOC\":return 29;case\"MX\":return 15;case\"NAPTR\":return 35;case\"NS\":return 2;case\"NSEC\":return 47;case\"NSEC3\":return 50;case\"NSEC3PARAM\":return 51;case\"PTR\":return 12;case\"RRSIG\":return 46;case\"RP\":return 17;case\"SIG\":return 24;case\"SOA\":return 6;case\"SPF\":return 99;case\"SRV\":return 33;case\"SSHFP\":return 44;case\"TA\":return 32768;case\"TKEY\":return 249;case\"TLSA\":return 52;case\"TSIG\":return 250;case\"TXT\":return 16;case\"AXFR\":return 252;case\"IXFR\":return 251;case\"OPT\":return 41;case\"ANY\":case\"*\":return 255}return 0}},function(e,t,r){var n=r(589),i=r(588),s=r(587),o=r(307),a=r(8).Buffer,u=t.txt=t.name={};u.encode=function(e,t,r){t||(t=a.allocUnsafe(u.encodingLength(e))),r||(r=0);var n=r,i=e.replace(/^\\.|\\.$/gm,\"\");if(i.length)for(var s=i.split(\".\"),o=0;o<s.length;o++){var c=t.write(s[o],r+1);t[r]=c,r+=c+1}return t[r++]=0,u.encode.bytes=r-n,t},u.encode.bytes=0,u.decode=function(e,t){t||(t=0);var r=[],n=t,i=e[t++];if(0===i)return u.decode.bytes=1,\".\";if(i>=192){var s=u.decode(e,e.readUInt16BE(t-1)-49152);return u.decode.bytes=2,s}for(;i;){if(i>=192){r.push(u.decode(e,e.readUInt16BE(t-1)-49152)),t++;break}r.push(e.toString(\"utf-8\",t,t+i)),t+=i,i=e[t++]}return u.decode.bytes=t-n,r.join(\".\")},u.decode.bytes=0,u.encodingLength=function(e){return a.byteLength(e)+2};var c={encode:function(e,t,r){t||(t=a.allocUnsafe(c.encodingLength(e))),r||(r=0);var n=t.write(e,r+1);return t[r]=n,c.encode.bytes=n+1,t}};c.encode.bytes=0,c.decode=function(e,t){t||(t=0);var r=e[t],n=e.toString(\"utf-8\",t+1,t+1+r);return c.decode.bytes=r+1,n},c.decode.bytes=0,c.encodingLength=function(e){return a.byteLength(e)+1};var f={encode:function(e,t,r){t||(t=f.encodingLength(e)),r||(r=0);var n=32767&(e.flags||0),i=\"response\"===e.type?32768:0;return t.writeUInt16BE(e.id||0,r),t.writeUInt16BE(n|i,r+2),t.writeUInt16BE(e.questions.length,r+4),t.writeUInt16BE(e.answers.length,r+6),t.writeUInt16BE(e.authorities.length,r+8),t.writeUInt16BE(e.additionals.length,r+10),t}};f.encode.bytes=12,f.decode=function(e,t){if(t||(t=0),e.length<12)throw new Error(\"Header must be 12 bytes\");var r=e.readUInt16BE(t+2);return{id:e.readUInt16BE(t),type:32768&r?\"response\":\"query\",flags:32767&r,flag_qr:1==(r>>15&1),opcode:s.toString(r>>11&15),flag_auth:1==(r>>10&1),flag_trunc:1==(r>>9&1),flag_rd:1==(r>>8&1),flag_ra:1==(r>>7&1),flag_z:1==(r>>6&1),flag_ad:1==(r>>5&1),flag_cd:1==(r>>4&1),rcode:i.toString(15&r),questions:new Array(e.readUInt16BE(t+4)),answers:new Array(e.readUInt16BE(t+6)),authorities:new Array(e.readUInt16BE(t+8)),additionals:new Array(e.readUInt16BE(t+10))}},f.decode.bytes=12,f.encodingLength=function(){return 12};var l=t.unknown={};l.encode=function(e,t,r){return t||(t=a.allocUnsafe(l.encodingLength(e))),r||(r=0),t.writeUInt16BE(e.length,r),e.copy(t,r+2),l.encode.bytes=e.length+2,t},l.encode.bytes=0,l.decode=function(e,t){t||(t=0);var r=e.readUInt16BE(t),n=e.slice(t+2,t+2+r);return l.decode.bytes=r+2,n},l.decode.bytes=0,l.encodingLength=function(e){return e.length+2};var h=t.ns={};h.encode=function(e,t,r){return t||(t=a.allocUnsafe(h.encodingLength(e))),r||(r=0),u.encode(e,t,r+2),t.writeUInt16BE(u.encode.bytes,r),h.encode.bytes=u.encode.bytes+2,t},h.encode.bytes=0,h.decode=function(e,t){t||(t=0);var r=e.readUInt16BE(t),n=u.decode(e,t+2);return h.decode.bytes=r+2,n},h.decode.bytes=0,h.encodingLength=function(e){return u.encodingLength(e)+2};var p=t.soa={};p.encode=function(e,t,r){t||(t=a.allocUnsafe(p.encodingLength(e))),r||(r=0);var n=r;return r+=2,u.encode(e.mname,t,r),r+=u.encode.bytes,u.encode(e.rname,t,r),r+=u.encode.bytes,t.writeUInt32BE(e.serial||0,r),r+=4,t.writeUInt32BE(e.refresh||0,r),r+=4,t.writeUInt32BE(e.retry||0,r),r+=4,t.writeUInt32BE(e.expire||0,r),r+=4,t.writeUInt32BE(e.minimum||0,r),r+=4,t.writeUInt16BE(r-n-2,n),p.encode.bytes=r-n,t},p.encode.bytes=0,p.decode=function(e,t){t||(t=0);var r=t,n={};return t+=2,n.mname=u.decode(e,t),t+=u.decode.bytes,n.rname=u.decode(e,t),t+=u.decode.bytes,n.serial=e.readUInt32BE(t),t+=4,n.refresh=e.readUInt32BE(t),t+=4,n.retry=e.readUInt32BE(t),t+=4,n.expire=e.readUInt32BE(t),t+=4,n.minimum=e.readUInt32BE(t),t+=4,p.decode.bytes=t-r,n},p.decode.bytes=0,p.encodingLength=function(e){return 22+u.encodingLength(e.mname)+u.encodingLength(e.rname)};var d=t.txt=t.null={},y=d;d.encode=function(e,t,r){t||(t=a.allocUnsafe(d.encodingLength(e))),r||(r=0),\"string\"==typeof e&&(e=a.from(e)),e||(e=a.allocUnsafe(0));var n=r;r+=2;var i=e.length;return e.copy(t,r,0,i),r+=i,t.writeUInt16BE(r-n-2,n),d.encode.bytes=r-n,t},d.encode.bytes=0,d.decode=function(e,t){t||(t=0);var r=t,n=e.readUInt16BE(t);t+=2;var i=e.slice(t,t+n);return t+=n,d.decode.bytes=t-r,i},d.decode.bytes=0,d.encodingLength=function(e){return e?(a.isBuffer(e)?e.length:a.byteLength(e))+2:2};var m=t.hinfo={};m.encode=function(e,t,r){t||(t=a.allocUnsafe(m.encodingLength(e))),r||(r=0);var n=r;return r+=2,c.encode(e.cpu,t,r),r+=c.encode.bytes,c.encode(e.os,t,r),r+=c.encode.bytes,t.writeUInt16BE(r-n-2,n),m.encode.bytes=r-n,t},m.encode.bytes=0,m.decode=function(e,t){t||(t=0);var r=t,n={};return t+=2,n.cpu=c.decode(e,t),t+=c.decode.bytes,n.os=c.decode(e,t),t+=c.decode.bytes,m.decode.bytes=t-r,n},m.decode.bytes=0,m.encodingLength=function(e){return c.encodingLength(e.cpu)+c.encodingLength(e.os)+2};var g=t.ptr={},v=t.cname=g,b=t.dname=g;g.encode=function(e,t,r){return t||(t=a.allocUnsafe(g.encodingLength(e))),r||(r=0),u.encode(e,t,r+2),t.writeUInt16BE(u.encode.bytes,r),g.encode.bytes=u.encode.bytes+2,t},g.encode.bytes=0,g.decode=function(e,t){t||(t=0);var r=u.decode(e,t+2);return g.decode.bytes=u.decode.bytes+2,r},g.decode.bytes=0,g.encodingLength=function(e){return u.encodingLength(e)+2};var w=t.srv={};w.encode=function(e,t,r){t||(t=a.allocUnsafe(w.encodingLength(e))),r||(r=0),t.writeUInt16BE(e.priority||0,r+2),t.writeUInt16BE(e.weight||0,r+4),t.writeUInt16BE(e.port||0,r+6),u.encode(e.target,t,r+8);var n=u.encode.bytes+6;return t.writeUInt16BE(n,r),w.encode.bytes=n+2,t},w.encode.bytes=0,w.decode=function(e,t){t||(t=0);var r=e.readUInt16BE(t),n={};return n.priority=e.readUInt16BE(t+2),n.weight=e.readUInt16BE(t+4),n.port=e.readUInt16BE(t+6),n.target=u.decode(e,t+8),w.decode.bytes=r+2,n},w.decode.bytes=0,w.encodingLength=function(e){return 8+u.encodingLength(e.target)};var _=t.caa={};_.ISSUER_CRITICAL=128,_.encode=function(e,t,r){var n=_.encodingLength(e);return t||(t=a.allocUnsafe(_.encodingLength(e))),r||(r=0),e.issuerCritical&&(e.flags=_.ISSUER_CRITICAL),t.writeUInt16BE(n-2,r),r+=2,t.writeUInt8(e.flags||0,r),r+=1,c.encode(e.tag,t,r),r+=c.encode.bytes,t.write(e.value,r),r+=a.byteLength(e.value),_.encode.bytes=n,t},_.encode.bytes=0,_.decode=function(e,t){t||(t=0);var r=e.readUInt16BE(t),n=t+=2,i={};return i.flags=e.readUInt8(t),t+=1,i.tag=c.decode(e,t),t+=c.decode.bytes,i.value=e.toString(\"utf-8\",t,n+r),i.issuerCritical=!!(i.flags&_.ISSUER_CRITICAL),_.decode.bytes=r+2,i},_.decode.bytes=0,_.encodingLength=function(e){return c.encodingLength(e.tag)+c.encodingLength(e.value)+2};var k=t.a={};k.encode=function(e,t,r){return t||(t=a.allocUnsafe(k.encodingLength(e))),r||(r=0),t.writeUInt16BE(4,r),r+=2,o.toBuffer(e,t,r),k.encode.bytes=6,t},k.encode.bytes=0,k.decode=function(e,t){t||(t=0),t+=2;var r=o.toString(e,t,4);return k.decode.bytes=6,r},k.decode.bytes=0,k.encodingLength=function(){return 6};var S=t.aaaa={};S.encode=function(e,t,r){return t||(t=a.allocUnsafe(S.encodingLength(e))),r||(r=0),t.writeUInt16BE(16,r),r+=2,o.toBuffer(e,t,r),S.encode.bytes=18,t},S.encode.bytes=0,S.decode=function(e,t){t||(t=0),t+=2;var r=o.toString(e,t,16);return S.decode.bytes=18,r},S.decode.bytes=0,S.encodingLength=function(){return 18};var E=t.record=function(e){switch(e.toUpperCase()){case\"A\":return k;case\"PTR\":return g;case\"CNAME\":return v;case\"DNAME\":return b;case\"TXT\":return d;case\"NULL\":return y;case\"AAAA\":return S;case\"SRV\":return w;case\"HINFO\":return m;case\"CAA\":return _;case\"NS\":return h;case\"SOA\":return p}return l},x=t.answer={};x.encode=function(e,t,r){t||(t=a.allocUnsafe(x.encodingLength(e))),r||(r=0);var i=r;u.encode(e.name,t,r),r+=u.encode.bytes,t.writeUInt16BE(n.toType(e.type),r);var s=void 0===e.class?1:e.class;e.flush&&(s|=32768),t.writeUInt16BE(s,r+2),t.writeUInt32BE(e.ttl||0,r+4);var o=E(e.type);return o.encode(e.data,t,r+8),r+=8+o.encode.bytes,x.encode.bytes=r-i,t},x.encode.bytes=0,x.decode=function(e,t){t||(t=0);var r={},i=t;r.name=u.decode(e,t),t+=u.decode.bytes,r.type=n.toString(e.readUInt16BE(t)),r.class=e.readUInt16BE(t+2),r.ttl=e.readUInt32BE(t+4),r.flush=!!(32768&r.class),r.flush&&(r.class&=-32769);var s=E(r.type);return r.data=s.decode(e,t+8),t+=8+s.decode.bytes,x.decode.bytes=t-i,r},x.decode.bytes=0,x.encodingLength=function(e){return u.encodingLength(e.name)+8+E(e.type).encodingLength(e.data)};var A=t.question={};function B(e,t){for(var r=0,n=0;n<e.length;n++)r+=t.encodingLength(e[n]);return r}function C(e,t,r,n){for(var i=0;i<e.length;i++)t.encode(e[i],r,n),n+=t.encode.bytes;return n}function I(e,t,r,n){for(var i=0;i<e.length;i++)e[i]=t.decode(r,n),n+=t.decode.bytes;return n}A.encode=function(e,t,r){t||(t=a.allocUnsafe(A.encodingLength(e))),r||(r=0);var i=r;return u.encode(e.name,t,r),r+=u.encode.bytes,t.writeUInt16BE(n.toType(e.type),r),r+=2,t.writeUInt16BE(void 0===e.class?1:e.class,r),r+=2,A.encode.bytes=r-i,e},A.encode.bytes=0,A.decode=function(e,t){t||(t=0);var r=t,i={};return i.name=u.decode(e,t),t+=u.decode.bytes,i.type=n.toString(e.readUInt16BE(t)),t+=2,i.class=e.readUInt16BE(t),t+=2,!!(32768&i.class)&&(i.class&=-32769),A.decode.bytes=t-r,i},A.decode.bytes=0,A.encodingLength=function(e){return u.encodingLength(e.name)+4},t.AUTHORITATIVE_ANSWER=1024,t.TRUNCATED_RESPONSE=512,t.RECURSION_DESIRED=256,t.RECURSION_AVAILABLE=128,t.AUTHENTIC_DATA=32,t.CHECKING_DISABLED=16,t.encode=function(e,r,n){r||(r=a.allocUnsafe(t.encodingLength(e))),n||(n=0);var i=n;return e.questions||(e.questions=[]),e.answers||(e.answers=[]),e.authorities||(e.authorities=[]),e.additionals||(e.additionals=[]),f.encode(e,r,n),n+=f.encode.bytes,n=C(e.questions,A,r,n),n=C(e.answers,x,r,n),n=C(e.authorities,x,r,n),n=C(e.additionals,x,r,n),t.encode.bytes=n-i,r},t.encode.bytes=0,t.decode=function(e,r){r||(r=0);var n=r,i=f.decode(e,r);return r+=f.decode.bytes,r=I(i.questions,A,e,r),r=I(i.answers,x,e,r),r=I(i.authorities,x,e,r),r=I(i.additionals,x,e,r),t.decode.bytes=r-n,i},t.decode.bytes=0,t.encodingLength=function(e){return f.encodingLength(e)+B(e.questions||[],A)+B(e.answers||[],x)+B(e.authorities||[],x)+B(e.additionals||[],x)}},function(e,t,r){var n=r(590),i=r(586),s=r(585),o=r(11),a=r(64),u=function(){};e.exports=function(e){e||(e={});var t=new o.EventEmitter,r=\"number\"==typeof e.port?e.port:5353,c=e.type||\"udp4\",f=e.ip||e.host||(\"udp4\"===c?\"224.0.0.251\":null),l={address:f,port:r},h={},p=!1,d=null;if(!(\"udp6\"!==c||f&&e.interface))throw new Error(\"For IPv6 multicast you must specify `ip` and `interface`\");var y=e.socket||i.createSocket({type:c,reuseAddr:!1!==e.reuseAddr,toString:function(){return c}});y.on(\"error\",function(e){\"EACCES\"===e.code||\"EADDRINUSE\"===e.code?t.emit(\"error\",e):t.emit(\"warning\",e)}),y.on(\"message\",function(e,r){try{e=n.decode(e)}catch(e){return void t.emit(\"warning\",e)}t.emit(\"packet\",e,r),\"query\"===e.type&&t.emit(\"query\",e,r),\"response\"===e.type&&t.emit(\"response\",e,r)}),y.on(\"listening\",function(){r||(r=l.port=y.address().port),!1!==e.multicast&&(t.update(),d=setInterval(t.update,5e3),y.setMulticastTTL(e.ttl||255),y.setMulticastLoopback(!1!==e.loopback))});var m=s(function(t){if(!r)return t(null);y.once(\"error\",t),y.bind(r,e.interface,function(){y.removeListener(\"error\",t),t(null)})});return m(function(e){if(e)return t.emit(\"error\",e);t.emit(\"ready\")}),t.send=function(e,r,i){if(\"function\"==typeof r)return t.send(e,null,r);i||(i=u),r||(r=l),m(function(t){if(p)return i();if(t)return i(t);var s=n.encode(e);y.send(s,0,s.length,r.port,r.address||r.host,i)})},t.response=t.respond=function(e,r,i){Array.isArray(e)&&(e={answers:e}),e.type=\"response\",e.flags=(e.flags||0)|n.AUTHORITATIVE_ANSWER,t.send(e,r,i)},t.query=function(e,r,n,i){return\"function\"==typeof r?t.query(e,null,null,r):\"object\"==typeof r&&r&&r.port?t.query(e,null,r,n):\"function\"==typeof n?t.query(e,r,null,n):(i||(i=u),\"string\"==typeof e&&(e=[{name:e,type:r||\"ANY\"}]),Array.isArray(e)&&(e={type:\"query\",questions:e}),e.type=\"query\",void t.send(e,n,i))},t.destroy=function(e){if(e||(e=u),p)return process.nextTick(e);p=!0,clearInterval(d),y.once(\"close\",e),y.close()},t.update=function(){for(var r=e.interface?[].concat(e.interface):function(){for(var e=a.networkInterfaces(),t=Object.keys(e),r=[],n=0;n<t.length;n++)for(var i=e[t[n]],s=0;s<i.length;s++){var o=i[s];if(\"IPv4\"===o.family){r.push(o.address);break}}return r}(),n=!1,i=0;i<r.length;i++){var s=r[i];if(!h[s]){h[s]=!0,n=!0;try{y.addMembership(f,s)}catch(e){t.emit(\"warning\",e)}}}n&&y.setMulticastInterface&&y.setMulticastInterface(e.interface||function(){for(var e=a.networkInterfaces(),t=Object.keys(e),r=0;r<t.length;r++)for(var n=e[t[r]],i=0;i<n.length;i++){var s=n[i];if(\"IPv4\"===s.family&&!s.internal)return s.address}return\"127.0.0.1\"}())},t}},function(e,t,r){\"use strict\";const n=r(591),i=r(11).EventEmitter,s=r(0)(\"libp2p:mdns\"),o=r(584);e.exports=class extends i{constructor(e,t){super(),t=t||{},this.broadcast=!1!==t.broadcast,this.interval=t.interval||1e4,this.serviceTag=t.serviceTag||\"_ipfs-discovery._udp\",this.port=t.port||5353,this.peerInfo=e,this._queryInterval=null}start(e){const t=this,r=n({port:this.port});this.mdns=r,this._queryInterval=o.queryLAN(this.mdns,this.serviceTag,this.interval),r.on(\"response\",e=>{o.gotResponse(e,this.peerInfo,this.serviceTag,(e,r)=>{if(e)return s(\"Error processing peer response\",e);t.emit(\"peer\",r)})}),r.on(\"query\",e=>{o.gotQuery(e,this.mdns,this.peerInfo,this.serviceTag,this.broadcast)}),setImmediate(()=>e())}stop(e){this.mdns?(clearInterval(this._queryInterval),this._queryInterval=null,this.mdns.destroy(e),this.mdns=void 0):e(new Error(\"MulticastDNS service had not started yet\"))}}},function(e,t,r){\"use strict\";var n=r(93).sprintf,i=r(166);function s(e){return n(\"(%s)\",e.join(\"|\"))}function o(e){return e.length<4?n(\"0{0,%d}%s\",4-e.length,e):e}function a(e){var t=[];e.forEach(function(e,r){0===parseInt(e,16)&&t.push(r)});var r=t.map(function(t){return e.map(function(e,r){if(r===t){var n=0===r||r===i.GROUPS-1?\":\":\"\";return s([o(e),n])}return o(e)}).join(\":\")});return r.push(e.map(o).join(\":\")),s(r)}function u(e,t,r){var i=t?\"\":\":\",o=r?\"\":\":\",a=[];t||r||a.push(\"::\"),t&&r&&a.push(\"\"),(r&&!t||!r&&t)&&a.push(\":\"),a.push(n(\"%s(:0{1,4}){1,%d}\",i,e-1)),a.push(n(\"(0{1,4}:){1,%d}%s\",e-1,o)),a.push(n(\"(0{1,4}:){%d}0{1,4}\",e-1));for(var u=1;u<e-1;u++)for(var c=1;c<e-u;c++)a.push(n(\"(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}\",c,e-c-u-1));return s(a)}t.regularExpressionString=function(e){void 0===e&&(e=!1);var t=[],r=new this.constructor(this.correctForm());if(0===r.elidedGroups)t.push(a(r.parsedAddress));else if(r.elidedGroups===i.GROUPS)t.push(u(i.GROUPS));else{var n=r.address.split(\"::\");n[0].length&&t.push(a(n[0].split(\":\"))),t.push(u(r.elidedGroups,0!==n[0].length,0!==n[1].length)),n[1].length&&t.push(a(n[1].split(\":\"))),t=[t.join(\":\")]}return e||(t=[].concat(\"(?=^|\\\\b|[^\\\\w\\\\:])(\",t,\")(?=[^\\\\w\\\\:]|\\\\b|$)\")),t.join(\"\")},t.regularExpression=function(e){return new RegExp(this.regularExpressionString(e),\"i\")}},function(e,t,r){\"use strict\";var n=r(167),i=r(281),s=r(93).sprintf;t.href=function(e){return e=void 0===e?\"\":s(\":%s\",e),s(\"http://[%s]%s/\",this.correctForm(),e)},t.link=function(e){e||(e={}),void 0===e.className&&(e.className=\"\"),void 0===e.prefix&&(e.prefix=\"/#address=\"),void 0===e.v4&&(e.v4=!1);var t=this.correctForm;return e.v4&&(t=this.to4in6),e.className?s('<a href=\"%1$s%2$s\" class=\"%3$s\">%2$s</a>',e.prefix,t.call(this),e.className):s('<a href=\"%1$s%2$s\">%2$s</a>',e.prefix,t.call(this))},t.group=function(){var e,t=this.address.match(n.RE_ADDRESS);if(t){var r=t[0].split(\".\");this.address=this.address.replace(n.RE_ADDRESS,s('<span class=\"hover-group group-v4 group-6\">%s</span>.<span class=\"hover-group group-v4 group-7\">%s</span>',r.slice(0,2).join(\".\"),r.slice(2,4).join(\".\")))}if(0===this.elidedGroups)return i.simpleGroup(this.address);var o=[],a=this.address.split(\"::\");a[0].length?o.push(i.simpleGroup(a[0])):o.push(\"\");var u=[\"hover-group\"];for(e=this.elisionBegin;e<this.elisionBegin+this.elidedGroups;e++)u.push(s(\"group-%d\",e));return o.push(s('<span class=\"%s\"></span>',u.join(\" \"))),a[1].length?o.push(i.simpleGroup(a[1],this.elisionEnd)):o.push(\"\"),o.join(\":\")}},function(e,t,r){\"use strict\";var n=r(284),i=r(166);t.isValid=function(){return this.valid},t.isInSubnet=n.isInSubnet,t.isCorrect=n.isCorrect(i.BITS),t.isCanonical=n.falseIfInvalid(function(){return this.addressMinusSuffix===this.canonicalForm()}),t.isLinkLocal=n.falseIfInvalid(function(){return\"1111111010000000000000000000000000000000000000000000000000000000\"===this.getBitsBase2(0,64)}),t.isMulticast=n.falseIfInvalid(function(){return\"Multicast\"===this.getType()}),t.is4=n.falseIfInvalid(function(){return this.v4}),t.isTeredo=n.falseIfInvalid(function(){return this.isInSubnet(new this.constructor(\"2001::/32\"))}),t.is6to4=n.falseIfInvalid(function(){return this.isInSubnet(new this.constructor(\"2002::/16\"))}),t.isLoopback=n.falseIfInvalid(function(){return\"Loopback\"===this.getType()})},function(e,t,r){(function(e){var r=200,n=\"__lodash_hash_undefined__\",i=800,s=16,o=9007199254740991,a=\"[object Arguments]\",u=\"[object AsyncFunction]\",c=\"[object Function]\",f=\"[object GeneratorFunction]\",l=\"[object Null]\",h=\"[object Object]\",p=\"[object Proxy]\",d=\"[object Undefined]\",y=/^\\[object .+?Constructor\\]$/,m=/^(?:0|[1-9]\\d*)$/,g={};g[\"[object Float32Array]\"]=g[\"[object Float64Array]\"]=g[\"[object Int8Array]\"]=g[\"[object Int16Array]\"]=g[\"[object Int32Array]\"]=g[\"[object Uint8Array]\"]=g[\"[object Uint8ClampedArray]\"]=g[\"[object Uint16Array]\"]=g[\"[object Uint32Array]\"]=!0,g[a]=g[\"[object Array]\"]=g[\"[object ArrayBuffer]\"]=g[\"[object Boolean]\"]=g[\"[object DataView]\"]=g[\"[object Date]\"]=g[\"[object Error]\"]=g[c]=g[\"[object Map]\"]=g[\"[object Number]\"]=g[h]=g[\"[object RegExp]\"]=g[\"[object Set]\"]=g[\"[object String]\"]=g[\"[object WeakMap]\"]=!1;var v=\"object\"==typeof global&&global&&global.Object===Object&&global,b=\"object\"==typeof self&&self&&self.Object===Object&&self,w=v||b||Function(\"return this\")(),_=\"object\"==typeof t&&t&&!t.nodeType&&t,k=_&&\"object\"==typeof e&&e&&!e.nodeType&&e,S=k&&k.exports===_,E=S&&v.process,x=function(){try{return E&&E.binding&&E.binding(\"util\")}catch(e){}}(),A=x&&x.isTypedArray;function B(e,t){return\"__proto__\"==t?void 0:e[t]}var C,I,T,D=Array.prototype,P=Function.prototype,O=Object.prototype,N=w[\"__core-js_shared__\"],U=P.toString,R=O.hasOwnProperty,L=(C=/[^.]+$/.exec(N&&N.keys&&N.keys.IE_PROTO||\"\"))?\"Symbol(src)_1.\"+C:\"\",F=O.toString,j=U.call(Object),M=RegExp(\"^\"+U.call(R).replace(/[\\\\^$.*+?()[\\]{}|]/g,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\"),K=S?w.Buffer:void 0,H=w.Symbol,z=w.Uint8Array,V=K?K.allocUnsafe:void 0,q=(I=Object.getPrototypeOf,T=Object,function(e){return I(T(e))}),G=Object.create,W=O.propertyIsEnumerable,$=D.splice,X=H?H.toStringTag:void 0,J=function(){try{var e=_e(Object,\"defineProperty\");return e({},\"\",{}),e}catch(e){}}(),Y=K?K.isBuffer:void 0,Q=Math.max,Z=Date.now,ee=_e(w,\"Map\"),te=_e(Object,\"create\"),re=function(){function e(){}return function(t){if(!Pe(t))return{};if(G)return G(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function ne(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ie(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function se(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function oe(e){var t=this.__data__=new ie(e);this.size=t.size}function ae(e,t){var r=Be(e),n=!r&&Ae(e),i=!r&&!n&&Ie(e),s=!r&&!n&&!i&&Ne(e),o=r||n||i||s,a=o?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],u=a.length;for(var c in e)!t&&!R.call(e,c)||o&&(\"length\"==c||i&&(\"offset\"==c||\"parent\"==c)||s&&(\"buffer\"==c||\"byteLength\"==c||\"byteOffset\"==c)||ke(c,u))||a.push(c);return a}function ue(e,t,r){(void 0===r||xe(e[t],r))&&(void 0!==r||t in e)||le(e,t,r)}function ce(e,t,r){var n=e[t];R.call(e,t)&&xe(n,r)&&(void 0!==r||t in e)||le(e,t,r)}function fe(e,t){for(var r=e.length;r--;)if(xe(e[r][0],t))return r;return-1}function le(e,t,r){\"__proto__\"==t&&J?J(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}ne.prototype.clear=function(){this.__data__=te?te(null):{},this.size=0},ne.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ne.prototype.get=function(e){var t=this.__data__;if(te){var r=t[e];return r===n?void 0:r}return R.call(t,e)?t[e]:void 0},ne.prototype.has=function(e){var t=this.__data__;return te?void 0!==t[e]:R.call(t,e)},ne.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=te&&void 0===t?n:t,this},ie.prototype.clear=function(){this.__data__=[],this.size=0},ie.prototype.delete=function(e){var t=this.__data__,r=fe(t,e);return!(r<0||(r==t.length-1?t.pop():$.call(t,r,1),--this.size,0))},ie.prototype.get=function(e){var t=this.__data__,r=fe(t,e);return r<0?void 0:t[r][1]},ie.prototype.has=function(e){return fe(this.__data__,e)>-1},ie.prototype.set=function(e,t){var r=this.__data__,n=fe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},se.prototype.clear=function(){this.size=0,this.__data__={hash:new ne,map:new(ee||ie),string:new ne}},se.prototype.delete=function(e){var t=we(this,e).delete(e);return this.size-=t?1:0,t},se.prototype.get=function(e){return we(this,e).get(e)},se.prototype.has=function(e){return we(this,e).has(e)},se.prototype.set=function(e,t){var r=we(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},oe.prototype.clear=function(){this.__data__=new ie,this.size=0},oe.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},oe.prototype.get=function(e){return this.__data__.get(e)},oe.prototype.has=function(e){return this.__data__.has(e)},oe.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ie){var i=n.__data__;if(!ee||i.length<r-1)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new se(i)}return n.set(e,t),this.size=n.size,this};var he,pe=function(e,t,r){for(var n=-1,i=Object(e),s=r(e),o=s.length;o--;){var a=s[he?o:++n];if(!1===t(i[a],a,i))break}return e};function de(e){return null==e?void 0===e?d:l:X&&X in Object(e)?function(e){var t=R.call(e,X),r=e[X];try{e[X]=void 0;var n=!0}catch(e){}var i=F.call(e);n&&(t?e[X]=r:delete e[X]);return i}(e):function(e){return F.call(e)}(e)}function ye(e){return Oe(e)&&de(e)==a}function me(e){return!(!Pe(e)||L&&L in e)&&(Te(e)?M:y).test(function(e){if(null!=e){try{return U.call(e)}catch(e){}try{return e+\"\"}catch(e){}}return\"\"}(e))}function ge(e){if(!Pe(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=Se(e),r=[];for(var n in e)(\"constructor\"!=n||!t&&R.call(e,n))&&r.push(n);return r}function ve(e,t,r,n,i){e!==t&&pe(t,function(s,o){if(Pe(s))i||(i=new oe),function(e,t,r,n,i,s,o){var a=B(e,r),u=B(t,r),c=o.get(u);if(c)return void ue(e,r,c);var f=s?s(a,u,r+\"\",e,t,o):void 0,l=void 0===f;if(l){var p=Be(u),d=!p&&Ie(u),y=!p&&!d&&Ne(u);f=u,p||d||y?Be(a)?f=a:Oe(w=a)&&Ce(w)?f=function(e,t){var r=-1,n=e.length;t||(t=Array(n));for(;++r<n;)t[r]=e[r];return t}(a):d?(l=!1,f=function(e,t){if(t)return e.slice();var r=e.length,n=V?V(r):new e.constructor(r);return e.copy(n),n}(u,!0)):y?(l=!1,m=u,g=!0?(v=m.buffer,b=new v.constructor(v.byteLength),new z(b).set(new z(v)),b):m.buffer,f=new m.constructor(g,m.byteOffset,m.length)):f=[]:function(e){if(!Oe(e)||de(e)!=h)return!1;var t=q(e);if(null===t)return!0;var r=R.call(t,\"constructor\")&&t.constructor;return\"function\"==typeof r&&r instanceof r&&U.call(r)==j}(u)||Ae(u)?(f=a,Ae(a)?f=function(e){return function(e,t,r,n){var i=!r;r||(r={});var s=-1,o=t.length;for(;++s<o;){var a=t[s],u=n?n(r[a],e[a],a,r,e):void 0;void 0===u&&(u=e[a]),i?le(r,a,u):ce(r,a,u)}return r}(e,Ue(e))}(a):(!Pe(a)||n&&Te(a))&&(f=function(e){return\"function\"!=typeof e.constructor||Se(e)?{}:re(q(e))}(u))):l=!1}var m,g,v,b;var w;l&&(o.set(u,f),i(f,u,n,s,o),o.delete(u));ue(e,r,f)}(e,t,o,r,ve,n,i);else{var a=n?n(B(e,o),s,o+\"\",e,t,i):void 0;void 0===a&&(a=s),ue(e,o,a)}},Ue)}function be(e,t){return Ee(function(e,t,r){return t=Q(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,s=Q(n.length-t,0),o=Array(s);++i<s;)o[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=r(o),function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(e,this,a)}}(e,t,Fe),e+\"\")}function we(e,t){var r,n,i=e.__data__;return(\"string\"==(n=typeof(r=t))||\"number\"==n||\"symbol\"==n||\"boolean\"==n?\"__proto__\"!==r:null===r)?i[\"string\"==typeof t?\"string\":\"hash\"]:i.map}function _e(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return me(r)?r:void 0}function ke(e,t){var r=typeof e;return!!(t=null==t?o:t)&&(\"number\"==r||\"symbol\"!=r&&m.test(e))&&e>-1&&e%1==0&&e<t}function Se(e){var t=e&&e.constructor;return e===(\"function\"==typeof t&&t.prototype||O)}var Ee=function(e){var t=0,r=0;return function(){var n=Z(),o=s-(n-r);if(r=n,o>0){if(++t>=i)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(J?function(e,t){return J(e,\"toString\",{configurable:!0,enumerable:!1,value:(r=t,function(){return r}),writable:!0});var r}:Fe);function xe(e,t){return e===t||e!=e&&t!=t}var Ae=ye(function(){return arguments}())?ye:function(e){return Oe(e)&&R.call(e,\"callee\")&&!W.call(e,\"callee\")},Be=Array.isArray;function Ce(e){return null!=e&&De(e.length)&&!Te(e)}var Ie=Y||function(){return!1};function Te(e){if(!Pe(e))return!1;var t=de(e);return t==c||t==f||t==u||t==p}function De(e){return\"number\"==typeof e&&e>-1&&e%1==0&&e<=o}function Pe(e){var t=typeof e;return null!=e&&(\"object\"==t||\"function\"==t)}function Oe(e){return null!=e&&\"object\"==typeof e}var Ne=A?function(e){return function(t){return e(t)}}(A):function(e){return Oe(e)&&De(e.length)&&!!g[de(e)]};function Ue(e){return Ce(e)?ae(e,!0):ge(e)}var Re,Le=(Re=function(e,t,r){ve(e,t,r)},be(function(e,t){var r=-1,n=t.length,i=n>1?t[n-1]:void 0,s=n>2?t[2]:void 0;for(i=Re.length>3&&\"function\"==typeof i?(n--,i):void 0,s&&function(e,t,r){if(!Pe(r))return!1;var n=typeof t;return!!(\"number\"==n?Ce(r)&&ke(t,r.length):\"string\"==n&&t in r)&&xe(r[t],e)}(t[0],t[1],s)&&(i=n<3?void 0:i,n=1),e=Object(e);++r<n;){var o=t[r];o&&Re(e,o,r,i)}return e}));function Fe(e){return e}e.exports=Le}).call(this,r(55)(e))},function(e,t){var r=\"[object Symbol]\",n=Object.prototype.toString;function i(e,t){return e>t}function s(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&n.call(e)==r}function o(e){return e}e.exports=function(e){return e&&e.length?function(e,t,r){for(var n=-1,i=e.length;++n<i;){var o=e[n],a=t(o);if(null!=a&&(void 0===u?a==a&&!s(a):r(a,u)))var u=a,c=o}return c}(e,o,i):void 0}},function(e,t,r){\"use strict\";var n=r(285).BigInteger,i=r(295),s=r(597),o=r(596),a=r(283),u=r(282),c=r(93).sprintf,f=r(167),l=r(166),h=r(286);function p(e){return e=(e=e.replace(/^(0{1,})([1-9]+)$/,'<span class=\"parse-error\">$1</span>$2')).replace(/^(0{1,})(0)$/,'<span class=\"parse-error\">$1</span>$2')}function d(e,t){this.groups=void 0===t?l.GROUPS:t,this.v4=!1,this.subnet=\"/128\",this.subnetMask=128,this.zone=\"\",this.address=e;var r=l.RE_SUBNET_STRING.exec(e);if(r){if(this.parsedSubnet=r[0].replace(\"/\",\"\"),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet=\"/\"+this.subnetMask,isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>l.BITS)return this.valid=!1,void(this.error=\"Invalid subnet mask.\");e=e.replace(l.RE_SUBNET_STRING,\"\")}else if(/\\//.test(e))return this.valid=!1,void(this.error=\"Invalid subnet mask.\");var n=l.RE_ZONE_STRING.exec(e);n&&(this.zone=n[0],e=e.replace(l.RE_ZONE_STRING,\"\")),this.addressMinusSuffix=e,this.parsedAddress=this.parse(this.addressMinusSuffix)}function y(e){return c(\"%04x\",parseInt(e,16))}function m(e){return 255&e}o(d.prototype,r(595)),o(d.prototype,r(594)),o(d.prototype,r(593)),d.fromBigInteger=function(e){var t,r=a(e.toString(16),32,\"0\"),n=[];for(t=0;t<l.GROUPS;t++)n.push(r.slice(4*t,4*(t+1)));return new d(n.join(\":\"))},d.fromURL=function(e){var t,r,n;if(-1!==e.indexOf(\"[\")&&-1!==e.indexOf(\"]:\")){if(null===(n=l.RE_URL_WITH_PORT.exec(e)))return{error:\"failed to parse address with port\",address:null,port:null};t=n[1],r=n[2]}else if(-1!==e.indexOf(\"/\")){if(e=e.replace(/^[a-z0-9]+:\\/\\//,\"\"),null===(n=l.RE_URL.exec(e)))return{error:\"failed to parse address from URL\",address:null,port:null};t=n[1]}else t=e;return r?((r=parseInt(r,10))<0||r>65536)&&(r=null):r=null,{address:new d(t),port:r}},d.fromAddress4=function(e){e=new h(e);var t=l.BITS-(f.BITS-e.subnetMask);return new d(\"::ffff:\"+e.correctForm()+\"/\"+t)},d.fromArpa=function(e){var t=e.replace(/(\\.ip6\\.arpa)?\\.$/,\"\");if(63!==t.length)return t={error:\"Not Valid 'ip6.arpa' form\",address:null};t=t.split(\".\").reverse();for(var r=7;r>0;r--){var n=4*r;t.splice(n,0,\":\")}return new d(t=t.join(\"\"))},d.prototype.microsoftTranscription=function(){return c(\"%s.ipv6-literal.net\",this.correctForm().replace(/:/g,\"-\"))},d.prototype.mask=function(e){return void 0===e&&(e=this.subnetMask),this.getBitsBase2(0,e)},d.prototype.possibleSubnets=function(e){void 0===e&&(e=128);var t=l.BITS-this.subnetMask-Math.abs(e-l.BITS);return t<0?\"0\":function(e){for(var t=/(\\d+)(\\d{3})/;t.test(e);)e=e.replace(t,\"$1,$2\");return e}(new n(\"2\",10).pow(t).toString(10))},d.prototype.startAddress=function(){var e=new n(this.mask()+u(0,l.BITS-this.subnetMask),2);return d.fromBigInteger(e)},d.prototype.endAddress=function(){var e=new n(this.mask()+u(1,l.BITS-this.subnetMask),2);return d.fromBigInteger(e)},d.prototype.getScope=function(){var e=l.SCOPES[this.getBits(12,16)];return\"Global unicast\"===this.getType()&&\"Link local\"!==e&&(e=\"Global\"),e},d.prototype.getType=function(){var e=this;return i(l.TYPES,function(t,r){return e.isInSubnet(new d(r))})||\"Global unicast\"},d.prototype.getBits=function(e,t){return new n(this.getBitsBase2(e,t),2)},d.prototype.getBitsBase2=function(e,t){return this.binaryZeroPad().slice(e,t)},d.prototype.getBitsBase16=function(e,t){var r=t-e;return r%4!=0?null:a(this.getBits(e,t).toString(16),r/4,\"0\")},d.prototype.getBitsPastSubnet=function(){return this.getBitsBase2(this.subnetMask,l.BITS)},d.prototype.reverseForm=function(e){e||(e={});var t=Math.floor(this.subnetMask/4),r=this.canonicalForm().replace(/:/g,\"\").split(\"\").slice(0,t).reverse().join(\".\");return t>0?e.omitSuffix?r:c(\"%s.ip6.arpa.\",r):e.omitSuffix?\"\":\"ip6.arpa.\"},d.prototype.correctForm=function(){if(!this.parsedAddress)return null;var e,t=[],r=0,n=[];for(e=0;e<this.parsedAddress.length;e++){var i=parseInt(this.parsedAddress[e],16);0===i&&r++,0!==i&&r>0&&(r>1&&n.push([e-r,e-1]),r=0)}r>1&&n.push([this.parsedAddress.length-r,this.parsedAddress.length-1]);var o=n.map(function(e){return e[1]-e[0]+1});if(n.length>0){var a=o.indexOf(s(o));t=function(e,t){var r,n=[],i=[];for(r=0;r<e.length;r++)r<t[0]?n.push(e[r]):r>t[1]&&i.push(e[r]);return n.concat([\"compact\"]).concat(i)}(this.parsedAddress,n[a])}else t=this.parsedAddress;for(e=0;e<t.length;e++)\"compact\"!==t[e]&&(t[e]=parseInt(t[e],16).toString(16));var u=t.join(\":\");return u=(u=(u=u.replace(/^compact$/,\"::\")).replace(/^compact|compact$/,\":\")).replace(/compact/,\"\")},d.prototype.binaryZeroPad=function(){return a(this.bigInteger().toString(2),l.BITS,\"0\")},d.prototype.parse4in6=function(e){var t=e.split(\":\"),r=t.slice(-1)[0].match(f.RE_ADDRESS);if(r){for(var n=new h(r[0]),i=0;i<n.groups;i++)if(/^0[0-9]+/.test(n.parsedAddress[i]))return this.valid=!1,this.error=\"IPv4 addresses can not have leading zeroes.\",this.parseError=e.replace(f.RE_ADDRESS,n.parsedAddress.map(p).join(\".\")),null;this.v4=!0,t[t.length-1]=n.toGroup6(),e=t.join(\":\")}return e},d.prototype.parse=function(e){if(e=this.parse4in6(e),this.error)return null;var t=e.match(l.RE_BAD_CHARACTERS);if(t)return this.valid=!1,this.error=c(\"Bad character%s detected in address: %s\",t.length>1?\"s\":\"\",t.join(\"\")),this.parseError=e.replace(l.RE_BAD_CHARACTERS,'<span class=\"parse-error\">$1</span>'),null;var r=e.match(l.RE_BAD_ADDRESS);if(r)return this.valid=!1,this.error=c(\"Address failed regex: %s\",r.join(\"\")),this.parseError=e.replace(l.RE_BAD_ADDRESS,'<span class=\"parse-error\">$1</span>'),null;var n=[],i=e.split(\"::\");if(2===i.length){var s=i[0].split(\":\"),o=i[1].split(\":\");1===s.length&&\"\"===s[0]&&(s=[]),1===o.length&&\"\"===o[0]&&(o=[]);var a=this.groups-(s.length+o.length);if(!a)return this.valid=!1,this.error=\"Error parsing groups\",null;this.elidedGroups=a,this.elisionBegin=s.length,this.elisionEnd=s.length+this.elidedGroups,s.forEach(function(e){n.push(e)});for(var u=0;u<a;u++)n.push(0);o.forEach(function(e){n.push(e)})}else{if(1!==i.length)return this.valid=!1,this.error=\"Too many :: groups found\",null;n=e.split(\":\"),this.elidedGroups=0}return(n=n.map(function(e){return c(\"%x\",parseInt(e,16))})).length!==this.groups?(this.valid=!1,this.error=\"Incorrect number of groups found\",null):(this.valid=!0,n)},d.prototype.canonicalForm=function(){return this.valid?this.parsedAddress.map(y).join(\":\"):null},d.prototype.decimal=function(){return this.valid?this.parsedAddress.map(function(e){return c(\"%05d\",parseInt(e,16))}).join(\":\"):null},d.prototype.bigInteger=function(){return this.valid?new n(this.parsedAddress.map(y).join(\"\"),16):null},d.prototype.to4=function(){var e=this.binaryZeroPad().split(\"\");return h.fromHex(new n(e.slice(96,128).join(\"\"),2).toString(16))},d.prototype.to4in6=function(){var e=this.to4(),t=new d(this.parsedAddress.slice(0,6).join(\":\"),6),r=t.correctForm(),n=\"\";return/:$/.test(r)||(n=\":\"),t.correctForm()+n+e.address},d.prototype.inspectTeredo=function(){var e=this.getBitsBase16(0,32),t=this.getBits(80,96).xor(new n(\"ffff\",16)).toString(),r=h.fromHex(this.getBitsBase16(32,64)),i=h.fromHex(this.getBits(96,128).xor(new n(\"ffffffff\",16)).toString(16)),s=this.getBits(64,80),o=this.getBitsBase2(64,80),a=s.testBit(15),u=s.testBit(14),f=s.testBit(8),l=s.testBit(9),p=new n(o.slice(2,6)+o.slice(8,16),2).toString(10);return{prefix:c(\"%s:%s\",e.slice(0,4),e.slice(4,8)),server4:r.address,client4:i.address,flags:o,coneNat:a,microsoft:{reserved:u,universalLocal:l,groupIndividual:f,nonce:p},udpPort:t}},d.prototype.inspect6to4=function(){var e=this.getBitsBase16(0,16),t=h.fromHex(this.getBitsBase16(16,48));return{prefix:c(\"%s\",e.slice(0,4)),gateway:t.address}},d.prototype.to6to4=function(){return this.is4()?new d([\"2002\",this.getBitsBase16(96,112),this.getBitsBase16(112,128),\"\",\"/16\"].join(\":\")):null},d.prototype.toByteArray=function(){var e=this.bigInteger().toByteArray();return 17===e.length&&0===e[0]?e.slice(1):e},d.prototype.toUnsignedByteArray=function(){return this.toByteArray().map(m)},d.fromByteArray=function(e){return this.fromUnsignedByteArray(e.map(m))},d.fromUnsignedByteArray=function(e){for(var t=new n(\"256\",10),r=new n(\"0\",10),i=new n(\"1\",10),s=e.length-1;s>=0;s--)r=r.add(i.multiply(new n(e[s].toString(10),10))),i=i.multiply(t);return d.fromBigInteger(r)},e.exports=d},function(e,t,r){\"use strict\";t.Address4=r(286),t.Address6=r(598),t.v6={helpers:r(281)}},function(e,t,r){\"use strict\";const n=r(16),i=r(599).Address6;e.exports=(e=>{let t;if(\"IPv6\"===e.remoteFamily){const r=new i(e.remoteAddress);if(r.v4){const i=r.to4().correctForm();t=n(\"/ip4/\"+i+\"/tcp/\"+e.remotePort)}else t=n(\"/ip6/\"+e.remoteAddress+\"/tcp/\"+e.remotePort)}else t=n(\"/ip4/\"+e.remoteAddress+\"/tcp/\"+e.remotePort);return t})},function(e,t,r){\"use strict\";const n=r(16),i=r(32).Connection,s=r(64),o=r(118),a=r(174),u=r(119),c=r(11).EventEmitter,f=r(0)(\"libp2p:tcp:listen\"),l=r(600),h=421;function p(){}e.exports=(e=>{const t=new c,r=a.createServer(n=>{n.on(\"error\",p);const s=l(n);f(\"new connection\",s.toString());const o=u.duplex(n);o.getObservedAddrs=(e=>{e(null,[s])}),function(e,t){const r=`${t.remoteAddress}:${t.remotePort}`;e.__connections[r]=t,t.on(\"close\",()=>{delete e.__connections[r]})}(r,n);const a=new i(o);e(a),t.emit(\"connection\",a)});let d,y;return r.on(\"listening\",()=>t.emit(\"listening\")),r.on(\"error\",e=>t.emit(\"error\",e)),r.on(\"close\",()=>t.emit(\"close\")),r.__connections={},t.close=((e,t)=>{\"function\"==typeof e&&(t=e,e={}),t=t||p,e=e||{};const n=setTimeout(()=>{f(\"unable to close graciously, destroying conns\"),Object.keys(r.__connections).forEach(e=>{f(\"destroying %s\",e),r.__connections[e].destroy()})},e.timeout||2e3);r.close(t),r.once(\"close\",()=>{clearTimeout(n)})}),t.listen=((e,t)=>{y=e,o(e.protoNames(),\"ipfs\")&&(d=e.stringTuples().filter(e=>e[0]===h)[0][1],y=e.decapsulate(\"ipfs\"));const n=y.toOptions();return f(\"Listening on %s %s\",n.port,n.host),r.listen(n.port,n.host,t)}),t.getAddrs=(e=>{const t=[],i=r.address();if(!i)return e(new Error(\"Listener is not ready yet\"));if(-1!==y.toString().indexOf(\"ip4\")){let e=y.decapsulate(\"tcp\");if(e=e.encapsulate(\"/tcp/\"+i.port),d&&(e=e.encapsulate(\"/ipfs/\"+d)),-1!==e.toString().indexOf(\"0.0.0.0\")){const r=s.networkInterfaces();Object.keys(r).forEach(i=>{r[i].forEach(r=>{\"IPv4\"===r.family&&t.push(n(e.toString().replace(\"0.0.0.0\",r.address)))})})}else t.push(e)}if(\"IPv6\"===i.family){let e=n(\"/ip6/\"+i.address+\"/tcp/\"+i.port);d&&(e=e.encapsulate(\"/ipfs/\"+d)),t.push(e)}e(null,t)}),t})},function(e,t,r){\"use strict\";const n=r(374);e.exports=class{constructor(e,t){this.peerInfo=null,this.conn=n(),e?this.setInnerConn(e,t):t&&(this.info=t)}get source(){return this.conn.source}get sink(){return this.conn.sink}getPeerInfo(e){return this.info&&this.info.getPeerInfo?this.info.getPeerInfo(e):this.peerInfo?void e(null,this.peerInfo):e(new Error(\"Peer Info not set yet\"))}setPeerInfo(e){if(this.info&&this.info.setPeerInfo)return this.info.setPeerInfo(e);this.peerInfo=e}getObservedAddrs(e){if(this.info&&this.info.getObservedAddrs)return this.info.getObservedAddrs(e);e(null,[])}setInnerConn(e,t){this.conn.resolve(e),this.info=t||e}}},function(e,t,r){\"use strict\";const n=r(287),i=r(592),s=r(583),o=r(566),a=r(544),u=r(543),c=r(510),f=r(499),l=r(491);e.exports=class extends l{constructor(e,t,r){r=r||{};const l=new o({id:e.id}),h={transport:[new n,new s,l],connection:{muxer:[c],crypto:[f]},discovery:[l.discovery]};if(r.dht&&(h.DHT=u),r.mdns){const t=new i(e,\"ipfs.local\");h.discovery.push(t)}if(r.bootstrap){const e=new a(r.bootstrap);h.discovery.push(e)}r.modules&&r.modules.transport&&r.modules.transport.forEach(e=>h.transport.push(e)),r.modules&&r.modules.discovery&&r.modules.discovery.forEach(e=>h.discovery.push(e)),super(h,e,t,r)}}},function(e,t,r){\"use strict\";const n=r(603),i=r(17),s=r(218);e.exports=function(e){return{start:i(t=>{e.config.get(function(r,i){if(r)return t(r);const o={mdns:s(i,\"Discovery.MDNS.Enabled\"),webRTCStar:s(i,\"Discovery.webRTCStar.Enabled\"),bootstrap:s(i,\"Bootstrap\"),modules:e._libp2pModules,pubsub:s(e._options,\"EXPERIMENTAL.pubsub\",!1),dht:s(e._options,\"EXPERIMENTAL.dht\",!1),relay:{enabled:s(i,\"EXPERIMENTAL.relay.enabled\",!1),hop:{enabled:s(i,\"EXPERIMENTAL.relay.hop.enabled\",!1),active:s(i,\"EXPERIMENTAL.relay.hop.active\",!1)}}};e._libp2pNode=new n(e._peerInfo,e._peerInfoBook,o),e._libp2pNode.on(\"peer:discovery\",t=>{const r=()=>{e._peerInfoBook.put(t),e._libp2pNode.dial(t,()=>{})};e.isOnline()?r():e._libp2pNode.once(\"start\",r)}),e._libp2pNode.on(\"peer:connect\",t=>{e._peerInfoBook.put(t)}),e._libp2pNode.start(r=>{if(r)return t(r);e._libp2pNode.peerInfo.multiaddrs.forEach(e=>{console.log(\"Swarm listening on\",e.toString())}),t()})})}),stop:i(t=>{e._libp2pNode.stop(t)})}}},function(e,t,r){\"use strict\";const n=r(17),i=r(5),s=r(1);e.exports=function(e){return{put:n((t,r,n)=>{e._ipld.put(t,r,n)}),get:n((t,r,n,s)=>{if(\"function\"==typeof r&&(s=r,r=void 0),\"function\"==typeof n&&(s=n,n={}),n=n||{},\"string\"==typeof t){const e=t.split(\"/\");t=new i(e[0]),e.shift(),r=e.length>0?e.join(\"/\"):\"/\"}e._ipld.get(t,r,n,s)}),tree:n((t,r,n,o)=>{if(\"object\"==typeof r&&(o=n,n=r,r=void 0),\"function\"==typeof r&&(o=r,r=void 0),\"function\"==typeof n&&(o=n,n={}),n=n||{},\"string\"==typeof t){const e=t.split(\"/\");t=new i(e[0]),e.shift(),r=e.length>0?e.join(\"/\"):void 0}s(e._ipld.treeStream(t,r,n),s.collect(o))})}}},function(e,t,r){\"use strict\";const n=r(3),i=r(17),s=r(84),o=s.DAGNode,a=s.DAGLink,u=r(5),c=r(23),f=r(66),l=r(10);function h(e,t,r){switch(t){case\"json\":return function(e,t){let r,n;try{const i=JSON.parse(e.toString());n=(i.Links||[]).map(e=>new a(e.Name||e.name,e.Size||e.size,c.fromB58String(e.Hash||e.hash||e.multihash))),r=Buffer.from(i.Data)}catch(e){return t(new Error(\"failed to parse JSON: \"+e))}o.create(r,n,t)}(e,r);case\"protobuf\":return function(e,t){s.util.deserialize(e,t)}(e,r);default:r(new Error(`unkown encoding: ${t}`))}}e.exports=function(e){function t(t){return(r,i,s)=>{\"function\"==typeof i&&(s=i,i={}),n([t=>{e.object.get(r,i,t)},(r,n)=>{t(r,(t,r)=>{if(t)return n(t);e._ipld.put(r,{cid:new u(r.multihash)},e=>{n(e,r)})})}],s)}}return{new:i((t,r)=>{let n;\"function\"==typeof t&&(r=t,t=void 0),t?(l(\"unixfs-dir\"===t,\"unkown template\"),n=new f(\"directory\").marshal()):n=Buffer.alloc(0),o.create(n,(t,n)=>{if(t)return r(t);e._ipld.put(n,{cid:new u(n.multihash)},e=>{if(e)return r(e);r(null,n)})})}),put:i((t,r,n)=>{\"function\"==typeof r&&(n=r,r={});const i=r.enc;let s;if(Buffer.isBuffer(t))i?h(t,i,(e,t)=>{if(e)return n(e);s=t,a()}):o.create(t,(e,t)=>{if(e)return n(e);s=t,a()});else if(t.multihash)s=t,a();else{if(\"object\"!=typeof t)return n(new Error(\"obj not recognized\"));o.create(t.Data,t.Links,(e,t)=>{if(e)return n(e);s=t,a()})}function a(){e._ipld.put(s,{cid:new u(s.multihash)},t=>{if(t)return n(t);e.object.get(s.multihash,n)})}}),get:i((t,r,n)=>{let i;\"function\"==typeof r&&(n=r,r={});try{i=function(e,t){if(\"string\"==typeof e)return\"base58\"!==t&&t?Buffer.from(e,t):e;if(Buffer.isBuffer(e))return e;throw new Error(\"unsupported multihash\")}(t,r.enc)}catch(e){return n(e)}const s=new u(i);e._ipld.get(s,(e,t)=>{if(e)return n(e);const r=t.value;n(null,r)})}),data:i((t,r,n)=>{\"function\"==typeof r&&(n=r,r={}),e.object.get(t,r,(e,t)=>{if(e)return n(e);n(null,t.data)})}),links:i((t,r,n)=>{\"function\"==typeof r&&(n=r,r={}),e.object.get(t,r,(e,t)=>{if(e)return n(e);n(null,t.links)})}),stat:i((t,r,n)=>{\"function\"==typeof r&&(n=r,r={}),e.object.get(t,r,(e,t)=>{if(e)return n(e);s.util.serialize(t,(e,r)=>{if(e)return n(e);const i=r.length,s=t.links.reduce((e,t)=>e+t.size,0),o=t.toJSON();n(null,{Hash:o.multihash,NumLinks:t.links.length,BlockSize:i,LinksSize:i-t.data.length,DataSize:t.data.length,CumulativeSize:i+s})})})}),patch:i({addLink(e,r,n,i){t((e,t)=>{o.addLink(e,r,t)})(e,n,i)},rmLink(e,r,n,i){t((e,t)=>{r.constructor&&\"DAGLink\"===r.constructor.name&&(r=r._name),o.rmLink(e,r,t)})(e,n,i)},appendData(e,r,n,i){t((e,t)=>{const n=Buffer.concat([e.data,r]);o.create(n,e.links,t)})(e,n,i)},setData(e,r,n,i){t((e,t)=>{o.create(r,e.links,t)})(e,n,i)}})}}},function(e,t,r){\"use strict\";const n=r(132),i=r(23),s=r(31),o=r(5),a=r(3),u=r(17);function c(e){return o.isCID(e)?e:new o(e)}e.exports=function(e){return{get:u((t,r)=>{t=c(t),e._blockService.get(t,r)}),put:u((t,r,i)=>{if(i=i||function(){},\"function\"==typeof r&&(i=r,r={}),Array.isArray(t))return i(new Error(\"Array is not supported\"));a([e=>{if(n.isBlock(t))return e(null,t);if(r.cid&&o.isCID(r.cid))return e(null,new n(t,r.cid));const i=r.mhtype||\"sha2-256\",a=r.format||\"dag-pb\",u=r.version||0;s(t,i,(r,i)=>{if(r)return e(r);e(null,new n(t,new o(u,a,i)))})},(t,r)=>e._blockService.put(t,e=>{if(e)return r(e);r(null,t)})],i)}),rm:u((t,r)=>{t=c(t),e._blockService.delete(t,r)}),stat:u((t,r)=>{t=c(t),e._blockService.get(t,(e,n)=>{if(e)return r(e);r(null,{key:i.toB58String(t.multihash),size:n.data.length})})})}}},function(e,t,r){\"use strict\";const n=r(17);e.exports=function(e){return{get:n((t,r)=>(\"function\"==typeof t&&(r=t,t=void 0),e._repo.config.get(t,r))),set:n((t,r,n)=>{e._repo.config.set(t,r,n)}),replace:n((t,r)=>{e._repo.config.set(t,r)})}}},function(e,t,r){\"use strict\";const n=r(292).Bootstrap,i=r(60).IPFS.matches,s=r(17);function o(e){try{return i(e)}catch(e){return!1}}function a(e){return new Error(`${e} is not a valid Multiaddr`)}e.exports=function(e){return{list:s(t=>{e._repo.config.get((e,r)=>{if(e)return t(e);t(null,{Peers:r.Bootstrap})})}),add:s((t,r,i)=>{if(\"function\"==typeof r&&(i=r,r={default:!1}),t&&!o(t))return setImmediate(()=>i(a(t)));e._repo.config.get((s,o)=>{if(s)return i(s);r.default?o.Bootstrap=n:t&&-1===o.Bootstrap.indexOf(t)&&o.Bootstrap.push(t),e._repo.config.set(o,e=>{if(e)return i(e);i(null,{Peers:r.default?n:[t]})})})}),rm:s((t,r,n)=>{if(\"function\"==typeof r&&(n=r,r={all:!1}),t&&!o(t))return setImmediate(()=>n(a(t)));e._repo.config.get((i,s)=>{if(i)return n(i);r.all?s.Bootstrap=[]:s.Bootstrap=s.Bootstrap.filter(e=>e!==t),e._repo.config.set(s,e=>{if(e)return n(e);const i=[];!r.all&&t&&i.push(t),n(null,{Peers:i})})})})}}},function(e,t){e.exports=require(\"string_decoder\")},function(e,t,r){var n=r(610).StringDecoder;e.exports=function(e){var t,r=new n(e);return function(e){return function(n,i){if(t)return i(t);e(n,function(e,n){t=e,!0===e?(n=r.end())?i(null,n):i(!0):e&&!0!==e?i(e):i(null,r.write(n))})}}}},function(e,t,r){\"use strict\";var n=r(52),i=r(611);e.exports=function(e,t){var r,s,o,a,u,c,f=t&&t.mode||438,l=t&&(t.bufferSize||t.buffer&&t.buffer.length)||65536,h=t&&t.start||0,p=t&&t.end||Number.MAX_SAFE_INTEGER,d=t&&t.fd,y=t&&t.buffer||new Buffer(l),m=t&&!!t.live;m&&(c=n.watch(e,{persistent:!1!==t.persistent},function(e){if(a&&\"change\"===e){var t=a;a=null,s=!1,v(t)}}));var g=t&&t.flags||\"r\";function v(e){if(s)m?a=e:b(e);else{var i=Math.min(p-h,l);o=!0,n.read(d,y,0,i,h,function(t,n,i){return o=!1,h+=n,s&&!m?(b(u),e(s)):r?e(t||r):t?e(t):void(n===i.length?e(null,i):0===n&&m?(a=e,s=!0):(s=!0,e(null,i.slice(0,n))))}),y=t&&t.buffer||new Buffer(Math.min(p-h,l))}}function b(e){if(!e)throw new Error(\"close must have cb\");return c&&c.close(),t&&!1===t.autoClose?e(!0):o?(u=e,s=!0):d?void n.close(d,function(t){d=null,e(t||!0)}):e(!0)}function w(t,i){t?(r=t,m=!1,a&&a(t||!0),b(i)):r?i(r):d?v(i):function(t){o=!0,n.open(e,g,f,function(e,r){return d=r,o=!1,s?(b(u),t(s)):e?t(e):v(t)})}(i)}return t&&t.encoding?i(t.encoding)(w):w}},function(e,t,r){\"use strict\";const n=r(5),i=r(1);e.exports=((e,t,r,s,o,a,u,c,f)=>{let l;if(s.length){const t=s[0],a=r+\"/\"+t;if(!(l=e[t]))return i.error(\"not found\");const u=n.isCID(l);return i(i.values([{depth:f,name:t,path:a,pathRest:s.slice(1),multihash:u&&l,object:!u&&l,parent:c}]),o)}return i.error(new Error(\"invalid node type\"))})},function(e,t,r){\"use strict\";const n=r(212),i=r(66),s=r(5),o=r(1),a=r(288);e.exports=((e,t,r,u,c,f,l,h,p)=>{const d=u[0];if(void 0!==d&&d!==r)return o.empty();let y=o(n.depthFirst(e,function(e){return o(o.values(e.links),a((e,t)=>l.get(new s(e.multihash),t)),o.map(e=>e.value))}),o.map(function(e){try{return i.unmarshal(e.data).data||Buffer.alloc(0)}catch(e){throw new Error(\"Failed to unmarshal node\")}}));const m=i.unmarshal(e.data);return o.values([{depth:p,content:y,name:t,path:r,hash:e.multihash,size:f||m.fileSize(),type:\"file\"}])})},function(e,t,r){\"use strict\";const n=r(23);e.exports=(e=>Buffer.isBuffer(e)?n.toB58String(e):e)},function(e,t,r){\"use strict\";const n=r(1),i=r(169),s=r(615);e.exports=function(e,t,r,o,a,u,c,f,l){let h;f&&f.path===r||(h={name:t,depth:l,path:r,hash:s(e.multihash),size:e.size,type:\"dir\"});const p=[n(n.values(e.links),n.map(e=>{const t=e.name.substring(2),n=t?r+\"/\"+t:r;let i=!0;return t&&o.length&&(i=t===o[0]),i?{depth:l+1,name:t,path:n,multihash:e.multihash,pathRest:t?o.slice(1):o,parent:h||f}:\"\"}),n.filter(Boolean),a)];o.length||p.unshift(n.values([h]));return i(p)}},function(e,t,r){\"use strict\";const n=r(1),i=r(169);e.exports=function(e,t,r,s,o,a,u,c,f){const l=s[0],h={name:t,depth:f,path:r,hash:e.multihash,size:e.size,type:\"dir\"},p=[n(n.values(e.links),n.map(e=>({depth:f+1,size:e.size,name:e.name,path:r+\"/\"+e.name,multihash:e.multihash,linkName:e.name,pathRest:s.slice(1),type:\"dir\"})),n.filter(e=>void 0===l||e.linkName===l),o)];s.length||p.unshift(n.values([h]));return i(p)}},function(e,t){e.exports=function(e){var t=!1,r=0;return function(){if(r=!0,!t){for(t=!0;r;)r=!1,e();t=!1}}}},function(e,t,r){\"use strict\";const n=r(66),i=r(1),s=r(288),o=r(5),a={directory:r(617),\"hamt-sharded-directory\":r(616),file:r(614),object:r(613)};function u(e,t,r,n){if(!r){r=0}if(r>t.maxDepth){return i.map(f)}return i(s((t,r)=>{if(typeof t.depth!==\"number\"){return i.error(new Error(\"no depth\"))}if(t.object){return r(null,l(t.object,t))}e.get(new o(t.multihash),(e,n)=>{if(e){return r(e)}r(null,l(n.value,t))})}),i.flatten(),i.filter(Boolean),i.filter(e=>e.depth<=t.maxDepth));function l(t,r){return h(t,r.name,r.path,r.pathRest,r.size,e,r.parent||n,r.depth)}function h(e,r,n,s,o,f,l,h){const p=c(e),d=a[p];if(!d){return i.error(new Error(\"Unkown node type \"+p))}const y=u(f,t,h,e);return d(e,r,n,s,y,o,f,l,h)}}function c(e){return Buffer.isBuffer(e.data)?n.unmarshal(e.data).type:\"object\"}function f(e){return e}e.exports=Object.assign({createResolver:function(e,t,r,n){r||(r=0);if(r>t.maxDepth)return i.map(f);return i(s((t,r)=>\"number\"!=typeof t.depth?i.error(new Error(\"no depth\")):t.object?r(null,l(t.object,t)):void e.get(new o(t.multihash),(e,n)=>{if(e)return r(e);r(null,l(n.value,t))})),i.flatten(),i.filter(Boolean),i.filter(e=>e.depth<=t.maxDepth));function l(r,s){return function(e,r,n,s,o,f,l,h){const p=c(e),d=a[p];if(!d)return i.error(new Error(\"Unkown node type \"+p));const y=u(f,t,h,e);return d(e,r,n,s,y,o,f,l,h)}(r,s.name,s.path,s.pathRest,s.size,e,s.parent||n,s.depth)}},typeOf:c},a)},function(e,t,r){\"use strict\";const n=r(1),i=r(5),s=r(619).createResolver;const o={maxDepth:1/0};var a;e.exports=((e,t,r)=>{const u=Object.assign({},o,r);let c;try{c=function(e){let t=e,r=\"/\";if(Buffer.isBuffer(e)&&(t=new i(e).toBaseEncodedString()),\"string\"==typeof e){0===e.indexOf(\"/ipfs/\")&&(e=t=e.substring(6));const n=e.indexOf(\"/\");n>0&&(t=e.substring(0,n),r=e.substring(n))}else i.isCID(t)&&(t=t.toBaseEncodedString());return{base:t=new i(t).toBaseEncodedString(),rest:r.split(\"/\").filter(Boolean)}}(e)}catch(e){return n.error(e)}const f=(a=[c.base].concat(c.rest.slice(0,c.rest.length-1)),a.reduce((e,t)=>(e.length&&(e+=\"/\"),e+t),\"\")).length;return n(n.values([{multihash:new i(c.base),name:c.base,path:c.base,pathRest:c.rest,depth:0}]),s(t,u),n.filter(Boolean),n.map(e=>({depth:e.depth,name:e.name,path:function(e){if(!c.rest.length)return e.path;let t=e.path.substring(f);\"/\"===t.charAt(0)&&(t=t.substring(1));t||(t=c.rest[c.rest.length-1]||c.base);return t}(e),size:e.size,hash:e.hash||e.multihash,content:e.content,type:e.type})))})},function(e,t,r){\"use strict\";var n=r(121);function i(e){return 1===e.length?e[0]:Buffer.concat(e)}function s(e,t,r){return 0===t&&r===e.length?e:e.slice(t,r)}e.exports=function(e,t){var r;t||(t={}),\"object\"==typeof e&&(e=(t=e).size),e=e||512,r=!t.nopad&&(void 0===t.zeroPadding||t.zeroPadding);var o=[],a=0,u=0,c=!1;return n(function(t){for(\"number\"==typeof t&&(t=Buffer.from([t])),a+=t.length,o.push(t);a>=e;){for(var r,n,f,l=0,h=[],p=0;l<e;)r=o[p],n=Math.min(u+e-l,r.length),l+=(f=s(r,u,n)).length,h.push(f),n===r.length?(p++,u=0):u+=f.length;o=o.slice(p),a-=l,this.queue(i(h)),c=!0}},function(n){if(t.emitEmpty&&!c||a){if(r){var s=Buffer.alloc(e-a);s.fill(0),o.push(s)}o&&(o.length>0&&(o[0]=o[0].slice(u)),this.queue(i(o)),o=null)}this.queue(null)})}},function(e,t,r){\"use strict\";const n=r(621);e.exports=(e=>{let t=\"number\"==typeof e?e:e.maxChunkSize;return n(t,{zeroPadding:!1,emitEmpty:!0})})},function(e,t,r){\"use strict\";const n=[255,254,252,248,240,224,192,128],i=[1,3,7,15,31,63,127,255];function s(e,t,r){return(e&function(e,t){return n[e]&i[Math.min(t+e-1,7)]}(t,r))>>>t}e.exports=class{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t&&this._haveBits();){const e=this._value[this._currentBytePos],n=this._currentBitPos+1,i=Math.min(n,t);r=(r<<i)+s(e,n-i,i),t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}},function(e,t,r){\"use strict\";const n=r(146),i=r(623);e.exports=function(e){return function(t){return t instanceof s?t:new s(t,e)}};class s{constructor(e,t){if(\"string\"!=typeof e&&!Buffer.isBuffer(e))throw new Error(\"can only hash strings or buffers\");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}take(e,t){let r=e;n(()=>this._availableBits<r,e=>{this._produceMoreBits(e)},e=>{if(e)return void t(e);let i=0;n(()=>r>0,e=>{const t=this._buffers[this._currentBufferIndex],n=Math.min(t.availableBits(),r),s=t.take(n);i=(i<<n)+s,r-=n,this._availableBits-=n,0===t.availableBits()&&this._currentBufferIndex++,e()},e=>{e?t(e):process.nextTick(()=>t(null,i))})})}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}_produceMoreBits(e){this._depth++;const t=this._depth?this._value+this._depth:this._value;this._hashFn(t,(t,r)=>{if(t)return void e(t);const n=new i(r);this._buffers.push(n),this._availableBits+=n.availableBits(),e()})}}},function(e,t,r){\"use strict\";function n(e,t){return e+i(t)}function i(e){let t=e;return 16843009*((t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135)>>24}function s(e,t){return e[0]-t[0]}function o(e){return e[1]}e.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let r=this._internalPositionFor(e,!1);if(void 0===t)-1!==r&&(this._unsetInternalPos(r),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let n=!1;-1===r?(r=this._data.length,this._setBit(e),this._changedData=!0):n=!0,this._setInternalPos(r,e,t,n),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();const t=this._internalPositionFor(e,!0);if(-1!==t)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){const e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,r=new Array(this.length);for(;t<this.length;)r[t]=e(this.get(t),t,this),t++;return r}reduce(e,t){let r=0,n=t;for(;r<this.length;){n=e(n,this.get(r),r),r++}return n}find(e){let t,r,n=0;for(;n<this.length&&!t;)t=e(r=this.get(n)),n++;return t?r:void 0}_internalPositionFor(e,t){const r=this._bytePosFor(e,t);if(r>=this._bitArrays.length)return-1;const s=this._bitArrays[r],o=e-7*r;return(s&1<<o)>0?this._bitArrays.slice(0,r).reduce(n,0)+i(s&~(4294967295<<o+1))-1:-1}_bytePosFor(e,t){const r=Math.floor(e/7),n=r+1;for(;!t&&this._bitArrays.length<n;)this._bitArrays.push(0);return r}_setBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-7*t}_unsetBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-7*t)}_setInternalPos(e,t,r,n){const i=this._data,s=[t,r];if(n)this._sortData(),i[e]=s;else{if(i.length)if(i[i.length-1][0]>=t)i.push(s);else if(i[0][0]<=t)i.unshift(s);else{const e=Math.round(i.length/2);this._data=i.slice(0,e).concat(s).concat(i.slice(e))}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(s)}bitField(){const e=[];let t,r=8,n=0,i=0;const s=this._bitArrays.slice();for(;s.length||n;){0===n&&(t=s.shift(),n=7);const o=Math.min(n,r);i|=(t&~(255<<o))<<8-r,t>>>=o,n-=o,(r-=o)&&(n||s.length)||(e.push(i),i=0,r=8)}for(var o=e.length-1;o>0;o--){if(0!==e[o])break;e.pop()}return e}compactArray(){return this._sortData(),this._data.map(o)}}},function(e,t,r){\"use strict\";const n=r(625),i=r(74),s=r(123),o=r(624),a={bits:8};class u{constructor(e,t,r){if(this._options=Object.assign({},a,e),this._popCount=0,this._parent=t,this._posAtParent=r,!this._options.hashFn)throw new Error(\"please define an options.hashFn\");this._options.hash||(this._options.hash=o(this._options.hashFn)),this._children=new n}static isBucket(e){return e instanceof u}put(e,t,r){this._findNewBucketAndPos(e,(n,i)=>{n?r(n):(i.bucket._putAt(i,e,t),r())})}get(e,t){this._findChild(e,(e,r)=>{e?t(e):t(null,r&&r.value)})}del(e,t){this._findPlace(e,(r,n)=>{if(r)return void t(r);const i=n.bucket._at(n.pos);i&&i.key===e&&n.bucket._delAt(n.pos),t(null)})}leafCount(){this._children.reduce((e,t)=>t instanceof u?e+t.leafCount():e+1,0)}childrenCount(){return this._children.length}onlyChild(e){process.nextTick(()=>e(null,this._children.get(0)))}eachLeafSeries(e,t){s(this._children.compactArray(),(t,r)=>{t instanceof u?t.eachLeafSeries(e,r):e(t.key,t.value,r)},t)}serialize(e,t){return t(this._children.reduce((r,n,i)=>(n&&(n instanceof u?r.push(n.serialize(e,t)):r.push(e(n,i))),r),[]))}asyncTransform(e,t,r){!function e(t,r,n,s){i(t._children.compactArray(),(i,s)=>{i instanceof u?e(i,r,n,s):r(i,(e,r)=>{e?s(e):s(null,{bitField:t._children.bitField(),children:r})})},(e,t)=>{e?s(e):n(t,s)})}(this,e,t,r)}toJSON(){return this.serialize(f,l)}prettyPrint(){return JSON.stringify(this.toJSON(),null,\"  \")}tableSize(){return Math.pow(2,this._options.bits)}_findChild(e,t){this._findPlace(e,(r,n)=>{if(r)return void t(r);const i=n.bucket._at(n.pos);i&&i.key===e?t(null,i):t(null,void 0)})}_findPlace(e,t){const r=this._options.hash(e);r.take(this._options.bits,(e,n)=>{if(e)return void t(e);const i=this._children.get(n);if(i instanceof u)i._findPlace(r,t);else{t(null,{bucket:this,pos:n,hash:r})}})}_findNewBucketAndPos(e,t){this._findPlace(e,(r,n)=>{if(r)return void t(r);const i=n.bucket._at(n.pos);if(i&&i.key!==e){const e=new u(this._options,n.bucket,n.pos);n.bucket._putObjectAt(n.pos,e),e._findPlace(i.hash,(r,s)=>{r?t(r):(s.bucket._putAt(s,i.key,i.value),e._findNewBucketAndPos(n.hash,t))})}else t(null,n)})}_putAt(e,t,r){this._putObjectAt(e.pos,{key:t,value:r,hash:e.hash})}_putObjectAt(e,t){this._children.get(e)||this._popCount++,this._children.set(e,t)}_delAt(e){this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent&&this._popCount<=1)if(1===this._popCount){const e=this._children.find(c);if(!(e instanceof u)){const t=e.hash;t.untake(this._options.bits);const r={pos:this._posAtParent,hash:t};this._parent._putAt(r,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function c(e){return Boolean(e)}function f(e,t){return e.key}function l(e){return e}e.exports=u},function(e,t,r){\"use strict\";const n=r(626);e.exports=function(e){return new n(e)},e.exports.isBucket=n.isBucket},function(e,t,r){\"use strict\";const n=r(217),i=r(146),s=r(3),o=r(5),a=r(84),u=r(66),c=a.DAGLink,f=a.DAGNode,l=r(31),h=r(170),p=r(627),d=function(e,t){l(e,\"murmur3-128\",(e,r)=>{if(e)t(e);else{const e=r.slice(2,10),n=e.length,i=Buffer.alloc(n);for(let t=0;t<n;t++)i[n-t-1]=e[t];t(null,i)}})};d.code=34;const y={hashFn:d};class m extends h{constructor(e,t){const r=Object.assign({},y,t);super(e,r),this._bucket=p(r)}put(e,t,r){this._bucket.put(e,t,r)}get(e,t){this._bucket.get(e,t)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(e){this._bucket.onlyChild(e)}eachChildSeries(e,t){this._bucket.eachLeafSeries(e,t)}flush(e,t,r,a){!function(e,t,r,a,l,h){const d=t._children;let y=0;const m=[];i(()=>y<d.length,t=>{const i=d.get(y);i?function(t,i,s){const o=n(i.toString(16).toUpperCase(),2,\"0\");if(p.isBucket(t))g(e,t,r,a,null,(e,t)=>{e?s(e):(m.push(new c(o,t.size,t.multihash)),s())});else{const e=t.value,r=o+t.key;m.push(new c(r,e.size,e.multihash)),s()}}(i,y,e=>{y++,t(e)}):(y++,t())},n=>{n?h(n):function(n){const i=Buffer.from(d.bitField().reverse()),c=new u(\"hamt-sharded-directory\",i);c.fanout=t.tableSize(),c.hashType=e.hashFn.code,s([t=>f.create(c.marshal(),n,e.hashAlg,t),(t,r)=>{if(e.onlyHash)return r(null,t);let n=new o(t.multihash);1===e.cidVersion&&(n=n.toV1()),a.put(t,{cid:n},e=>r(e,t))},(e,t)=>{const n={path:r,multihash:e.multihash,size:e.size};l&&l.push(n),t(null,e)}],h)}(m)})}(this._options,this._bucket,e,t,r,(e,t)=>{e?a(e):(this.multihash=t.multihash,this.size=t.size),a(null,t)})}}function g(e,t,r,a,l,h){const d=t._children;let y=0;const m=[];i(()=>y<d.length,e=>{const t=d.get(y);if(t){v(t,y,t=>{y++;e(t)})}else{y++;e()}},e=>{if(e){h(e);return}b(m)});function v(t,i,s){const o=n(i.toString(16).toUpperCase(),2,\"0\");if(p.isBucket(t)){g(e,t,r,a,null,(e,t)=>{if(e){s(e);return}m.push(new c(o,t.size,t.multihash));s()})}else{const e=t.value;const r=o+t.key;m.push(new c(r,e.size,e.multihash));s()}}function b(n){const i=Buffer.from(d.bitField().reverse()),c=new u(\"hamt-sharded-directory\",i);c.fanout=t.tableSize(),c.hashType=e.hashFn.code,s([t=>f.create(c.marshal(),n,e.hashAlg,t),(t,r)=>{if(e.onlyHash)return r(null,t);let n=new o(t.multihash);if(e.cidVersion===1){n=n.toV1()}a.put(t,{cid:n},e=>r(e,t))},(e,t)=>{const n={path:r,multihash:e.multihash,size:e.size};if(l){l.push(n)}t(null,e)}],h)}}e.exports=function(e,t){return new m(e,t)}},function(e,t,r){\"use strict\";const n=r(3),i=r(628);e.exports=function e(t,r,s,o,a){!function(e,t,r,n){e.flat&&e.directChildrenCount()>=t?function(e,t,r){const n=i({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1},t);e.eachChildSeries((e,t,r)=>{n.put(e,t,r)},e=>{e?r(e):r(e,n)})}(e,r,n):n(null,e)}(r,s,o,(i,u)=>{if(i)return void a(i);const c=u.parent;c?n([e=>{u!==r?(t&&(t.parent=u),c.put(u.parentKey,u,e)):e()},t=>{c?e(u,c,s,o,t):t(null,u)}],a):a(null,u)})}},function(e,t,r){\"use strict\";const n=r(123),i=r(3),s=r(5),o=r(84),a=r(66),u=o.DAGLink,c=o.DAGNode,f=r(170);class l extends f{constructor(e,t){super(e,t),this._children={}}put(e,t,r){this.multihash=void 0,this.size=void 0,this._children[e]=t,process.nextTick(r)}get(e,t){process.nextTick(()=>t(null,this._children[e]))}childCount(){return Object.keys(this._children).length}directChildrenCount(){return this.childCount()}onlyChild(e){process.nextTick(()=>e(null,this._children[Object.keys(this._children)[0]]))}eachChildSeries(e,t){n(Object.keys(this._children),(t,r)=>{e(t,this._children[t],r)},t)}flush(e,t,r,n){const o=Object.keys(this._children).map(e=>{const t=this._children[e];return new u(e,t.size,t.multihash)}),f=new a(\"directory\"),l=this._options;i([e=>c.create(f.marshal(),o,l.hashAlg,e),(e,r)=>{if(l.onlyHash)return r(null,e);let n=new s(e.multihash);1===l.cidVersion&&(n=n.toV1()),t.put(e,{cid:n},t=>r(t,e))},(t,n)=>{this.multihash=t.multihash,this.size=t.size;const i={path:e,multihash:t.multihash,size:t.size};r.push(i),n(null,t)}],n)}}e.exports=function(e,t){return new l(e,t)}},function(e,t){e.exports=require(\"async/eachOfSeries\")},function(e,t,r){\"use strict\";const n=r(123),i=r(631),s=r(3),o=r(104),a=r(122),u=r(46),c=r(630),f=r(629),l=r(170);e.exports=function(e,t){const r=Object.assign({},h,t),d=o(function(e,t){const r=e.args.concat(function(){e.cb.apply(null,arguments),t()});e.fn.apply(null,r)},1);let y=function(){const e=a(function(e,r){n(e,(e,r)=>{d.push({fn:g,args:[e],cb:n=>{n?r(n):(t.push(e),r())}})},r)},null,1,function(e){v(r=>{t.end(r||e)})}),t=u();return{sink:e,source:t}}(),m=c({path:\"\",root:!0,dir:!0,dirty:!1,flat:!0},r);return{flush:v,stream:function(){return y}};function g(e,t){const n=(e.path||\"\").split(\"/\").filter(p);let o=m;const a=n.length-1;let u=\"\";i(n,(t,n,i)=>{u&&(u+=\"/\"),u+=t;const h=n===a;o.dirty=!0,o.multihash=null,o.size=null,h?s([r=>o.put(t,e,r),e=>f(null,o,r.shardSplitThreshold,r,e),(e,t)=>{m=e,t()}],i):o.get(t,(e,n)=>{if(e)return void i(e);let s=n;s&&s instanceof l||(s=c({dir:!0,parent:o,parentKey:t,path:u,dirty:!0,flat:!0},r));const a=o;o=s,a.put(t,s,i)})},t)}function v(e){d.push({fn:b,args:[\"\",m],cb:(t,r)=>{t?e(t):e(null,r&&r.multihash)}})}function b(t,n,i){if(n.dir){if(n.root&&n.childCount()>1&&!r.wrap)return void i(new Error(\"detected more than one root\"));n.eachChildSeries((e,r,n)=>{b(t?t+\"/\"+e:e,r,n)},s=>{s?i(s):function(t,n,i){if(n.root&&!r.wrap)return void n.onlyChild((e,t)=>{e?i(e):i(null,t)});if(!n.dirty)return void i(null,n.multihash);n.dirty=!1,n.flush(t,e,y.source,(e,t)=>{e?i(e):i(null,t)})}(t,n,i)})}else process.nextTick(i)}};const h={wrap:!1,shardSplitThreshold:1e3,onlyHash:!1};function p(e){return Boolean(e)}},function(e,t,r){\"use strict\";const n=r(1),i=r(46),s=r(171),o=r(120),a=r(121),u=r(122),c=r(290);e.exports=function(e,t){const r=o(),f=i(),l=c(()=>{});let h=0;return n(r.source,l,function r(o,c){let f=0;let p=0;let d;let y=!1;const m=i();return{source:m,sink:u(function g(r,c){let f=!1;const y=r[0];p&&!d&&(d=i(),n(d,function r(o,c){let f=0;let p=0;let d;let y=!1;const m=i();return{source:m,sink:u(g,null,1,function(e){if(e)return void m.end(e);d?y||(y=!0,d.end()):m.end()})};function g(t,u){let c=!1;const f=t[0];p&&!d&&(d=i(),n(d,r(o+1,p-1),a(function(e){this.queue(e)},function(e){e?this.emit(\"error\",e):(c||(c=!0,h++,l.pause()),this.queue(null))}),s(1/0),n.asyncMap(e),n.collect((e,t)=>{h--,e?m.end(e):(t.forEach(e=>{m.push(e)}),v())}))),d?d.push(f):(m.push(f),v()),u()}function v(){d=null,f++,(0===p&&f===t.maxChildrenPerNode||p>0&&f===t.layerRepeat)&&(f=0,p++),(!y&&c>=0&&p>c||y&&!h)&&(y=!0,m.end()),h||l.resume()}}(o+1,p-1),a(function(e){this.queue(e)},function(e){e?this.emit(\"error\",e):(f||(f=!0,h++,l.pause()),this.queue(null))}),s(1/0),n.asyncMap(e),n.collect((e,t)=>{h--,e?m.end(e):(t.forEach(e=>{m.push(e)}),v())})));d?d.push(y):(m.push(y),v());c()},null,1,function(e){if(e)return void m.end(e);d?y||(y=!0,d.end()):m.end()})};function g(t,u){let c=!1;const f=t[0];p&&!d&&(d=i(),n(d,r(o+1,p-1),a(function(e){this.queue(e)},function(e){e?this.emit(\"error\",e):(c||(c=!0,h++,l.pause()),this.queue(null))}),s(1/0),n.asyncMap(e),n.collect((e,t)=>{h--,e?m.end(e):(t.forEach(e=>{m.push(e)}),v())}))),d?d.push(f):(m.push(f),v()),u()}function v(){d=null,f++,(0===p&&f===t.maxChildrenPerNode||p>0&&f===t.layerRepeat)&&(f=0,p++),(!y&&c>=0&&p>c||y&&!h)&&(y=!0,m.end()),h||l.resume()}}(0,-1),s(1/0),n.asyncMap(e),n.collect((e,t)=>{e?f.end(e):1===t.length?(f.push(t[0]),f.end()):t.length>1?f.end(new Error(\"expected a maximum of 1 roots and got \"+t.length)):f.end()})),{sink:r.sink,source:f}}},function(e,t,r){\"use strict\";const n=r(633),i={maxChildrenPerNode:174,layerRepeat:4};e.exports=function(e,t){const r=Object.assign({},i,t);return n(e,r)}},function(e,t,r){\"use strict\";const n=r(1),i=r(46),s=r(120),o=r(171);e.exports=function(e,t){const r=s(),a=r.source,u=i();return function r(i,s){let a=i;Array.isArray(a)&&(a=n.values(a));n(a,o(t.maxChildrenPerNode),n.asyncMap(e),n.collect(function u(r,i){r?s(r):i.length>1?function r(i,s){let a=i;Array.isArray(a)&&(a=n.values(a));n(a,o(t.maxChildrenPerNode),n.asyncMap(e),n.collect(u));function u(e,t){e?s(e):t.length>1?r(t,s):s(null,t)}}(i,s):s(null,i)}));function u(e,t){e?s(e):t.length>1?r(t,s):s(null,t)}}(a,(e,t)=>{e?u.end(e):1===t.length?(u.push(t[0]),u.end()):t.length>1?u.end(new Error(\"expected a maximum of 1 roots and got \"+t.length)):u.end()}),{sink:r.sink,source:u}}},function(e,t,r){\"use strict\";const n=r(635),i={maxChildrenPerNode:174};e.exports=function(e,t){const r=Object.assign({},i,t);return n(e,r)}},function(e,t,r){\"use strict\";const n=r(1),i=r(46),s=r(120),o=r(171);e.exports=function(e,t){const r=s(),a=r.source,u=i();return n(a,o(1/0),n.asyncMap(e),n.collect((e,t)=>{e?u.end(e):1===t.length?(u.push(t[0]),u.end()):t.length>1?u.end(new Error(\"expected a maximum of 1 roots and got \"+t.length)):u.end()})),{sink:r.sink,source:u}}},function(e,t,r){\"use strict\";const n=r(3),i=r(84),s=r(66),o=r(5),a=i.DAGLink,u=i.DAGNode;e.exports=function(e,t,r){return function(i,c){if(1===i.length&&(i[0].single||r.reduceSingleLeafToSelf)){const t=i[0];return void c(null,{path:e.path,multihash:t.multihash,size:t.size,leafSize:t.leafSize,name:t.name})}const f=new s(\"file\"),l=i.map(e=>(f.addBlockSize(e.leafSize),new a(e.name,e.size,e.multihash)));n([e=>u.create(f.marshal(),l,r.hashAlg,e),(e,n)=>{if(r.onlyHash)return n(null,e);let i=new o(e.multihash);1===r.cidVersion&&(i=i.toV1()),t.put(e,{cid:i},t=>n(t,e))}],(t,r)=>{if(t)return void c(t);const n={name:\"\",path:e.path,multihash:r.multihash,size:r.size,leafSize:f.fileSize()};c(null,n)})}}},function(e,t,r){\"use strict\";e.exports=\"message Data {\\n  enum DataType {\\n    Raw = 0;\\n    Directory = 1;\\n    File = 2;\\n    Metadata = 3;\\n    Symlink = 4;\\n    HAMTShard = 5;\\n  }\\n\\n  required DataType Type = 1;\\n  optional bytes Data = 2;\\n  optional uint64 filesize = 3;\\n  repeated uint64 blocksizes = 4;\\n\\n  optional uint64 hashType = 5;\\n  optional uint64 fanout = 6;\\n}\\n\\nmessage Metadata {\\n  required string MimeType = 1;\\n}\"},function(e,t,r){\"use strict\";const n=r(176),i=r(66),s=r(1),o=r(121),a=r(54),u=r(3),c=r(84),f=r(5),l=r(638),h=c.DAGNode,p={chunkerOptions:{maxChunkSize:262144}};e.exports=function(e,t,r,c){const d=n({},p,c);return function(n){return function(c,p){a(c.map(a=>c=>{if(!a.content)return function(e,r){const n=new i(\"directory\");u([e=>h.create(n.marshal(),[],d.hashAlg,e),(e,r)=>{if(d.onlyHash)return r(null,e);let n=new f(e.multihash);1===d.cidVersion&&(n=n.toV1()),t.put(e,{cid:n},t=>r(t,e))}],(t,n)=>{if(t)return r(t);r(null,{path:e.path,multihash:n.multihash,size:n.size})})}(a,(e,t)=>{if(e)return c(e);t&&n.push(t),c()});!function(n,a){Buffer.isBuffer(n.content)&&(n.content=s.values([n.content]));if(\"function\"!=typeof n.content)return a(new Error(\"invalid content\"));const u=r(l(n,t,d),d);let c,p=0;s(n.content,e(d.chunkerOptions),s.map(e=>(d.progress&&\"function\"==typeof d.progress&&d.progress(e.byteLength),Buffer.from(e))),s.map(e=>new i(\"file\",e)),s.asyncMap((e,t)=>{h.create(e.marshal(),[],d.hashAlg,(r,n)=>{t(r,{DAGNode:n,fileNode:e})})}),s.asyncMap((e,r)=>{if(d.onlyHash)return r(null,e);let n=new f(e.DAGNode.multihash);1===d.cidVersion&&(n=n.toV1()),t.put(e.DAGNode,{cid:n},t=>r(t,e))}),s.map(e=>({path:n.path,multihash:e.DAGNode.multihash,size:e.DAGNode.size,leafSize:e.fileNode.fileSize(),name:\"\"})),o(function(e){p++,c&&this.queue(c),c=e},function(){c&&(1===p&&(c.single=!0),this.queue(c)),this.queue(null)}),u,s.collect((e,t)=>{e?a(e):a(null,t[0])}))}(a,(e,t)=>{if(e)return c(e);t&&n.push(t),c()})}),p)}}}},function(e,t,r){\"use strict\";const n=r(46),i=r(122);e.exports=function(e,t,r){const s=n(),o=i(e(s),null,r.highWaterMark,e=>s.end(e));return{source:s,sink:o}}},function(e,t,r){\"use strict\";const n=r(10),i=r(641),s=r(640),o={flat:r(637),balanced:r(636),trickle:r(634)},a={strategy:\"balanced\",highWaterMark:100,reduceSingleLeafToSelf:!1};e.exports=function(e,t,r){n(e,\"Missing chunker creator function\"),n(t,\"Missing IPLD\");const u=Object.assign({},a,r),c=u.strategy,f=o[c];n(f,\"Unknown importer build strategy name: \"+c);const l=s(e,t,f,u);return i(l,t,u)}},function(e,t){e.exports=function(e){var t=!1,r=0;return function(){if(r=!0,!t){for(t=!0;r;)r=!1,e();t=!1}}}},function(e,t,r){\"use strict\";const n=r(290),i=r(1),s=r(122),o=r(46),a=r(10),u=r(2),c=r(642),f=r(632),l={fixed:r(622)},h={chunker:\"fixed\"};e.exports=function(e,t){const r=Object.assign({},h,t),p=l[r.chunker];a(p,\"Unknkown chunker named \"+r.chunker);let d=0;const y=[],m={sink:s((e,t)=>{d+=e.length,e.forEach(e=>m.source.push(e)),u(t)},null,1,e=>m.source.end(e)),source:o()},g=c(p,e,r),v=f(e,r),b=v.stream(),w=n(()=>{});return i(m,w,g,i.map(e=>(--d||process.nextTick(()=>{for(;y.length;)y.shift()()}),e)),b),{sink:m.sink,source:b.source,flush:function(e){w.pause(),d?y.push(t):t();function t(){v.flush((t,r)=>{if(t)return b.source.end(t),void e(t);w.resume(),e(null,r)})}}}}},function(e,t,r){\"use strict\";(function(t){const n=r(25),i=r(52),s=r(213),o=r(291).importer,a=r(1),u=r(612),c=r(5);e.exports=function(e,r,f){const l=n.join(t,\"../../init-files/init-docs\"),h=l.lastIndexOf(n.sep);a(a.values([l]),a.asyncMap((e,t)=>s(n.join(e,\"/**/*\"),t)),a.flatten(),a.map(e=>{const t=e.substring(h+1);if(!i.statSync(e).isDirectory())return{path:t,content:u(e)}}),a.filter(Boolean),o(e._ipld),a.through(e=>{if(\"init-docs\"===e.path){const t=new c(e.multihash);r(\"to get started, enter:\\n\"),r(`\\t jsipfs files cat /ipfs/${t.toBaseEncodedString()}/readme\\n`)}}),a.collect(e=>{if(e)return f(e);f(null,!0)}))}}).call(this,\"/\")},function(e,t,r){\"use strict\";const n=r(14),i=r(3),s=r(54),o=r(17),a=r(292),u=r(298),c=r(645);e.exports=function(e){return o((t,r)=>{\"function\"==typeof t&&(r=t,t={});const o=(t,n)=>{if(t)return e.emit(\"error\",t),r(t);e.state.initialized(),e.emit(\"init\"),r(null,n)};if(\"uninitalized\"!==e.state.state())return o(new Error(\"Not able to init from state: \"+e.state.state()));let f;e.state.init(),e.log(\"init\"),t.emptyRepo=t.emptyRepo||!1,t.bits=Number(t.bits)||2048,t.log=t.log||function(){},i([t=>e._repo.exists(t),(r,i)=>{if(e.log(\"repo exists?\",r),!0===r)return i(new Error(\"repo already exists\"));t.log(`generating ${t.bits}-bit RSA keypair...`,!1),e.log(\"generating peer id: %s bits\",t.bits),n.create({bits:t.bits},i)},(r,n)=>{e.log(\"identity generated\"),a.Identity={PeerID:r.toB58String(),PrivKey:r.privKey.bytes.toString(\"base64\")},t.pass&&(f=r.privKey,a.Keychain=u.generateOptions()),t.log(\"done\"),t.log(\"peer identity: \"+a.Identity.PeerID),e._repo.init(a,n)},(t,r)=>e._repo.open(r),r=>{if(e.log(\"repo opened\"),t.pass){e.log(\"creating keychain\");const n=Object.assign({passPhrase:t.pass},a.Keychain);e._keychain=new u(e._repo.keys,n),e._keychain.importPeer(\"self\",{privKey:f},r)}else r(null,!0)},(r,n)=>{if(t.emptyRepo)return n(null,!0);e.log(\"adding assets\");const i=[t=>e.object.new(\"unixfs-dir\",t)];\"function\"==typeof c&&i.push(r=>c(e,t.log,r)),s(i,e=>{e?n(e):n(null,!0)})}],o)})}},function(e,t,r){\"use strict\";const n=r(17),i=r(2),s=r(294).version;e.exports=function(e){return n((t,r)=>{\"function\"==typeof t&&(r=t,t={}),i(()=>r(null,{id:e._peerInfo.id.toB58String(),publicKey:e._peerInfo.id.pubKey.bytes.toString(\"base64\"),addresses:e._peerInfo.multiaddrs.toArray().map(e=>e.toString()).filter(e=>e.indexOf(\"ipfs\")>=0).sort(),agentVersion:`js-ipfs/${s}`,protocolVersion:\"9000\"}))})}},function(e,t,r){\"use strict\";const n=r(294),i=r(17);e.exports=function(e){return i((t,r)=>{\"function\"==typeof t&&(r=t,t={}),e.repo.version((e,t)=>{e&&r(e),r(null,{version:n.version,repo:t,commit:\"\"})})})}},function(e,t,r){\"use strict\";e.exports=function(e){return()=>Boolean(e._bitswap&&e._libp2pNode&&e._libp2pNode.isStarted())}},function(e,t,r){\"use strict\";const n=r(30),i=r(17);e.exports=(e=>i(t=>{if(t=t||function(){},e.log(\"stop\"),\"stopped\"===e.state.state())return t(new Error(\"Already stopped\"));if(\"running\"!==e.state.state())return t(new Error(\"Not able to stop from state: \"+e.state.state()));e.state.stop(),e._blockService.unsetExchange(),e._bitswap.stop(),n([t=>e.libp2p.stop(t),t=>e._repo.close(t)],r=>{if(r)return e.emit(\"error\",r),t(r);e.state.stopped(),e.emit(\"stop\"),t()})}))},function(e,t,r){\"use strict\";const n=Math.exp;e.exports=function(e){if(\"number\"!=typeof e)throw new Error(\"must provide a timespan to the moving average constructor\");if(e<=0)throw new Error(\"must provide a timespan > 0 to the moving average constructor\");let t,r,i=0,s=0,o=0,a={};return a.push=function(a,u){if(r){const c=1-n(-(a-r)/e),f=u-t;t=c*u+(1-c)*t,i=(1-c)*(i+f*(c*f)),s=Math.sqrt(i),o=t+c*f}else t=u;r=a},a.movingAverage=function(){return t},a.variance=function(){return i},a.deviation=function(){return s},a.forecast=function(){return o},a}},function(e,t,r){\"use strict\";const n=r(11),i=r(149),s=r(651);e.exports=class extends n{constructor(e,t){super(),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach(e=>{this._stats[e]=i(0),this._movingAverages[e]={},this._options.movingAverageIntervals.forEach(t=>{(this._movingAverages[e][t]=s(t)).push(this._frequencyLastTime,0)})}),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(;this._queue.length;){const t=e=this._queue.shift();this._applyOp(t)}this._updateFrequency(e[2]),this.emit(\"update\",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;Object.keys(this._stats).forEach(r=>{this._updateFrequencyFor(r,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,r){const n=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;const i=n/t*1e3;let o=this._movingAverages[e];o||(o=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach(e=>{let t=o[e];t||(t=o[e]=s(e)),t.push(r,i)})}_applyOp(e){const t=e[0],r=e[1];if(\"number\"!=typeof r)throw new Error(\"invalid increment number:\",r);let n;n=this._stats.hasOwnProperty(t)?this._stats[t]:this._stats[t]=i(0),this._stats[t]=n.plus(r),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=r}}},function(e,t,r){\"use strict\";const n=r(11),i=r(652),s={movingAverageIntervals:[6e4,3e5,9e5]};e.exports=class extends n{constructor(e,t){super();const r=Object.assign({},s,t);if(\"number\"!=typeof r.computeThrottleTimeout)throw new Error(\"need computeThrottleTimeout\");if(\"number\"!=typeof r.computeThrottleMaxQueueSize)throw new Error(\"need computeThrottleMaxQueueSize\");this._initialCounters=e,this._options=r,this._enabled=this._options.enabled,this._global=new i(e,r),this._global.on(\"update\",e=>this.emit(\"update\",e)),this._peers=new Map}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(let e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){return e.toB58String&&(e=e.toB58String()),this._peers.get(e)}push(e,t,r){if(this._enabled&&(this._global.push(t,r),e)){let n=this._peers.get(e);n||(n=new i(this._initialCounters,this._options),this._peers.set(e,n)),n.push(t,r)}}disconnected(e){const t=e.toB58String(),r=this._peers.get(t);r&&(r.stop(),this._peers.delete(t))}}},function(e,t,r){\"use strict\";const n=r(11).EventEmitter,i=r(173),s=r(82).logger,o=e=>`unwant:${e}`,a=e=>`block:${e}`;e.exports=class extends n{constructor(e){super(),this.setMaxListeners(i.maxListeners),this._log=s(e,\"notif\"),this._unwantListeners={},this._blockListeners={}}hasBlock(e){const t=`block:${e.cid.buffer.toString()}`;this._log(t),this.emit(t,e)}wantBlock(e,t,r){const n=e.buffer.toString();this._log(`wantBlock:${n}`),this._unwantListeners[n]=(()=>{this._log(`manual unwant: ${n}`),this._cleanup(n),r()}),this._blockListeners[n]=(e=>{this._cleanup(n),t(e)}),this.once(o(n),this._unwantListeners[n]),this.once(a(n),this._blockListeners[n])}unwantBlock(e){const t=`unwant:${e.buffer.toString()}`;this._log(t),this.emit(t)}_cleanup(e){this._unwantListeners[e]&&(this.removeListener(o(e),this._unwantListeners[e]),delete this._unwantListeners[e]),this._blockListeners[e]&&(this.removeListener(a(e),this._blockListeners[e]),delete this._blockListeners[e])}}},function(e,t,r){\"use strict\";const n=r(124);e.exports=class{constructor(e){this.partner=e,this.wantlist=new n,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesRecv+=e}wants(e,t){this.wantlist.add(e,t)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.contains(e)}}},function(e,t){function r(e,t,r){if(t!=t)return function(e,t,r,n){for(var i=e.length,s=r+(n?1:-1);n?s--:++s<i;)if(t(e[s],s,e))return s;return-1}(e,i,r);for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}function n(e,t,r,n){for(var i=r-1,s=e.length;++i<s;)if(n(e[i],t))return i;return-1}function i(e){return e!=e}var s=Array.prototype.splice;function o(e,t,i,o){var a,u=o?n:r,c=-1,f=t.length,l=e;for(e===t&&(t=function(e,t){var r=-1,n=e.length;t||(t=Array(n));for(;++r<n;)t[r]=e[r];return t}(t)),i&&(l=function(e,t){for(var r=-1,n=e?e.length:0,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}(e,(a=i,function(e){return a(e)})));++c<f;)for(var h=0,p=t[c],d=i?i(p):p;(h=u(l,d,h,o))>-1;)l!==e&&s.call(l,h,1),s.call(e,h,1);return e}e.exports=function(e,t,r){return e&&e.length&&t&&t.length?o(e,t,void 0,r):e}},function(e,t,r){(function(e){var r=200,n=\"Expected a function\",i=\"__lodash_hash_undefined__\",s=1,o=2,a=1/0,u=9007199254740991,c=\"[object Arguments]\",f=\"[object Array]\",l=\"[object Boolean]\",h=\"[object Date]\",p=\"[object Error]\",d=\"[object Function]\",y=\"[object GeneratorFunction]\",m=\"[object Map]\",g=\"[object Number]\",v=\"[object Object]\",b=\"[object RegExp]\",w=\"[object Set]\",_=\"[object String]\",k=\"[object Symbol]\",S=\"[object ArrayBuffer]\",E=\"[object DataView]\",x=/\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,A=/^\\w*$/,B=/^\\./,C=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g,I=/\\\\(\\\\)?/g,T=/^\\[object .+?Constructor\\]$/,D=/^(?:0|[1-9]\\d*)$/,P={};P[\"[object Float32Array]\"]=P[\"[object Float64Array]\"]=P[\"[object Int8Array]\"]=P[\"[object Int16Array]\"]=P[\"[object Int32Array]\"]=P[\"[object Uint8Array]\"]=P[\"[object Uint8ClampedArray]\"]=P[\"[object Uint16Array]\"]=P[\"[object Uint32Array]\"]=!0,P[c]=P[f]=P[S]=P[l]=P[E]=P[h]=P[p]=P[d]=P[m]=P[g]=P[v]=P[b]=P[w]=P[_]=P[\"[object WeakMap]\"]=!1;var O=\"object\"==typeof global&&global&&global.Object===Object&&global,N=\"object\"==typeof self&&self&&self.Object===Object&&self,U=O||N||Function(\"return this\")(),R=\"object\"==typeof t&&t&&!t.nodeType&&t,L=R&&\"object\"==typeof e&&e&&!e.nodeType&&e,F=L&&L.exports===R&&O.process,j=function(){try{return F&&F.binding(\"util\")}catch(e){}}(),M=j&&j.isTypedArray;function K(e,t,r,n){for(var i=-1,s=e?e.length:0;++i<s;){var o=e[i];t(n,o,r(o),e)}return n}function H(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function z(e){var t=!1;if(null!=e&&\"function\"!=typeof e.toString)try{t=!!(e+\"\")}catch(e){}return t}function V(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function q(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var G,W,$,X=Array.prototype,J=Function.prototype,Y=Object.prototype,Q=U[\"__core-js_shared__\"],Z=(G=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||\"\"))?\"Symbol(src)_1.\"+G:\"\",ee=J.toString,te=Y.hasOwnProperty,re=Y.toString,ne=RegExp(\"^\"+ee.call(te).replace(/[\\\\^$.*+?()[\\]{}|]/g,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\"),ie=U.Symbol,se=U.Uint8Array,oe=Y.propertyIsEnumerable,ae=X.splice,ue=(W=Object.keys,$=Object,function(e){return W($(e))}),ce=Ve(U,\"DataView\"),fe=Ve(U,\"Map\"),le=Ve(U,\"Promise\"),he=Ve(U,\"Set\"),pe=Ve(U,\"WeakMap\"),de=Ve(Object,\"create\"),ye=Qe(ce),me=Qe(fe),ge=Qe(le),ve=Qe(he),be=Qe(pe),we=ie?ie.prototype:void 0,_e=we?we.valueOf:void 0,ke=we?we.toString:void 0;function Se(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ee(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function xe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ae(e){var t=-1,r=e?e.length:0;for(this.__data__=new xe;++t<r;)this.add(e[t])}function Be(e){this.__data__=new Ee(e)}function Ce(e,t){var r=st(e)||it(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,i=!!n;for(var s in e)!t&&!te.call(e,s)||i&&(\"length\"==s||Ge(s,n))||r.push(s);return r}function Ie(e,t){for(var r=e.length;r--;)if(nt(e[r][0],t))return r;return-1}function Te(e,t,r,n){return Oe(e,function(e,i,s){t(n,e,r(e),s)}),n}Se.prototype.clear=function(){this.__data__=de?de(null):{}},Se.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Se.prototype.get=function(e){var t=this.__data__;if(de){var r=t[e];return r===i?void 0:r}return te.call(t,e)?t[e]:void 0},Se.prototype.has=function(e){var t=this.__data__;return de?void 0!==t[e]:te.call(t,e)},Se.prototype.set=function(e,t){return this.__data__[e]=de&&void 0===t?i:t,this},Ee.prototype.clear=function(){this.__data__=[]},Ee.prototype.delete=function(e){var t=this.__data__,r=Ie(t,e);return!(r<0||(r==t.length-1?t.pop():ae.call(t,r,1),0))},Ee.prototype.get=function(e){var t=this.__data__,r=Ie(t,e);return r<0?void 0:t[r][1]},Ee.prototype.has=function(e){return Ie(this.__data__,e)>-1},Ee.prototype.set=function(e,t){var r=this.__data__,n=Ie(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},xe.prototype.clear=function(){this.__data__={hash:new Se,map:new(fe||Ee),string:new Se}},xe.prototype.delete=function(e){return ze(this,e).delete(e)},xe.prototype.get=function(e){return ze(this,e).get(e)},xe.prototype.has=function(e){return ze(this,e).has(e)},xe.prototype.set=function(e,t){return ze(this,e).set(e,t),this},Ae.prototype.add=Ae.prototype.push=function(e){return this.__data__.set(e,i),this},Ae.prototype.has=function(e){return this.__data__.has(e)},Be.prototype.clear=function(){this.__data__=new Ee},Be.prototype.delete=function(e){return this.__data__.delete(e)},Be.prototype.get=function(e){return this.__data__.get(e)},Be.prototype.has=function(e){return this.__data__.has(e)},Be.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ee){var i=n.__data__;if(!fe||i.length<r-1)return i.push([e,t]),this;n=this.__data__=new xe(i)}return n.set(e,t),this};var De,Pe,Oe=(De=function(e,t){return e&&Ne(e,t,pt)},function(e,t){if(null==e)return e;if(!ot(e))return De(e,t);for(var r=e.length,n=Pe?r:-1,i=Object(e);(Pe?n--:++n<r)&&!1!==t(i[n],n,i););return e}),Ne=function(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var u=o[e?a:++i];if(!1===r(s[u],u,s))break}return t}}();function Ue(e,t){for(var r=0,n=(t=We(t,e)?[t]:Ke(t)).length;null!=e&&r<n;)e=e[Ye(t[r++])];return r&&r==n?e:void 0}function Re(e,t){return null!=e&&t in Object(e)}function Le(e,t,r,n,i){return e===t||(null==e||null==t||!ct(e)&&!ft(t)?e!=e&&t!=t:function(e,t,r,n,i,a){var u=st(e),d=st(t),y=f,x=f;u||(y=(y=qe(e))==c?v:y);d||(x=(x=qe(t))==c?v:x);var A=y==v&&!z(e),B=x==v&&!z(t),C=y==x;if(C&&!A)return a||(a=new Be),u||ht(e)?He(e,t,r,n,i,a):function(e,t,r,n,i,a,u){switch(r){case E:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case S:return!(e.byteLength!=t.byteLength||!n(new se(e),new se(t)));case l:case h:case g:return nt(+e,+t);case p:return e.name==t.name&&e.message==t.message;case b:case _:return e==t+\"\";case m:var c=V;case w:var f=a&o;if(c||(c=q),e.size!=t.size&&!f)return!1;var d=u.get(e);if(d)return d==t;a|=s,u.set(e,t);var y=He(c(e),c(t),n,i,a,u);return u.delete(e),y;case k:if(_e)return _e.call(e)==_e.call(t)}return!1}(e,t,y,r,n,i,a);if(!(i&o)){var I=A&&te.call(e,\"__wrapped__\"),T=B&&te.call(t,\"__wrapped__\");if(I||T){var D=I?e.value():e,P=T?t.value():t;return a||(a=new Be),r(D,P,n,i,a)}}if(!C)return!1;return a||(a=new Be),function(e,t,r,n,i,s){var a=i&o,u=pt(e),c=u.length,f=pt(t).length;if(c!=f&&!a)return!1;for(var l=c;l--;){var h=u[l];if(!(a?h in t:te.call(t,h)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var d=!0;s.set(e,t),s.set(t,e);for(var y=a;++l<c;){h=u[l];var m=e[h],g=t[h];if(n)var v=a?n(g,m,h,t,e,s):n(m,g,h,e,t,s);if(!(void 0===v?m===g||r(m,g,n,i,s):v)){d=!1;break}y||(y=\"constructor\"==h)}if(d&&!y){var b=e.constructor,w=t.constructor;b!=w&&\"constructor\"in e&&\"constructor\"in t&&!(\"function\"==typeof b&&b instanceof b&&\"function\"==typeof w&&w instanceof w)&&(d=!1)}return s.delete(e),s.delete(t),d}(e,t,r,n,i,a)}(e,t,Le,r,n,i))}function Fe(e){return!(!ct(e)||Z&&Z in e)&&(at(e)||z(e)?ne:T).test(Qe(e))}function je(e){return\"function\"==typeof e?e:null==e?dt:\"object\"==typeof e?st(e)?function(e,t){if(We(e)&&$e(t))return Xe(Ye(e),t);return function(r){var n=function(e,t,r){var n=null==e?void 0:Ue(e,t);return void 0===n?r:n}(r,e);return void 0===n&&n===t?function(e,t){return null!=e&&function(e,t,r){var n,i=-1,s=(t=We(t,e)?[t]:Ke(t)).length;for(;++i<s;){var o=Ye(t[i]);if(!(n=null!=e&&r(e,o)))break;e=e[o]}if(n)return n;return!!(s=e?e.length:0)&&ut(s)&&Ge(o,s)&&(st(e)||it(e))}(e,t,Re)}(r,e):Le(t,n,void 0,s|o)}}(e[0],e[1]):function(e){var t=function(e){var t=pt(e),r=t.length;for(;r--;){var n=t[r],i=e[n];t[r]=[n,i,$e(i)]}return t}(e);if(1==t.length&&t[0][2])return Xe(t[0][0],t[0][1]);return function(r){return r===e||function(e,t,r,n){var i=r.length,a=i,u=!n;if(null==e)return!a;for(e=Object(e);i--;){var c=r[i];if(u&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++i<a;){var f=(c=r[i])[0],l=e[f],h=c[1];if(u&&c[2]){if(void 0===l&&!(f in e))return!1}else{var p=new Be;if(n)var d=n(l,h,f,e,t,p);if(!(void 0===d?Le(h,l,n,s|o,p):d))return!1}}return!0}(r,e,t)}}(e):We(t=e)?(r=Ye(t),function(e){return null==e?void 0:e[r]}):function(e){return function(t){return Ue(t,e)}}(t);var t,r}function Me(e){if(r=(t=e)&&t.constructor,n=\"function\"==typeof r&&r.prototype||Y,t!==n)return ue(e);var t,r,n,i=[];for(var s in Object(e))te.call(e,s)&&\"constructor\"!=s&&i.push(s);return i}function Ke(e){return st(e)?e:Je(e)}function He(e,t,r,n,i,a){var u=i&o,c=e.length,f=t.length;if(c!=f&&!(u&&f>c))return!1;var l=a.get(e);if(l&&a.get(t))return l==t;var h=-1,p=!0,d=i&s?new Ae:void 0;for(a.set(e,t),a.set(t,e);++h<c;){var y=e[h],m=t[h];if(n)var g=u?n(m,y,h,t,e,a):n(y,m,h,e,t,a);if(void 0!==g){if(g)continue;p=!1;break}if(d){if(!H(t,function(e,t){if(!d.has(t)&&(y===e||r(y,e,n,i,a)))return d.add(t)})){p=!1;break}}else if(y!==m&&!r(y,m,n,i,a)){p=!1;break}}return a.delete(e),a.delete(t),p}function ze(e,t){var r,n,i=e.__data__;return(\"string\"==(n=typeof(r=t))||\"number\"==n||\"symbol\"==n||\"boolean\"==n?\"__proto__\"!==r:null===r)?i[\"string\"==typeof t?\"string\":\"hash\"]:i.map}function Ve(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return Fe(r)?r:void 0}var qe=function(e){return re.call(e)};function Ge(e,t){return!!(t=null==t?u:t)&&(\"number\"==typeof e||D.test(e))&&e>-1&&e%1==0&&e<t}function We(e,t){if(st(e))return!1;var r=typeof e;return!(\"number\"!=r&&\"symbol\"!=r&&\"boolean\"!=r&&null!=e&&!lt(e))||(A.test(e)||!x.test(e)||null!=t&&e in Object(t))}function $e(e){return e==e&&!ct(e)}function Xe(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}(ce&&qe(new ce(new ArrayBuffer(1)))!=E||fe&&qe(new fe)!=m||le&&\"[object Promise]\"!=qe(le.resolve())||he&&qe(new he)!=w||pe&&\"[object WeakMap]\"!=qe(new pe))&&(qe=function(e){var t=re.call(e),r=t==v?e.constructor:void 0,n=r?Qe(r):void 0;if(n)switch(n){case ye:return E;case me:return m;case ge:return\"[object Promise]\";case ve:return w;case be:return\"[object WeakMap]\"}return t});var Je=rt(function(e){var t;e=null==(t=e)?\"\":function(e){if(\"string\"==typeof e)return e;if(lt(e))return ke?ke.call(e):\"\";var t=e+\"\";return\"0\"==t&&1/e==-a?\"-0\":t}(t);var r=[];return B.test(e)&&r.push(\"\"),e.replace(C,function(e,t,n,i){r.push(n?i.replace(I,\"$1\"):t||e)}),r});function Ye(e){if(\"string\"==typeof e||lt(e))return e;var t=e+\"\";return\"0\"==t&&1/e==-a?\"-0\":t}function Qe(e){if(null!=e){try{return ee.call(e)}catch(e){}try{return e+\"\"}catch(e){}}return\"\"}var Ze,et,tt=(Ze=function(e,t,r){te.call(e,r)?e[r].push(t):e[r]=[t]},function(e,t){var r=st(e)?K:Te,n=et?et():{};return r(e,Ze,je(t),n)});function rt(e,t){if(\"function\"!=typeof e||t&&\"function\"!=typeof t)throw new TypeError(n);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o),o};return r.cache=new(rt.Cache||xe),r}function nt(e,t){return e===t||e!=e&&t!=t}function it(e){return function(e){return ft(e)&&ot(e)}(e)&&te.call(e,\"callee\")&&(!oe.call(e,\"callee\")||re.call(e)==c)}rt.Cache=xe;var st=Array.isArray;function ot(e){return null!=e&&ut(e.length)&&!at(e)}function at(e){var t=ct(e)?re.call(e):\"\";return t==d||t==y}function ut(e){return\"number\"==typeof e&&e>-1&&e%1==0&&e<=u}function ct(e){var t=typeof e;return!!e&&(\"object\"==t||\"function\"==t)}function ft(e){return!!e&&\"object\"==typeof e}function lt(e){return\"symbol\"==typeof e||ft(e)&&re.call(e)==k}var ht=M?function(e){return function(t){return e(t)}}(M):function(e){return ft(e)&&ut(e.length)&&!!P[re.call(e)]};function pt(e){return ot(e)?Ce(e):Me(e)}function dt(e){return e}e.exports=tt}).call(this,r(55)(e))},function(e,t){var r=200,n=\"__lodash_hash_undefined__\",i=\"[object Function]\",s=\"[object GeneratorFunction]\",o=/^\\[object .+?Constructor\\]$/,a=\"object\"==typeof global&&global&&global.Object===Object&&global,u=\"object\"==typeof self&&self&&self.Object===Object&&self,c=a||u||Function(\"return this\")();function f(e,t){return!!(e?e.length:0)&&function(e,t,r){if(t!=t)return function(e,t,r,n){var i=e.length,s=r+(n?1:-1);for(;n?s--:++s<i;)if(t(e[s],s,e))return s;return-1}(e,h,r);var n=r-1,i=e.length;for(;++n<i;)if(e[n]===t)return n;return-1}(e,t,0)>-1}function l(e,t,r){for(var n=-1,i=e?e.length:0;++n<i;)if(r(t,e[n]))return!0;return!1}function h(e){return e!=e}function p(e,t){return e.has(t)}function d(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var y,m=Array.prototype,g=Function.prototype,v=Object.prototype,b=c[\"__core-js_shared__\"],w=(y=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||\"\"))?\"Symbol(src)_1.\"+y:\"\",_=g.toString,k=v.hasOwnProperty,S=v.toString,E=RegExp(\"^\"+_.call(k).replace(/[\\\\^$.*+?()[\\]{}|]/g,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\"),x=m.splice,A=L(c,\"Map\"),B=L(c,\"Set\"),C=L(Object,\"create\");function I(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function T(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function D(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function P(e){var t=-1,r=e?e.length:0;for(this.__data__=new D;++t<r;)this.add(e[t])}function O(e,t){for(var r,n,i=e.length;i--;)if((r=e[i][0])===(n=t)||r!=r&&n!=n)return i;return-1}function N(e){return!(!F(e)||w&&w in e)&&(function(e){var t=F(e)?S.call(e):\"\";return t==i||t==s}(e)||function(e){var t=!1;if(null!=e&&\"function\"!=typeof e.toString)try{t=!!(e+\"\")}catch(e){}return t}(e)?E:o).test(function(e){if(null!=e){try{return _.call(e)}catch(e){}try{return e+\"\"}catch(e){}}return\"\"}(e))}I.prototype.clear=function(){this.__data__=C?C(null):{}},I.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},I.prototype.get=function(e){var t=this.__data__;if(C){var r=t[e];return r===n?void 0:r}return k.call(t,e)?t[e]:void 0},I.prototype.has=function(e){var t=this.__data__;return C?void 0!==t[e]:k.call(t,e)},I.prototype.set=function(e,t){return this.__data__[e]=C&&void 0===t?n:t,this},T.prototype.clear=function(){this.__data__=[]},T.prototype.delete=function(e){var t=this.__data__,r=O(t,e);return!(r<0||(r==t.length-1?t.pop():x.call(t,r,1),0))},T.prototype.get=function(e){var t=this.__data__,r=O(t,e);return r<0?void 0:t[r][1]},T.prototype.has=function(e){return O(this.__data__,e)>-1},T.prototype.set=function(e,t){var r=this.__data__,n=O(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},D.prototype.clear=function(){this.__data__={hash:new I,map:new(A||T),string:new I}},D.prototype.delete=function(e){return R(this,e).delete(e)},D.prototype.get=function(e){return R(this,e).get(e)},D.prototype.has=function(e){return R(this,e).has(e)},D.prototype.set=function(e,t){return R(this,e).set(e,t),this},P.prototype.add=P.prototype.push=function(e){return this.__data__.set(e,n),this},P.prototype.has=function(e){return this.__data__.has(e)};var U=B&&1/d(new B([,-0]))[1]==1/0?function(e){return new B(e)}:function(){};function R(e,t){var r,n,i=e.__data__;return(\"string\"==(n=typeof(r=t))||\"number\"==n||\"symbol\"==n||\"boolean\"==n?\"__proto__\"!==r:null===r)?i[\"string\"==typeof t?\"string\":\"hash\"]:i.map}function L(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return N(r)?r:void 0}function F(e){var t=typeof e;return!!e&&(\"object\"==t||\"function\"==t)}e.exports=function(e,t){return e&&e.length?function(e,t,n){var i=-1,s=f,o=e.length,a=!0,u=[],c=u;if(n)a=!1,s=l;else if(o>=r){var h=t?null:U(e);if(h)return d(h);a=!1,s=p,c=new P}else c=t?[]:u;e:for(;++i<o;){var y=e[i],m=t?t(y):y;if(y=n||0!==y?y:0,a&&m==m){for(var g=c.length;g--;)if(c[g]===m)continue e;t&&c.push(m),u.push(y)}else s(c,m,n)||(c!==u&&c.push(m),u.push(y))}return u}(e,void 0,t):[]}},function(e,t,r){\"use strict\";const n=r(18),i=r(123),s=r(3),o=r(2),a=r(74),u=r(297),c=r(658),f=r(295),l=r(172),h=r(657),p=r(656),d=r(125),y=r(124),m=r(655),g=r(82).logger,v=524288;e.exports=class{constructor(e,t,r,n){this._log=g(e,\"engine\"),this.blockstore=t,this.network=r,this._stats=n,this.ledgerMap=new Map,this._running=!1,this._tasks=[],this._outbox=u(this._processTasks.bind(this),100)}_sendBlocks(e,t,r){if(t.reduce((e,t)=>e+t.data.byteLength,0)<v)return this._sendSafeBlocks(e,t,r);let n=0,s=[],o=t.length;i(t,(t,r)=>{if(o--,s.push(t),(n+=t.data.byteLength)>=v||0===o){const t=s.slice();s=[],this._sendSafeBlocks(e,t,e=>{e&&this._log(\"sendblock error: %s\",e.message),r()})}else r()},r)}_sendSafeBlocks(e,t,r){const n=new d(!1);t.forEach(e=>n.addBlock(e)),this.network.sendMessage(e,n,r)}_processTasks(){if(!this._running||!this._tasks.length)return;const e=this._tasks;this._tasks=[];const t=e.map(e=>e.entry).map(e=>e.cid),r=c(t,(e,t)=>e.equals(t)),i=h(e,e=>e.target.toB58String());s([e=>a(r,(e,t)=>{this.blockstore.get(e,t)},e),(e,r)=>n(l(i),(r,n)=>{const i=r[0].target,s=t.map(t=>f(e,e=>e.cid.equals(t)));this._sendBlocks(i,s,e=>{e?this._log.error(\"should never happen: \",e):s.forEach(e=>this.messageSent(i,e)),n()})})],e=>{this._tasks=[],e&&this._log.error(e)})}wantlistForPeer(e){const t=e.toB58String();return this.ledgerMap.has(t)?this.ledgerMap.get(t).wantlist.sortedEntries():new Map}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.partner)}receivedBlocks(e){e.length&&(this.ledgerMap.forEach(t=>{e.map(e=>t.wantlistContains(e)).filter(Boolean).forEach(e=>{this._tasks.push({entry:e,target:t.partner})})}),this._outbox())}messageReceived(e,t,r){const n=this._findOrCreate(e);if(t.empty)return r();if(t.full&&(n.wantlist=new y),this._processBlocks(t.blocks,n),0===t.wantlist.size)return r();let i=[],s=[];t.wantlist.forEach(e=>{e.cancel?(n.cancelWant(e.cid),i.push(e)):(n.wants(e.cid,e.priority),s.push(e))}),this._cancelWants(n,e,i),this._addWants(n,e,s,r)}_cancelWants(e,t,r){const n=t.toB58String();p(this._tasks,r,(e,t)=>{const r=e.target.toB58String()===n,i=e.entry.cid.equals(t.cid);return r&&i})}_addWants(e,t,r,i){n(r,(e,r)=>{this.blockstore.has(e.cid,(n,i)=>{n?this._log.error(\"failed existence check\"):i&&this._tasks.push({entry:e.entry,target:t}),r()})},()=>{this._outbox(),i()})}_processBlocks(e,t,r){const n=[];e.forEach((e,r)=>{this._log(\"got block (%s bytes)\",e.data.length),t.receivedBytes(e.data.length),n.push(e.cid)}),this.receivedBlocks(n)}messageSent(e,t){const r=this._findOrCreate(e);r.sentBytes(t?t.data.length:0),t&&t.cid&&r.wantlist.remove(t.cid)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){}_findOrCreate(e){const t=e.toB58String();if(this.ledgerMap.has(t))return this.ledgerMap.get(t);const r=new m(e);return this.ledgerMap.set(t,r),this._stats&&this._stats.push(t,\"peerCount\",1),r}start(e){this._running=!0,o(()=>e())}stop(e){this._running=!1,o(()=>e())}}},function(e,t){e.exports=function(){var e=[],t=0;return{length:t,data:this,add:function(r){if(!Buffer.isBuffer(r))throw new Error(\"data must be a buffer, was: \"+JSON.stringify(r));return this.length=t+=r.length,e.push(r),this},has:function(e){return null==e?t>0:t>=e},get:function(r){var n;if(null==r||r===t){t=0;var i=e;return e=[],1==i.length?i[0]:Buffer.concat(i)}if(e.length>1&&r<=(n=e[0].length)){var s=e[0].slice(0,r);return r===n?e.shift():e[0]=e[0].slice(r,n),t-=r,s}if(r<t){for(var o=[],a=0;a+e[0].length<r;){var u=e.shift();a+=u.length,o.push(u)}return a<r&&(o.push(e[0].slice(0,r-a)),e[0]=e[0].slice(r-a,e[0].length),this.length=t-=r),Buffer.concat(o)}throw new Error(\"could not get \"+r+\" bytes\")}}}},function(e,t,r){\"use strict\";const n=r(22),i=r(296),s=r(8).Buffer,o=r(46);t.decode=function(e){let t=new i,r=o(e=>{t.abort(e)});return n=>{return t(n),function n(){c(t,e,(e,t)=>{if(e)return r.end(e);r.push(t),n()})}(),r}},t.decodeFromReader=c;const a=e=>!(128&e),u=4194304;function c(e,t,r){\"function\"==typeof t&&(r=t,t={}),(t=Object.assign({fixed:!1,bytes:4},t||{})).fixed?function(e,t,r,n){\"function\"==typeof r&&(n=r,r=u);e.read(t,(t,i)=>{if(t)return n(t);const s=i.readInt32BE(0);if(s>r)return n(\"size longer than max permitted length of \"+r+\"!\");f(e,s,n)})}(e,t.bytes,t.maxLength,r):function(e,t,r){\"function\"==typeof t&&(r=t,t=u);let i=[];0===i.length&&function o(){e.read(1,(u,c)=>{if(u)return r(u);if(i.push(c),c&&!a(c[0]))return void o();const l=n.decode(s.concat(i));if(l>t)return r(\"size longer than max permitted length of \"+t+\"!\");f(e,l,(e,t)=>{if(e)return r(e);i=[],r(null,t)})})}()}(e,t.maxLength,r)}function f(e,t,r){e.read(t,(e,t)=>{if(e)return r(e);r(null,t)})}},function(e,t,r){\"use strict\";const n=r(8).Buffer;e.exports=function(e){e=Object.assign({fixed:!1,bytes:4},e||{});const t=r(22);let i=e.fixed?null:s(),o=0,a=!1;return r=>(u,c)=>{if(u&&(a=u),a)return c(a);r(null,(r,u)=>{if(r&&(a=r),a)return c(a);if(!n.isBuffer(u))return a=new Error(\"data must be a buffer\"),c(a);let f;e.fixed?(f=n.alloc(e.bytes)).writeInt32BE(u.length,0):(t.encode(u.length,i,o),o+=t.encode.bytes,f=i.slice(o-t.encode.bytes,o),i.length-o<100&&(i=s(),o=0)),c(null,n.concat([f,u]))})}};const i=10240;function s(){return n.alloc(i)}},function(e,t,r){\"use strict\";const n=r(33),i=r(1),s=r(3),o=r(18),a=r(2),u=r(125),c=r(173),f=r(82).logger,l=\"/ipfs/bitswap/1.0.0\",h=\"/ipfs/bitswap/1.1.0\";e.exports=class{constructor(e,t,r,n){this._log=f(e.peerInfo.id,\"network\"),r=r||{},this.libp2p=e,this.bitswap=t,this.b100Only=r.b100Only||!1,this._stats=n,this._running=!1}start(e){this._running=!0,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this.libp2p.handle(l,this._onConnection),this.b100Only||this.libp2p.handle(h,this._onConnection),this.libp2p.on(\"peer:connect\",this._onPeerConnect),this.libp2p.on(\"peer:disconnect\",this._onPeerDisconnect),this.libp2p.peerBook.getAllArray().filter(e=>e.isConnected()).forEach(e=>this._onPeerConnect(e)),a(()=>e())}stop(e){this._running=!1,this.libp2p.unhandle(l),this.b100Only||this.libp2p.unhandle(h),this.libp2p.removeListener(\"peer:connect\",this._onPeerConnect),this.libp2p.removeListener(\"peer:disconnect\",this._onPeerDisconnect),a(()=>e())}_onConnection(e,t){this._running&&(this._log(\"incomming new bitswap connection: %s\",e),i(t,n.decode(),i.asyncMap((e,t)=>u.deserialize(e,t)),i.asyncMap((e,r)=>{t.getPeerInfo((t,n)=>{if(t)return r(t);this.bitswap._receiveMessage(n.id,e,r)})}),i.onEnd(e=>{this._log(\"ending connection\"),e&&this.bitswap._receiveError(e)})))}_onPeerConnect(e){this._running&&this.bitswap._onPeerConnected(e.id)}_onPeerDisconnect(e){this._running&&this.bitswap._onPeerDisconnected(e.id)}findProviders(e,t,r){this.libp2p.contentRouting.findProviders(e,c.providerRequestTimeout,r)}findAndConnect(e,t){s([t=>this.findProviders(e,c.maxProvidersPerRequest,t),(e,t)=>{this._log(\"connecting to providers\",e.map(e=>e.id.toB58String())),o(e,(e,t)=>this.connectTo(e,t))}],t)}provide(e,t){this.libp2p.contentRouting.provide(e,t)}sendMessage(e,t,r){if(!this._running)return r(new Error(\"network isn't running\"));const s=e.toB58String()?e.toB58String():e.id.toB58String();this._log(\"sendMessage to %s\",s,t),this._dialPeer(e,(s,o,a)=>{if(s)return r(s);let u;switch(a){case l:u=t.serializeToBitswap100();break;case h:u=t.serializeToBitswap110();break;default:return r(new Error(\"Unkown protocol: \"+a))}!function(e,t,r){i(i.values([t]),n.encode(),e,i.onEnd(r))}(o,u,e=>{e&&this._log.error(e)}),r(),this._updateSentStats(e,t.blocks)})}connectTo(e,t){if(!this._running)return t(new Error(\"network isn't running\"));this.libp2p.dial(e,t)}_dialPeer(e,t){this.libp2p.dialProtocol(e,h,(r,n)=>{r?this.libp2p.dialProtocol(e,l,(e,r)=>{if(e)return t(e);t(null,r,l)}):t(null,n,h)})}_updateSentStats(e,t){const r=e.toB58String();this._stats&&(t.forEach(e=>this._stats.push(r,\"dataSent\",e.data.length)),this._stats.push(r,\"blocksSent\",t.size))}}},function(e,t,r){\"use strict\";const n=r(297),i=r(125),s=r(82).logger;e.exports=class{constructor(e,t,r){this.peerId=t,this.network=r,this.refcnt=1,this._entries=[],this._log=s(e,\"msgqueue\",t.toB58String().slice(0,8)),this.sendEntries=n(this._sendEntries.bind(this),200)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;const e=new i(!1);this._entries.forEach(t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)}),this._entries=[],this.addMessage(e)}send(e){this.network.connectTo(this.peerId,t=>{t?this._log.error(\"cant connect to peer %s: %s\",this.peerId.toB58String(),t.message):(this._log(\"sending message\"),this.network.sendMessage(this.peerId,e,e=>{e&&this._log.error(\"send error: %s\",e.message)}))})}}},function(e,t,r){\"use strict\";const n=r(10),i=r(5);e.exports=class{constructor(e,t){n(i.isCID(e),\"must be valid CID\"),this._refCounter=1,this.cid=e,this.priority=t||1}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toBaseEncodedString()}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority}}},function(e,t,r){(function(e){var r=200,n=\"Expected a function\",i=\"__lodash_hash_undefined__\",s=1,o=2,a=1/0,u=9007199254740991,c=\"[object Arguments]\",f=\"[object Array]\",l=\"[object Boolean]\",h=\"[object Date]\",p=\"[object Error]\",d=\"[object Function]\",y=\"[object GeneratorFunction]\",m=\"[object Map]\",g=\"[object Number]\",v=\"[object Object]\",b=\"[object RegExp]\",w=\"[object Set]\",_=\"[object String]\",k=\"[object Symbol]\",S=\"[object ArrayBuffer]\",E=\"[object DataView]\",x=/\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,A=/^\\w*$/,B=/^\\./,C=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g,I=/\\\\(\\\\)?/g,T=/^\\[object .+?Constructor\\]$/,D=/^(?:0|[1-9]\\d*)$/,P={};P[\"[object Float32Array]\"]=P[\"[object Float64Array]\"]=P[\"[object Int8Array]\"]=P[\"[object Int16Array]\"]=P[\"[object Int32Array]\"]=P[\"[object Uint8Array]\"]=P[\"[object Uint8ClampedArray]\"]=P[\"[object Uint16Array]\"]=P[\"[object Uint32Array]\"]=!0,P[c]=P[f]=P[S]=P[l]=P[E]=P[h]=P[p]=P[d]=P[m]=P[g]=P[v]=P[b]=P[w]=P[_]=P[\"[object WeakMap]\"]=!1;var O=\"object\"==typeof global&&global&&global.Object===Object&&global,N=\"object\"==typeof self&&self&&self.Object===Object&&self,U=O||N||Function(\"return this\")(),R=\"object\"==typeof t&&t&&!t.nodeType&&t,L=R&&\"object\"==typeof e&&e&&!e.nodeType&&e,F=L&&L.exports===R&&O.process,j=function(){try{return F&&F.binding(\"util\")}catch(e){}}(),M=j&&j.isTypedArray;function K(e,t){for(var r=-1,n=e?e.length:0,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function H(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function z(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function V(e){return function(t){return e(t)}}function q(e){var t=!1;if(null!=e&&\"function\"!=typeof e.toString)try{t=!!(e+\"\")}catch(e){}return t}function G(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function W(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var $,X,J,Y=Array.prototype,Q=Function.prototype,Z=Object.prototype,ee=U[\"__core-js_shared__\"],te=($=/[^.]+$/.exec(ee&&ee.keys&&ee.keys.IE_PROTO||\"\"))?\"Symbol(src)_1.\"+$:\"\",re=Q.toString,ne=Z.hasOwnProperty,ie=Z.toString,se=RegExp(\"^\"+re.call(ne).replace(/[\\\\^$.*+?()[\\]{}|]/g,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\"),oe=U.Symbol,ae=U.Uint8Array,ue=Z.propertyIsEnumerable,ce=Y.splice,fe=oe?oe.isConcatSpreadable:void 0,le=(X=Object.keys,J=Object,function(e){return X(J(e))}),he=Math.max,pe=Xe(U,\"DataView\"),de=Xe(U,\"Map\"),ye=Xe(U,\"Promise\"),me=Xe(U,\"Set\"),ge=Xe(U,\"WeakMap\"),ve=Xe(Object,\"create\"),be=st(pe),we=st(de),_e=st(ye),ke=st(me),Se=st(ge),Ee=oe?oe.prototype:void 0,xe=Ee?Ee.valueOf:void 0,Ae=Ee?Ee.toString:void 0;function Be(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ce(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ie(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Te(e){var t=-1,r=e?e.length:0;for(this.__data__=new Ie;++t<r;)this.add(e[t])}function De(e){this.__data__=new Ce(e)}function Pe(e,t){var r=ft(e)||ct(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,i=!!n;for(var s in e)!t&&!ne.call(e,s)||i&&(\"length\"==s||Qe(s,n))||r.push(s);return r}function Oe(e,t){for(var r=e.length;r--;)if(ut(e[r][0],t))return r;return-1}Be.prototype.clear=function(){this.__data__=ve?ve(null):{}},Be.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Be.prototype.get=function(e){var t=this.__data__;if(ve){var r=t[e];return r===i?void 0:r}return ne.call(t,e)?t[e]:void 0},Be.prototype.has=function(e){var t=this.__data__;return ve?void 0!==t[e]:ne.call(t,e)},Be.prototype.set=function(e,t){return this.__data__[e]=ve&&void 0===t?i:t,this},Ce.prototype.clear=function(){this.__data__=[]},Ce.prototype.delete=function(e){var t=this.__data__,r=Oe(t,e);return!(r<0||(r==t.length-1?t.pop():ce.call(t,r,1),0))},Ce.prototype.get=function(e){var t=this.__data__,r=Oe(t,e);return r<0?void 0:t[r][1]},Ce.prototype.has=function(e){return Oe(this.__data__,e)>-1},Ce.prototype.set=function(e,t){var r=this.__data__,n=Oe(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},Ie.prototype.clear=function(){this.__data__={hash:new Be,map:new(de||Ce),string:new Be}},Ie.prototype.delete=function(e){return $e(this,e).delete(e)},Ie.prototype.get=function(e){return $e(this,e).get(e)},Ie.prototype.has=function(e){return $e(this,e).has(e)},Ie.prototype.set=function(e,t){return $e(this,e).set(e,t),this},Te.prototype.add=Te.prototype.push=function(e){return this.__data__.set(e,i),this},Te.prototype.has=function(e){return this.__data__.has(e)},De.prototype.clear=function(){this.__data__=new Ce},De.prototype.delete=function(e){return this.__data__.delete(e)},De.prototype.get=function(e){return this.__data__.get(e)},De.prototype.has=function(e){return this.__data__.has(e)},De.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ce){var i=n.__data__;if(!de||i.length<r-1)return i.push([e,t]),this;n=this.__data__=new Ie(i)}return n.set(e,t),this};var Ne,Ue,Re=(Ne=function(e,t){return e&&Le(e,t,vt)},function(e,t){if(null==e)return e;if(!lt(e))return Ne(e,t);for(var r=e.length,n=Ue?r:-1,i=Object(e);(Ue?n--:++n<r)&&!1!==t(i[n],n,i););return e});var Le=function(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var u=o[e?a:++i];if(!1===r(s[u],u,s))break}return t}}();function Fe(e,t){for(var r=0,n=(t=et(t,e)?[t]:qe(t)).length;null!=e&&r<n;)e=e[it(t[r++])];return r&&r==n?e:void 0}function je(e,t){return null!=e&&t in Object(e)}function Me(e,t,r,n,i){return e===t||(null==e||null==t||!dt(e)&&!yt(t)?e!=e&&t!=t:function(e,t,r,n,i,a){var u=ft(e),d=ft(t),y=f,x=f;u||(y=(y=Je(e))==c?v:y);d||(x=(x=Je(t))==c?v:x);var A=y==v&&!q(e),B=x==v&&!q(t),C=y==x;if(C&&!A)return a||(a=new De),u||gt(e)?We(e,t,r,n,i,a):function(e,t,r,n,i,a,u){switch(r){case E:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case S:return!(e.byteLength!=t.byteLength||!n(new ae(e),new ae(t)));case l:case h:case g:return ut(+e,+t);case p:return e.name==t.name&&e.message==t.message;case b:case _:return e==t+\"\";case m:var c=G;case w:var f=a&o;if(c||(c=W),e.size!=t.size&&!f)return!1;var d=u.get(e);if(d)return d==t;a|=s,u.set(e,t);var y=We(c(e),c(t),n,i,a,u);return u.delete(e),y;case k:if(xe)return xe.call(e)==xe.call(t)}return!1}(e,t,y,r,n,i,a);if(!(i&o)){var I=A&&ne.call(e,\"__wrapped__\"),T=B&&ne.call(t,\"__wrapped__\");if(I||T){var D=I?e.value():e,P=T?t.value():t;return a||(a=new De),r(D,P,n,i,a)}}if(!C)return!1;return a||(a=new De),function(e,t,r,n,i,s){var a=i&o,u=vt(e),c=u.length,f=vt(t).length;if(c!=f&&!a)return!1;for(var l=c;l--;){var h=u[l];if(!(a?h in t:ne.call(t,h)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var d=!0;s.set(e,t),s.set(t,e);for(var y=a;++l<c;){h=u[l];var m=e[h],g=t[h];if(n)var v=a?n(g,m,h,t,e,s):n(m,g,h,e,t,s);if(!(void 0===v?m===g||r(m,g,n,i,s):v)){d=!1;break}y||(y=\"constructor\"==h)}if(d&&!y){var b=e.constructor,w=t.constructor;b!=w&&\"constructor\"in e&&\"constructor\"in t&&!(\"function\"==typeof b&&b instanceof b&&\"function\"==typeof w&&w instanceof w)&&(d=!1)}return s.delete(e),s.delete(t),d}(e,t,r,n,i,a)}(e,t,Me,r,n,i))}function Ke(e){return!(!dt(e)||te&&te in e)&&(ht(e)||q(e)?se:T).test(st(e))}function He(e){return\"function\"==typeof e?e:null==e?bt:\"object\"==typeof e?ft(e)?function(e,t){if(et(e)&&tt(t))return rt(it(e),t);return function(r){var n=function(e,t,r){var n=null==e?void 0:Fe(e,t);return void 0===n?r:n}(r,e);return void 0===n&&n===t?function(e,t){return null!=e&&function(e,t,r){var n,i=-1,s=(t=et(t,e)?[t]:qe(t)).length;for(;++i<s;){var o=it(t[i]);if(!(n=null!=e&&r(e,o)))break;e=e[o]}if(n)return n;return!!(s=e?e.length:0)&&pt(s)&&Qe(o,s)&&(ft(e)||ct(e))}(e,t,je)}(r,e):Me(t,n,void 0,s|o)}}(e[0],e[1]):function(e){var t=function(e){var t=vt(e),r=t.length;for(;r--;){var n=t[r],i=e[n];t[r]=[n,i,tt(i)]}return t}(e);if(1==t.length&&t[0][2])return rt(t[0][0],t[0][1]);return function(r){return r===e||function(e,t,r,n){var i=r.length,a=i,u=!n;if(null==e)return!a;for(e=Object(e);i--;){var c=r[i];if(u&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++i<a;){var f=(c=r[i])[0],l=e[f],h=c[1];if(u&&c[2]){if(void 0===l&&!(f in e))return!1}else{var p=new De;if(n)var d=n(l,h,f,e,t,p);if(!(void 0===d?Me(h,l,n,s|o,p):d))return!1}}return!0}(r,e,t)}}(e):et(t=e)?(r=it(t),function(e){return null==e?void 0:e[r]}):function(e){return function(t){return Fe(t,e)}}(t);var t,r}function ze(e){if(r=(t=e)&&t.constructor,n=\"function\"==typeof r&&r.prototype||Z,t!==n)return le(e);var t,r,n,i=[];for(var s in Object(e))ne.call(e,s)&&\"constructor\"!=s&&i.push(s);return i}function Ve(e,t,r){var n=-1;return t=K(t.length?t:[bt],V(He)),function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(function(e,t){var r=-1,n=lt(e)?Array(e.length):[];return Re(e,function(e,i,s){n[++r]=t(e,i,s)}),n}(e,function(e,r,i){return{criteria:K(t,function(t){return t(e)}),index:++n,value:e}}),function(e,t){return function(e,t,r){var n=-1,i=e.criteria,s=t.criteria,o=i.length,a=r.length;for(;++n<o;){var u=Ge(i[n],s[n]);if(u){if(n>=a)return u;var c=r[n];return u*(\"desc\"==c?-1:1)}}return e.index-t.index}(e,t,r)})}function qe(e){return ft(e)?e:nt(e)}function Ge(e,t){if(e!==t){var r=void 0!==e,n=null===e,i=e==e,s=mt(e),o=void 0!==t,a=null===t,u=t==t,c=mt(t);if(!a&&!c&&!s&&e>t||s&&o&&u&&!a&&!c||n&&o&&u||!r&&u||!i)return 1;if(!n&&!s&&!c&&e<t||c&&r&&i&&!n&&!s||a&&r&&i||!o&&i||!u)return-1}return 0}function We(e,t,r,n,i,a){var u=i&o,c=e.length,f=t.length;if(c!=f&&!(u&&f>c))return!1;var l=a.get(e);if(l&&a.get(t))return l==t;var h=-1,p=!0,d=i&s?new Te:void 0;for(a.set(e,t),a.set(t,e);++h<c;){var y=e[h],m=t[h];if(n)var g=u?n(m,y,h,t,e,a):n(y,m,h,e,t,a);if(void 0!==g){if(g)continue;p=!1;break}if(d){if(!z(t,function(e,t){if(!d.has(t)&&(y===e||r(y,e,n,i,a)))return d.add(t)})){p=!1;break}}else if(y!==m&&!r(y,m,n,i,a)){p=!1;break}}return a.delete(e),a.delete(t),p}function $e(e,t){var r,n,i=e.__data__;return(\"string\"==(n=typeof(r=t))||\"number\"==n||\"symbol\"==n||\"boolean\"==n?\"__proto__\"!==r:null===r)?i[\"string\"==typeof t?\"string\":\"hash\"]:i.map}function Xe(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return Ke(r)?r:void 0}var Je=function(e){return ie.call(e)};function Ye(e){return ft(e)||ct(e)||!!(fe&&e&&e[fe])}function Qe(e,t){return!!(t=null==t?u:t)&&(\"number\"==typeof e||D.test(e))&&e>-1&&e%1==0&&e<t}function Ze(e,t,r){if(!dt(r))return!1;var n=typeof t;return!!(\"number\"==n?lt(r)&&Qe(t,r.length):\"string\"==n&&t in r)&&ut(r[t],e)}function et(e,t){if(ft(e))return!1;var r=typeof e;return!(\"number\"!=r&&\"symbol\"!=r&&\"boolean\"!=r&&null!=e&&!mt(e))||(A.test(e)||!x.test(e)||null!=t&&e in Object(t))}function tt(e){return e==e&&!dt(e)}function rt(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}(pe&&Je(new pe(new ArrayBuffer(1)))!=E||de&&Je(new de)!=m||ye&&\"[object Promise]\"!=Je(ye.resolve())||me&&Je(new me)!=w||ge&&\"[object WeakMap]\"!=Je(new ge))&&(Je=function(e){var t=ie.call(e),r=t==v?e.constructor:void 0,n=r?st(r):void 0;if(n)switch(n){case be:return E;case we:return m;case _e:return\"[object Promise]\";case ke:return w;case Se:return\"[object WeakMap]\"}return t});var nt=at(function(e){var t;e=null==(t=e)?\"\":function(e){if(\"string\"==typeof e)return e;if(mt(e))return Ae?Ae.call(e):\"\";var t=e+\"\";return\"0\"==t&&1/e==-a?\"-0\":t}(t);var r=[];return B.test(e)&&r.push(\"\"),e.replace(C,function(e,t,n,i){r.push(n?i.replace(I,\"$1\"):t||e)}),r});function it(e){if(\"string\"==typeof e||mt(e))return e;var t=e+\"\";return\"0\"==t&&1/e==-a?\"-0\":t}function st(e){if(null!=e){try{return re.call(e)}catch(e){}try{return e+\"\"}catch(e){}}return\"\"}var ot=function(e,t){return t=he(void 0===t?e.length-1:t,0),function(){for(var r=arguments,n=-1,i=he(r.length-t,0),s=Array(i);++n<i;)s[n]=r[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=r[n];return o[t]=s,function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(e,this,o)}}(function(e,t){if(null==e)return[];var r=t.length;return r>1&&Ze(e,t[0],t[1])?t=[]:r>2&&Ze(t[0],t[1],t[2])&&(t=[t[0]]),Ve(e,function e(t,r,n,i,s){var o=-1,a=t.length;for(n||(n=Ye),s||(s=[]);++o<a;){var u=t[o];r>0&&n(u)?r>1?e(u,r-1,n,i,s):H(s,u):i||(s[s.length]=u)}return s}(t,1),[])});function at(e,t){if(\"function\"!=typeof e||t&&\"function\"!=typeof t)throw new TypeError(n);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o),o};return r.cache=new(at.Cache||Ie),r}function ut(e,t){return e===t||e!=e&&t!=t}function ct(e){return function(e){return yt(e)&&lt(e)}(e)&&ne.call(e,\"callee\")&&(!ue.call(e,\"callee\")||ie.call(e)==c)}at.Cache=Ie;var ft=Array.isArray;function lt(e){return null!=e&&pt(e.length)&&!ht(e)}function ht(e){var t=dt(e)?ie.call(e):\"\";return t==d||t==y}function pt(e){return\"number\"==typeof e&&e>-1&&e%1==0&&e<=u}function dt(e){var t=typeof e;return!!e&&(\"object\"==t||\"function\"==t)}function yt(e){return!!e&&\"object\"==typeof e}function mt(e){return\"symbol\"==typeof e||yt(e)&&ie.call(e)==k}var gt=M?V(M):function(e){return yt(e)&&pt(e.length)&&!!P[ie.call(e)]};function vt(e){return lt(e)?Pe(e):ze(e)}function bt(e){return e}e.exports=ot}).call(this,r(55)(e))},function(e,t,r){\"use strict\";const n=r(124).Entry,i=r(5),s=r(10);e.exports=class{constructor(e,t,r){s(i.isCID(e),\"needs valid cid\"),this.entry=new n(e,t),this.cancel=Boolean(r)}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toBaseEncodedString()} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.entry.equals(e.entry)}}},function(e,t,r){\"use strict\";e.exports=\"\\n  message Message {\\n    message Wantlist {\\n      message Entry {\\n        // changed from string to bytes, it makes a difference in JavaScript\\n        optional bytes block = 1;      // the block cid (cidV0 in bitswap 1.0.0, cidV1 in bitswap 1.1.0)\\n        optional int32 priority = 2;    // the priority (normalized). default to 1\\n        optional bool cancel = 3;       // whether this revokes an entry\\n      }\\n\\n      repeated Entry entries = 1;       // a list of wantlist entries\\n      optional bool full = 2;           // whether this is the full wantlist. default to false\\n    }\\n\\n    message Block {\\n      optional bytes prefix = 1;        // CID prefix (cid version, multicodec and multihash prefix (type + length)\\n      optional bytes data = 2;\\n    }\\n\\n    optional Wantlist wantlist = 1;\\n    repeated bytes blocks = 2;          // used to send Blocks in bitswap 1.0.0\\n    repeated Block payload = 3;         // used to send Blocks in bitswap 1.1.0\\n  }\\n\"},function(e,t,r){\"use strict\";const n=r(22);e.exports=(e=>{if(!Buffer.isBuffer(e))throw new Error(\"arg needs to be a buffer\");let t=[];for(;e.length>0;){const r=n.decode(e);t.push(r),e=e.slice(n.decode.bytes)}return t})},function(e,t,r){(function(e){var r=200,n=\"__lodash_hash_undefined__\",i=1,s=2,o=9007199254740991,a=\"[object Arguments]\",u=\"[object Array]\",c=\"[object Boolean]\",f=\"[object Date]\",l=\"[object Error]\",h=\"[object Function]\",p=\"[object GeneratorFunction]\",d=\"[object Map]\",y=\"[object Number]\",m=\"[object Object]\",g=\"[object RegExp]\",v=\"[object Set]\",b=\"[object String]\",w=\"[object Symbol]\",_=\"[object ArrayBuffer]\",k=\"[object DataView]\",S=/^\\[object .+?Constructor\\]$/,E=/^(?:0|[1-9]\\d*)$/,x={};x[\"[object Float32Array]\"]=x[\"[object Float64Array]\"]=x[\"[object Int8Array]\"]=x[\"[object Int16Array]\"]=x[\"[object Int32Array]\"]=x[\"[object Uint8Array]\"]=x[\"[object Uint8ClampedArray]\"]=x[\"[object Uint16Array]\"]=x[\"[object Uint32Array]\"]=!0,x[a]=x[u]=x[_]=x[c]=x[k]=x[f]=x[l]=x[h]=x[d]=x[y]=x[m]=x[g]=x[v]=x[b]=x[\"[object WeakMap]\"]=!1;var A=\"object\"==typeof global&&global&&global.Object===Object&&global,B=\"object\"==typeof self&&self&&self.Object===Object&&self,C=A||B||Function(\"return this\")(),I=\"object\"==typeof t&&t&&!t.nodeType&&t,T=I&&\"object\"==typeof e&&e&&!e.nodeType&&e,D=T&&T.exports===I&&A.process,P=function(){try{return D&&D.binding(\"util\")}catch(e){}}(),O=P&&P.isTypedArray;function N(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function U(e){var t=!1;if(null!=e&&\"function\"!=typeof e.toString)try{t=!!(e+\"\")}catch(e){}return t}function R(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function L(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var F,j,M,K=Array.prototype,H=Function.prototype,z=Object.prototype,V=C[\"__core-js_shared__\"],q=(F=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||\"\"))?\"Symbol(src)_1.\"+F:\"\",G=H.toString,W=z.hasOwnProperty,$=z.toString,X=RegExp(\"^\"+G.call(W).replace(/[\\\\^$.*+?()[\\]{}|]/g,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\"),J=C.Symbol,Y=C.Uint8Array,Q=z.propertyIsEnumerable,Z=K.splice,ee=(j=Object.keys,M=Object,function(e){return j(M(e))}),te=Ae(C,\"DataView\"),re=Ae(C,\"Map\"),ne=Ae(C,\"Promise\"),ie=Ae(C,\"Set\"),se=Ae(C,\"WeakMap\"),oe=Ae(Object,\"create\"),ae=Ie(te),ue=Ie(re),ce=Ie(ne),fe=Ie(ie),le=Ie(se),he=J?J.prototype:void 0,pe=he?he.valueOf:void 0;function de(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ye(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function me(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ge(e){var t=-1,r=e?e.length:0;for(this.__data__=new me;++t<r;)this.add(e[t])}function ve(e){this.__data__=new ye(e)}function be(e,t){var r=De(e)||function(e){return function(e){return Re(e)&&Pe(e)}(e)&&W.call(e,\"callee\")&&(!Q.call(e,\"callee\")||$.call(e)==a)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,i=!!n;for(var s in e)!t&&!W.call(e,s)||i&&(\"length\"==s||Ce(s,n))||r.push(s);return r}function we(e,t){for(var r=e.length;r--;)if(Te(e[r][0],t))return r;return-1}function _e(e,t,r,n,o){return e===t||(null==e||null==t||!Ue(e)&&!Re(t)?e!=e&&t!=t:function(e,t,r,n,o,h){var p=De(e),S=De(t),E=u,x=u;p||(E=(E=Be(e))==a?m:E);S||(x=(x=Be(t))==a?m:x);var A=E==m&&!U(e),B=x==m&&!U(t),C=E==x;if(C&&!A)return h||(h=new ve),p||Le(e)?Ee(e,t,r,n,o,h):function(e,t,r,n,o,a,u){switch(r){case k:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case _:return!(e.byteLength!=t.byteLength||!n(new Y(e),new Y(t)));case c:case f:case y:return Te(+e,+t);case l:return e.name==t.name&&e.message==t.message;case g:case b:return e==t+\"\";case d:var h=R;case v:var p=a&s;if(h||(h=L),e.size!=t.size&&!p)return!1;var m=u.get(e);if(m)return m==t;a|=i,u.set(e,t);var S=Ee(h(e),h(t),n,o,a,u);return u.delete(e),S;case w:if(pe)return pe.call(e)==pe.call(t)}return!1}(e,t,E,r,n,o,h);if(!(o&s)){var I=A&&W.call(e,\"__wrapped__\"),T=B&&W.call(t,\"__wrapped__\");if(I||T){var D=I?e.value():e,P=T?t.value():t;return h||(h=new ve),r(D,P,n,o,h)}}if(!C)return!1;return h||(h=new ve),function(e,t,r,n,i,o){var a=i&s,u=Fe(e),c=u.length,f=Fe(t).length;if(c!=f&&!a)return!1;for(var l=c;l--;){var h=u[l];if(!(a?h in t:W.call(t,h)))return!1}var p=o.get(e);if(p&&o.get(t))return p==t;var d=!0;o.set(e,t),o.set(t,e);for(var y=a;++l<c;){h=u[l];var m=e[h],g=t[h];if(n)var v=a?n(g,m,h,t,e,o):n(m,g,h,e,t,o);if(!(void 0===v?m===g||r(m,g,n,i,o):v)){d=!1;break}y||(y=\"constructor\"==h)}if(d&&!y){var b=e.constructor,w=t.constructor;b!=w&&\"constructor\"in e&&\"constructor\"in t&&!(\"function\"==typeof b&&b instanceof b&&\"function\"==typeof w&&w instanceof w)&&(d=!1)}return o.delete(e),o.delete(t),d}(e,t,r,n,o,h)}(e,t,_e,r,n,o))}function ke(e){return!(!Ue(e)||q&&q in e)&&(Oe(e)||U(e)?X:S).test(Ie(e))}function Se(e){if(r=(t=e)&&t.constructor,n=\"function\"==typeof r&&r.prototype||z,t!==n)return ee(e);var t,r,n,i=[];for(var s in Object(e))W.call(e,s)&&\"constructor\"!=s&&i.push(s);return i}function Ee(e,t,r,n,o,a){var u=o&s,c=e.length,f=t.length;if(c!=f&&!(u&&f>c))return!1;var l=a.get(e);if(l&&a.get(t))return l==t;var h=-1,p=!0,d=o&i?new ge:void 0;for(a.set(e,t),a.set(t,e);++h<c;){var y=e[h],m=t[h];if(n)var g=u?n(m,y,h,t,e,a):n(y,m,h,e,t,a);if(void 0!==g){if(g)continue;p=!1;break}if(d){if(!N(t,function(e,t){if(!d.has(t)&&(y===e||r(y,e,n,o,a)))return d.add(t)})){p=!1;break}}else if(y!==m&&!r(y,m,n,o,a)){p=!1;break}}return a.delete(e),a.delete(t),p}function xe(e,t){var r,n,i=e.__data__;return(\"string\"==(n=typeof(r=t))||\"number\"==n||\"symbol\"==n||\"boolean\"==n?\"__proto__\"!==r:null===r)?i[\"string\"==typeof t?\"string\":\"hash\"]:i.map}function Ae(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return ke(r)?r:void 0}de.prototype.clear=function(){this.__data__=oe?oe(null):{}},de.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},de.prototype.get=function(e){var t=this.__data__;if(oe){var r=t[e];return r===n?void 0:r}return W.call(t,e)?t[e]:void 0},de.prototype.has=function(e){var t=this.__data__;return oe?void 0!==t[e]:W.call(t,e)},de.prototype.set=function(e,t){return this.__data__[e]=oe&&void 0===t?n:t,this},ye.prototype.clear=function(){this.__data__=[]},ye.prototype.delete=function(e){var t=this.__data__,r=we(t,e);return!(r<0||(r==t.length-1?t.pop():Z.call(t,r,1),0))},ye.prototype.get=function(e){var t=this.__data__,r=we(t,e);return r<0?void 0:t[r][1]},ye.prototype.has=function(e){return we(this.__data__,e)>-1},ye.prototype.set=function(e,t){var r=this.__data__,n=we(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},me.prototype.clear=function(){this.__data__={hash:new de,map:new(re||ye),string:new de}},me.prototype.delete=function(e){return xe(this,e).delete(e)},me.prototype.get=function(e){return xe(this,e).get(e)},me.prototype.has=function(e){return xe(this,e).has(e)},me.prototype.set=function(e,t){return xe(this,e).set(e,t),this},ge.prototype.add=ge.prototype.push=function(e){return this.__data__.set(e,n),this},ge.prototype.has=function(e){return this.__data__.has(e)},ve.prototype.clear=function(){this.__data__=new ye},ve.prototype.delete=function(e){return this.__data__.delete(e)},ve.prototype.get=function(e){return this.__data__.get(e)},ve.prototype.has=function(e){return this.__data__.has(e)},ve.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ye){var i=n.__data__;if(!re||i.length<r-1)return i.push([e,t]),this;n=this.__data__=new me(i)}return n.set(e,t),this};var Be=function(e){return $.call(e)};function Ce(e,t){return!!(t=null==t?o:t)&&(\"number\"==typeof e||E.test(e))&&e>-1&&e%1==0&&e<t}function Ie(e){if(null!=e){try{return G.call(e)}catch(e){}try{return e+\"\"}catch(e){}}return\"\"}function Te(e,t){return e===t||e!=e&&t!=t}(te&&Be(new te(new ArrayBuffer(1)))!=k||re&&Be(new re)!=d||ne&&\"[object Promise]\"!=Be(ne.resolve())||ie&&Be(new ie)!=v||se&&\"[object WeakMap]\"!=Be(new se))&&(Be=function(e){var t=$.call(e),r=t==m?e.constructor:void 0,n=r?Ie(r):void 0;if(n)switch(n){case ae:return k;case ue:return d;case ce:return\"[object Promise]\";case fe:return v;case le:return\"[object WeakMap]\"}return t});var De=Array.isArray;function Pe(e){return null!=e&&Ne(e.length)&&!Oe(e)}function Oe(e){var t=Ue(e)?$.call(e):\"\";return t==h||t==p}function Ne(e){return\"number\"==typeof e&&e>-1&&e%1==0&&e<=o}function Ue(e){var t=typeof e;return!!e&&(\"object\"==t||\"function\"==t)}function Re(e){return!!e&&\"object\"==typeof e}var Le=O?function(e){return function(t){return e(t)}}(O):function(e){return Re(e)&&Ne(e.length)&&!!x[$.call(e)]};function Fe(e){return Pe(e)?be(e):Se(e)}e.exports=function(e,t,r){var n=(r=\"function\"==typeof r?r:void 0)?r(e,t):void 0;return void 0===n?_e(e,t,r):!!n}}).call(this,r(55)(e))},function(e,t,r){\"use strict\";const n=r(2),i=r(125),s=r(124),o=r(173),a=r(664),u=r(82).logger;e.exports=class{constructor(e,t,r){this.peers=new Map,this.wantlist=new s(r),this.network=t,this._stats=r,this._peerId=e,this._log=u(e,\"want\")}_addEntries(e,t,r){const n=e.map((e,r)=>new i.Entry(e,o.kMaxPriority-r,t));n.forEach(e=>{e.cancel?r?this.wantlist.removeForce(e.cid):this.wantlist.remove(e.cid):(this._log(\"adding to wl\"),this.wantlist.add(e.cid,e.priority))});for(let e of this.peers.values())e.addEntries(n)}_startPeerHandler(e){let t=this.peers.get(e.toB58String());if(t)return void t.refcnt++;t=new a(this._peerId,e,this.network);const r=new i(!0);for(let e of this.wantlist.entries())r.addEntry(e[1].cid,e[1].priority);return t.addMessage(r),this.peers.set(e.toB58String(),t),t}_stopPeerHandler(e){const t=this.peers.get(e.toB58String());t&&(t.refcnt--,t.refcnt>0||this.peers.delete(e.toB58String()))}wantBlocks(e){this._addEntries(e,!1)}unwantBlocks(e){this._log(\"unwant blocks: %s\",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log(\"cancel wants: %s\",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(e){this.timer=setInterval(()=>{this._log(\"resend full-wantlist\");const e=new i(!0);this.wantlist.forEach(t=>{e.addEntry(t.cid,t.priority)}),this.peers.forEach(t=>t.addMessage(e))},6e4),n(()=>e())}stop(e){this.peers.forEach(e=>this.disconnected(e.peerId)),clearInterval(this.timer),n(()=>e())}}},function(e,t,r){\"use strict\";const n=r(3),i=r(215),s=r(18),o=r(30),a=r(74),u=r(671),c=r(663),f=r(659),l=r(654),h=r(82).logger,p=r(653),d={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},y=[\"blocksReceived\",\"dataReceived\",\"dupBlksReceived\",\"dupDataReceived\",\"blocksSent\",\"dataSent\",\"providesBufferLength\",\"wantListLength\",\"peerCount\"];e.exports=class{constructor(e,t,r){this._libp2p=e,this._log=h(this.peerInfo.id),this._options=Object.assign({},d,r),this._stats=new p(y,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new c(e,this,{},this._stats),this.blockstore=t,this.engine=new f(this.peerInfo.id,t,this.network,this._stats),this.wm=new u(this.peerInfo.id,this.network,this._stats),this.notifications=new l(this.peerInfo.id)}get peerInfo(){return this._libp2p.peerInfo}_receiveMessage(e,t,r){this.engine.messageReceived(e,t,n=>{if(n&&this._log(\"failed to receive message\",t),0===t.blocks.size)return r();const i=Array.from(t.blocks.values()),o=i.filter(e=>this.wm.wantlist.contains(e.cid)).map(e=>e.cid);this.wm.cancelWants(o),s(i,(t,r)=>this._handleReceivedBlock(e,t,r),r)})}_handleReceivedBlock(e,t,r){this._log(\"received block\"),n([e=>this.blockstore.has(t.cid,e),(r,n)=>{if(this._updateReceiveCounters(e.toB58String(),t,r),r)return n();this._putBlock(t,n)}],r)}_updateReceiveCounters(e,t,r){this._stats.push(e,\"blocksReceived\",1),this._stats.push(e,\"dataReceived\",t.data.length),r&&(this._stats.push(e,\"dupBlksReceived\",1),this._stats.push(e,\"dupDataReceived\",t.data.length))}_receiveError(e){this._log.error(\"ReceiveError: %s\",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}_putBlock(e,t){this.blockstore.put(e,r=>{if(r)return t(r);this.notifications.hasBlock(e),this.network.provide(e.cid,e=>{e&&this._log.error(\"Failed to provide: %s\",e.message)}),this.engine.receivedBlocks([e.cid]),t()})}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e){return this.engine.wantlistForPeer(e)}get(e,t){this.getMany([e],(e,r)=>{if(e)return t(e);r&&r.length>0?t(null,r[0]):t()})}getMany(e,t){let r=e.length;const i=[];let s=!1;const o=(e,t)=>{i.push(e),this.notifications.wantBlock(e,r=>{this.wm.cancelWants([e]),t(null,r)},()=>{this.wm.cancelWants([e]),t(null,void 0)}),r||this.wm.wantBlocks(i)};a(e,(t,a)=>{n([e=>this.blockstore.has(t,e),(n,a)=>{if(r--,n)return r||this.wm.wantBlocks(i),this.blockstore.get(t,a);s||(s=!0,this.network.findAndConnect(e[0],e=>{e&&this._log.error(e)})),o(t,a)}],a)},t)}unwant(e){Array.isArray(e)||(e=[e]),this.wm.unwantBlocks(e),e.forEach(e=>this.notifications.unwantBlock(e))}cancelWants(e){Array.isArray(e)||(e=[e]),this.wm.cancelWants(e)}put(e,t){this._log(\"putting block\"),n([t=>this.blockstore.has(e.cid,t),(t,r)=>{if(t)return r();this._putBlock(e,r)}],t)}putMany(e,t){n([t=>i(e,(e,t)=>{this.blockstore.has(e.cid,t)},t),(e,t)=>this.blockstore.putMany(e,r=>{if(r)return t(r);e.forEach(e=>{this.notifications.hasBlock(e),this.engine.receivedBlocks([e.cid]),this.network.provide(e.cid,e=>{e&&this._log.error(\"Failed to provide: %s\",e.message)})}),t()})],t)}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}start(e){o([e=>this.wm.start(e),e=>this.network.start(e),e=>this.engine.start(e)],e)}stop(e){this._stats.stop(),o([e=>this.wm.stop(e),e=>this.network.stop(e),e=>this.engine.stop(e)],e)}}},function(e,t,r){\"use strict\";const n=r(30),i=r(672),s=r(2),o=r(17);e.exports=(e=>o(t=>{t=t||function(){};const r=r=>{if(r)return s(()=>e.emit(\"error\",r)),t(r);e.state.started(),s(()=>e.emit(\"start\")),t()};if(\"stopped\"!==e.state.state())return r(new Error(\"Not able to start from state: \"+e.state.state()));e.log(\"starting\"),e.state.start(),n([t=>{e._repo.closed?e._repo.open(t):t()},t=>e.preStart(t),t=>e.libp2p.start(t)],t=>{if(t)return r(t);e._bitswap=new i(e._libp2pNode,e._repo.blocks,{statsEnabled:!0}),e._bitswap.start(),e._blockService.setExchange(e._bitswap),r()})}))},function(e,t,r){\"use strict\";function n(){throw new Error(\"Key management requires '--pass ...' option\")}e.exports=class{static get options(){n()}static generateOptions(){n()}createKey(){n()}listKeys(){n()}findKeyById(){n()}findKeyByName(){n()}renameKey(){n()}removeKey(){n()}exportKey(){n()}importKey(){n()}importPeer(){n()}get cms(){n()}}},function(e,t,r){\"use strict\";const n=r(97).pki;e.exports.certificateForKey=((e,t,r)=>{const i=n.setRsaPublicKey(t.n,t.e),s=n.createCertificate();s.publicKey=i,s.serialNumber=\"01\",s.validity.notBefore=new Date,s.validity.notAfter=new Date,s.validity.notAfter.setFullYear(s.validity.notBefore.getFullYear()+10);const o=[{name:\"organizationName\",value:\"ipfs\"},{shortName:\"OU\",value:\"keystore\"},{name:\"commonName\",value:e.id}];return s.setSubject(o),s.setIssuer(o),s.setExtensions([{name:\"basicConstraints\",cA:!0},{name:\"keyUsage\",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:\"extKeyUsage\",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:\"nsCertType\",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),s.sign(t),r(null,s)})},function(e,t){e.exports=require(\"async\")},function(e,t,r){\"use strict\";const n=r(676),i=r(97),s=r(675);e.exports=class{constructor(e){if(!e)throw new Error(\"keychain is required\");this.keychain=e}encrypt(e,t,r){const o=this,a=(e,t)=>n.setImmediate(()=>r(e,t));if(!Buffer.isBuffer(t))return a(new Error(\"Plain data must be a Buffer\"));n.series([t=>o.keychain.findKeyByName(e,t),t=>o.keychain._getPrivateKey(e,t)],(e,n)=>{if(e)return a(e);let u=n[0],c=n[1];try{const n=i.pki.decryptRsaPrivateKey(c,o.keychain._());s.certificateForKey(u,n,(e,n)=>{if(e)return r(e);const s=i.pkcs7.createEnvelopedData();s.addRecipient(n),s.content=i.util.createBuffer(t),s.encrypt();const o=i.asn1.toDer(s.toAsn1()).getBytes();a(null,Buffer.from(o,\"binary\"))})}catch(e){a(e)}})}decrypt(e,t){const r=(e,r)=>n.setImmediate(()=>t(e,r));if(!Buffer.isBuffer(e))return r(new Error(\"CMS data is required\"));const s=this;let o;try{const t=i.util.createBuffer(e.toString(\"binary\")),n=i.asn1.fromDer(t);o=i.pkcs7.messageFromAsn1(n)}catch(e){return r(new Error(\"Invalid CMS: \"+e.message))}const a=o.recipients.filter(e=>e.issuer.find(e=>\"O\"===e.shortName&&\"ipfs\"===e.value)).filter(e=>e.issuer.find(e=>\"CN\"===e.shortName)).map(e=>({recipient:e,keyId:e.issuer.find(e=>\"CN\"===e.shortName).value}));n.detect(a,(e,t)=>s.keychain.findKeyById(e.keyId,(e,r)=>t(null,!e&&r)),(e,t)=>{if(e)return r(e);if(!t){const t=a.map(e=>e.keyId);return(e=new Error(\"Decryption needs one of the key(s): \"+t.join(\", \"))).missingKeys=t,r(e)}n.waterfall([e=>s.keychain.findKeyById(t.keyId,e),(e,t)=>s.keychain._getPrivateKey(e.name,t)],(e,n)=>{if(e)return r(e);const a=i.pki.decryptRsaPrivateKey(n,s.keychain._());o.decrypt(t.recipient,a),r(null,Buffer.from(o.content.getBytes(),\"binary\"))})})}}},function(e,t,r){\"use strict\";r.r(t);var n=function(e){return function(e){return!!e&&\"object\"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return\"[object RegExp]\"===t||\"[object Date]\"===t||function(e){return e.$$typeof===i}(e)}(e)};var i=\"function\"==typeof Symbol&&Symbol.for?Symbol.for(\"react.element\"):60103;function s(e,t){var r;return t&&!0===t.clone&&n(e)?a((r=e,Array.isArray(r)?[]:{}),e,t):e}function o(e,t,r){var i=e.slice();return t.forEach(function(t,o){void 0===i[o]?i[o]=s(t,r):n(t)?i[o]=a(e[o],t,r):-1===e.indexOf(t)&&i.push(s(t,r))}),i}function a(e,t,r){var i=Array.isArray(t);ret€€